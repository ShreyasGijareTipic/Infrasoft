import{r as o,b as Y,j as e,u as q}from"./index-C2yVeD7S.js";import{e as A,a as F,b as B,d as J}from"./api-CIBCEetx.js";import{S as K}from"./react-select.esm--MXGL-mU.js";import{a as U,b as R,d as z,e as H,c as O}from"./DefaultLayout-BQzMumzV.js";import{a as I,b as t}from"./index.esm-BfesGHR4.js";import{C as i}from"./CFormInput-CXoXZ5N_.js";import{C as Q}from"./CFormLabel-eLpXnSYX.js";import{C as X}from"./CFormTextarea-CPboTIMv.js";import{C as L}from"./CFormSwitch-CD_s8UgB.js";import{C as u}from"./CButton-pXUvGqWL.js";import{C as Z,a as ee}from"./CCardBody-D-jAy6vr.js";import{C as se}from"./CCardHeader-6bNqU1xa.js";import{C as D}from"./cil-mobile-YEmBCbC2.js";import{C as re,a as ae,b as E,c,d as te,e as n}from"./CTable-BcsPMDrs.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./emotion-react.browser.esm-DmeRdXLI.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./RawMaterial-BtjEDAbB.js";import"./CFormControlWrapper-D7XNeBGJ.js";const le=({project:d,onClose:b,onUpdateSuccess:v})=>{const[a,g]=o.useState({...d,start_date:d.start_date?d.start_date.split("T")[0]:"",end_date:d.end_date?d.end_date.split("T")[0]:""}),{showToast:x}=Y(),m=A(),[f,_]=o.useState([]),S=async()=>{try{const r=await F("/api/usersData");_((r==null?void 0:r.users)||[])}catch(r){console.error("Error fetching users:",r),_([])}};o.useEffect(()=>{(m===1||m===3)&&S()},[m]);const l=r=>{const{name:y,value:p,type:C,checked:w}=r.target;g(k=>({...k,[y]:C==="checkbox"?w?1:0:p}))},P=async()=>{try{(await B(`/api/projectsUpdate/${a.id}`,a)).success&&(x("success","Project updated successfully"),v())}catch(r){console.error("Error updating project:",r),x("danger","Error updating project")}};return e.jsxs(U,{visible:!0,onClose:b,alignment:"center",size:"lg",backdrop:"static",keyboard:!0,scrollable:!0,children:[e.jsx(R,{closeButton:!0,children:e.jsx("strong",{children:"Update Project"})}),e.jsx(z,{className:"p-3 p-md-4",children:e.jsxs(I,{className:"g-3",children:[e.jsx(t,{xs:12,md:6,children:e.jsx(i,{label:"Customer Name",name:"customer_name",value:a.customer_name||"",onChange:l})}),e.jsx(t,{xs:12,md:6,children:e.jsx(i,{label:"Mobile Number",name:"mobile_number",type:"tel",value:a.mobile_number||"",onChange:l})}),e.jsx(t,{xs:12,md:6,children:e.jsx(i,{label:"Project Name",name:"project_name",value:a.project_name||"",onChange:l})}),e.jsx(t,{xs:12,md:6,children:e.jsx(i,{label:"Project Cost",name:"project_cost",type:"number",value:a.project_cost||"",onChange:l})}),e.jsx(t,{xs:12,md:6,children:e.jsx(i,{label:"Work Place",name:"work_place",value:a.work_place||"",onChange:l})}),e.jsx(t,{xs:12,md:6,children:e.jsx(i,{type:"date",label:"Start Date",name:"start_date",value:a.start_date||"",onChange:l})}),e.jsx(t,{xs:12,md:6,children:e.jsx(i,{type:"date",label:"End Date",name:"end_date",value:a.end_date||"",onChange:l})}),(m===1||m===3)&&e.jsxs(t,{xs:12,md:6,children:[e.jsx(Q,{children:"Supervisor"}),e.jsx(K,{options:f.map(r=>({value:r.id,label:r.name})),value:f.map(r=>({value:r.id,label:r.name})).find(r=>r.value===a.supervisor_id)||null,onChange:r=>g(y=>({...y,supervisor_id:r?r.value:""})),placeholder:"Select Supervisor",isClearable:!0})]}),e.jsx(t,{xs:12,md:6,children:e.jsx(i,{label:"Commission",name:"commission",type:"number",value:a.commission||"",onChange:l})}),e.jsx(t,{xs:12,md:6,children:e.jsx(i,{label:"GST Number",name:"gst_number",value:a.gst_number||"",onChange:l})}),e.jsx(t,{xs:12,md:6,children:e.jsx(i,{label:"PAN Number",name:"pan_number",value:a.pan_number||"",onChange:l})}),e.jsx(t,{xs:12,children:e.jsx(X,{label:"Remark",name:"remark",rows:3,value:a.remark||"",onChange:l})}),e.jsx(t,{xs:12,children:e.jsx(L,{id:"is_visible",label:"Visible",name:"is_visible",checked:a.is_visible===1||a.is_visible===!0,onChange:l})})]})}),e.jsxs(H,{className:"d-flex gap-2",children:[e.jsx(u,{color:"secondary",onClick:b,children:"Cancel"}),e.jsx(u,{color:"primary",onClick:P,children:"Save Changes"})]})]})},Ne=()=>{const[d,b]=o.useState([]),[v,a]=o.useState(!1),[g,x]=o.useState({}),[m,f]=o.useState(""),_=q(),[S,l]=o.useState(null),[P,r]=o.useState(!1),[y,p]=o.useState(!1),[C,w]=o.useState(null),k=A(),$=s=>{l(s),r(!0)},N=async()=>{var s,j;try{a(!0);const h=await F("/api/myProjects");b(Array.isArray(h)?h:[]),x({})}catch(h){console.error("Error fetching projects:",h),b([]),x({general:((j=(s=h.response)==null?void 0:s.data)==null?void 0:j.message)||"Failed to fetch projects. Please check the server and try again."})}finally{a(!1)}};o.useEffect(()=>{N()},[]);const V=async(s,j)=>{var h,T;try{a(!0),await B(`/api/projects/${s}`,{is_visible:!j}),f("Project visibility updated successfully!"),await N()}catch(M){console.error("Error updating visibility:",M),x({general:((T=(h=M.response)==null?void 0:h.data)==null?void 0:T.message)||"Failed to update project visibility."})}finally{a(!1)}},W=s=>{w(s),p(!0)},G=async()=>{try{await J(`/api/projectsDelete/${C.id}`),p(!1),f("Project deleted successfully!"),N()}catch(s){console.log("Delete error:",s),x({general:"Failed to delete project."})}};return e.jsx("div",{className:"container-lg p-2",children:e.jsxs(Z,{children:[e.jsxs(se,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Projects"}),e.jsx(u,{color:"danger",onClick:()=>_("/projects/new"),children:"New Project"})]}),e.jsxs(ee,{children:[m&&e.jsx(D,{color:"success",children:m}),g.general&&e.jsx(D,{color:"danger",children:g.general}),v&&e.jsx(D,{color:"info",children:"Loading projects..."}),e.jsxs(re,{responsive:!0,hover:!0,children:[e.jsx(ae,{children:e.jsxs(E,{children:[e.jsx(c,{children:"ID"}),e.jsx(c,{children:"Customer Name"}),e.jsx(c,{children:"Project Name"}),e.jsx(c,{children:"Work Place"}),e.jsx(c,{children:"Start Date"}),e.jsx(c,{children:"End Date"}),e.jsx(c,{children:"Supervisor"}),e.jsx(c,{children:"Remark"}),e.jsx(c,{children:"Commission"}),e.jsx(c,{children:"Visible"}),e.jsx(c,{children:"Action"})]})}),e.jsx(te,{children:d.length>0?d.map(s=>{var j;return e.jsxs(E,{children:[e.jsx(n,{children:s.id}),e.jsx(n,{children:s.customer_name}),e.jsx(n,{children:s.project_name}),e.jsx(n,{children:s.work_place}),e.jsx(n,{children:s.start_date||"N/A"}),e.jsx(n,{children:s.end_date||"N/A"}),e.jsx(n,{children:((j=s.supervisor)==null?void 0:j.name)||"N/A"}),e.jsx(n,{children:s.remark||"N/A"}),e.jsx(n,{children:s.commission||"N/A"}),e.jsx(n,{children:e.jsx(L,{checked:s.is_visible,onChange:()=>V(s.id,s.is_visible),disabled:v})}),e.jsx(n,{children:e.jsxs(I,{className:"g-2",children:[e.jsx(t,{xs:"6",className:"d-flex justify-content-start",children:e.jsx(u,{color:"warning",size:"sm",onClick:()=>$(s),children:"Edit"})}),e.jsx(t,{xs:"6",className:"d-flex justify-content-start",children:(k===1||k===3)&&e.jsx(u,{color:"danger",size:"sm",onClick:()=>W(s),children:"Delete"})})]})})]},s.id)}):e.jsx(E,{children:e.jsx(n,{colSpan:"11",className:"text-center",children:"No projects found."})})})]}),P&&S&&e.jsx(le,{project:S,onClose:()=>r(!1),onUpdateSuccess:()=>{r(!1),N()}}),e.jsxs(U,{visible:y,onClose:()=>p(!1),children:[e.jsx(R,{closeButton:!0,children:e.jsxs(O,{children:["Delete Project - ",C==null?void 0:C.project_name,"?"]})}),e.jsx(z,{children:e.jsxs("p",{style:{fontSize:"16px"},children:["Do you really want to"," ",e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"Delete"})," ","this project?"]})}),e.jsxs(H,{children:[e.jsx(u,{color:"secondary",onClick:()=>p(!1),children:"Close"}),e.jsx(u,{color:"primary",onClick:G,children:"Yes"})]})]})]})]})})};export{Ne as default};
