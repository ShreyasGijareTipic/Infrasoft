import{r as a,j as e,C as g}from"./index-DaQ8IcWH.js";import{a as I,p as D}from"./api-CIBCEetx.js";import{a as O,b as d,c as Y}from"./index.esm-W-SaLQ2H.js";import{C as k,a as R}from"./CCardBody-BgdPVtOX.js";import{C as T}from"./CCardHeader-BnYSwQm7.js";import{C as z}from"./cil-mobile-kffaxYCk.js";import{C as b}from"./CFormSelect-fqNFrf6e.js";import{C}from"./CButton-RPa9QO-M.js";import{c as E}from"./cil-search-CDkY_4k-.js";import"./CFormControlWrapper-CkuovpMX.js";import"./CFormLabel-B6T8hfcB.js";const W=()=>{const[m,l]=a.useState([]),[n,h]=a.useState(!1),[t,S]=a.useState(""),[i,v]=a.useState(new Date().getFullYear()),[x,p]=a.useState(null),[N,w]=a.useState(""),[P,A]=a.useState(""),[_,o]=a.useState(!1),M=["January","February","March","April","May","June","July","August","September","October","November","December"],j=new Date().getFullYear(),u=[];for(let s=j-5;s<=j+5;s++)u.push(s);const c=(s,r)=>{w(s),A(r),o(!0),setTimeout(()=>o(!1),5e3)},y=async()=>{if(!t){alert("Please select a month");return}h(!0);try{const s=await I(`/api/supervisor-payments?month=${t}&year=${i}`);s.success?l(s.supervisors||[]):l([])}catch(s){console.error("API Error:",s),l([])}finally{h(!1)}},F=async s=>{p(s.id);const r={id:s.id,payment:s.payment,total_commission:s.total_commission,total_work_point:s.total_work_point,month:t,year:parseInt(i,10)};try{(await D("/api/transactions/pay",r)).success?(await y(),c("Payment Successfully Done!","success")):c("Payment failed. Please try again.","danger")}catch(f){console.error("Payment error:",f),c("Payment failed. Please try again.","danger")}finally{p(null)}};return e.jsx("div",{className:"container-fluid py-4",children:e.jsxs(k,{children:[e.jsx(T,{className:"bg-primary text-white d-flex justify-content-between align-items-center",children:e.jsx("h5",{className:"mb-0",children:"Supervisor Salary Report"})}),e.jsxs(R,{children:[_&&e.jsx(z,{color:P,dismissible:!0,onClose:()=>o(!1),children:N}),e.jsxs(O,{className:"mb-4 d-flex flex-wrap gap-2",children:[e.jsx(d,{md:4,children:e.jsxs(b,{value:t,onChange:s=>S(s.target.value),className:"border",children:[e.jsx("option",{value:"",children:"Select Month"}),M.map((s,r)=>e.jsx("option",{value:s,children:s},r))]})}),e.jsx(d,{md:4,children:e.jsxs(b,{value:i,onChange:s=>v(s.target.value),className:"border",children:[e.jsx("option",{value:"",children:"Select Year"}),u.map(s=>e.jsx("option",{value:s,children:s},s))]})}),e.jsx(d,{md:4,children:e.jsx(C,{color:"primary",onClick:y,disabled:n||!t,className:"w-100",children:n?e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",className:"me-2"})," Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{icon:E,className:"me-2"})," Fetch"]})})})]}),!n&&m.length>0&&e.jsxs("div",{className:"table-responsive",children:[e.jsx("h6",{className:"mb-3",children:"Supervisors"}),e.jsxs("table",{className:"table table-striped table-bordered",children:[e.jsx("thead",{className:"table-info",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Mobile"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Salary"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:m.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.mobile}),e.jsx("td",{children:s.address}),e.jsx("td",{children:s.payment}),e.jsx("td",{children:s.total_commission}),e.jsx("td",{children:e.jsx(C,{color:s.is_paid?"success":"warning",size:"sm",disabled:s.is_paid||x===s.id,onClick:()=>F(s),className:"px-3",children:x===s.id?e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",className:"me-1"})," Processing..."]}):s.is_paid?"Paid":"Pay"})})]},s.id))})]})]})]})]})})};export{W as default};
