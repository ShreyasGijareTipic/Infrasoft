import{E}from"./jspdf.es.min-F4ATsd5K.js";import"./jspdf.plugin.autotable-BzXBgMAn.js";import{g as T}from"./api-CIBCEetx.js";import{l as d}from"./TipicConsultech-B6_BeNSe.js";async function z(o,b="download",y=null){var f;try{if(!o)throw console.error("Receipt data is null or undefined"),new Error("Receipt data is required");const l=["company_name","phone_no","email_id"].filter(t=>!(o.company||o)[t]);l.length>0&&console.warn("Missing required fields:",l),console.log("Receipt data:",o);let e;try{e=new E({orientation:"portrait",unit:"mm",format:"a4"})}catch(t){throw console.error("Failed to initialize PDF:",t),new Error("Failed to initialize PDF document")}const n={primary:"#00bcd4",secondary:"#607d8b",textDark:"#333333",textLight:"#666666",border:"#cccccc"},g=t=>{if(!t)return"N/A";try{const r=new Date(t);return isNaN(r.getTime())?(console.warn("Invalid date string:",t),"Invalid Date"):`${String(r.getDate()).padStart(2,"0")}-${String(r.getMonth()+1).padStart(2,"0")}-${r.getFullYear()}`}catch(r){return console.error("Date formatting error:",r),"N/A"}},h=t=>{if(!t&&t!==0)return"0.00 /-";try{const r=parseFloat(t);return isNaN(r)?(console.warn("Invalid amount:",t),"0.00 /-"):`${r.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})} /-`}catch(r){return console.error("Currency formatting error:",r),"0.00 /-"}},a=(t,r=50)=>t?String(t).length>r?String(t).substring(0,r)+"...":String(t):"N/A",i=((f=T())==null?void 0:f.company_info)||{},x=new Date().toISOString().split("T")[0],F=g(x);try{e.setFont("helvetica","normal"),e.setDrawColor(n.border),e.setLineWidth(.5),e.rect(5,5,e.internal.pageSize.getWidth()-10,e.internal.pageSize.getHeight()-10,"S"),e.setFontSize(18),e.setTextColor(n.textDark),e.setFont("helvetica","bold"),e.text("Subscription Receipt",e.internal.pageSize.getWidth()/2,15,{align:"center"})}catch(t){throw console.error("Error creating PDF header:",t),new Error("Failed to create PDF header")}try{d&&(typeof d=="string"&&(d.startsWith("data:image")||d.startsWith("http"))?e.addImage(d,"PNG",15,25,50,25):console.warn("Logo format not supported or invalid:",typeof d))}catch(t){console.warn("Logo could not be added to PDF:",t)}try{e.setFontSize(11),e.setFont("helvetica","normal"),e.text(a(i.company_name||"Tipic ConsulTech"),190,30,{align:"right"}),e.text(a(i.land_mark||"Konark Karya"),190,35,{align:"right"});let t="";i.Tal&&(t+=i.Tal),i.Dist&&(t&&(t+=", "),t+=i.Dist),i.pincode&&(t&&(t+=", "),t+=i.pincode),e.text(a(t||"Keshav Nagar, Pune, 411000"),190,40,{align:"right"}),e.text(a(`Phone: ${i.phone_no||"9900000000"}`),190,45,{align:"right"}),e.setDrawColor(n.primary),e.setLineWidth(.7),e.line(15,65,e.internal.pageSize.getWidth()-15,65)}catch(t){throw console.error("Error adding company information:",t),new Error("Failed to add company information")}try{e.setFontSize(13),e.setTextColor(n.primary),e.setFont("helvetica","bold"),e.text("Receipt to:",15,75),e.setFontSize(11),e.setTextColor(n.textDark),e.setFont("helvetica","normal");const t=o.company||o.customer||o;e.text("Company Name",15,83),e.text("Mobile Number",15,89),e.text("Email",15,95),e.text("Transaction ID",15,101),e.text(": ",45,83),e.text(": ",45,89),e.text(": ",45,95),e.text(": ",45,101),e.text(a(t.company_name||"N/A"),48,83),e.text(a(t.phone_no||t.mobile||"N/A"),48,89),e.text(a(t.email_id||t.email||"N/A"),48,95),e.text(a(o.transaction_id||o.txn_id||"N/A"),48,101),e.text("Receipt Date",130,83),e.text("Valid Till",130,89),e.text(": ",165,83),e.text(": ",165,89),e.text(a(F),168,83),e.text(a(g(o.valid_till)||"N/A"),168,89)}catch(t){throw console.error("Error adding customer information:",t),new Error("Failed to add customer information")}try{e.setFontSize(13),e.setTextColor(n.primary),e.setFont("helvetica","bold"),e.text("Plan Details",15,115);const t=o.plan||{},r=[[a(t.name||t.plan_name||o.plan_name||"Basic Plan"),g(o.created_at||o.start_date)||F,g(o.valid_till||o.end_date)||"N/A",h(t.plan_price||t.price||o.plan_price||0)]];e.autoTable({startY:120,headStyles:{fillColor:n.primary,textColor:"#FFFFFF",fontStyle:"bold",halign:"center"},bodyStyles:{textColor:n.textDark},theme:"grid",head:[["Plan Name","Start Date","End Date","Amount(Per Month)"]],body:r,margin:{left:15,right:15},columnStyles:{3:{halign:"right"}}})}catch(t){throw console.error("Error creating plan table:",t),new Error("Failed to create plan details table")}try{e.setFontSize(13),e.setTextColor(n.primary),e.setFont("helvetica","bold"),e.text("Payment Details",15,e.autoTable.previous.finalY+15);const t=parseFloat(o.total_amount||o.subtotal||o.amount||0),r=parseFloat(o.gst||o.tax||0),u=parseFloat(o.payable_amount||o.total||o.final_amount||t+r),p=[["Amount",h(t)],["GST",h(r)],["Amount Paid",h(u)]];e.autoTable({startY:e.autoTable.previous.finalY+20,headStyles:{fillColor:n.primary,textColor:"#FFFFFF",fontStyle:"bold"},bodyStyles:{textColor:n.textDark},theme:"grid",head:[["Description","Amount"]],body:p,margin:{left:15,right:15},columnStyles:{1:{halign:"right"}}})}catch(t){throw console.error("Error creating payment table:",t),new Error("Failed to create payment details table")}try{const t="This receipt has been generated by computer and is authorized.",r=e.internal.pageSize.getWidth(),u=e.internal.pageSize.getHeight();e.setFontSize(10),e.setTextColor(n.textDark||"#000000"),e.setFont("helvetica","normal");const p=e.getTextWidth(t),c=(r-p)/2,s=u-15;e.text(t,c,s),console.log("Footer added successfully - centered at:",c,s)}catch(t){console.warn("Error adding footer:",t);try{e.setFontSize(10),e.setTextColor("#000000"),e.text("This receipt has been generated by computer and is authorized.",e.internal.pageSize.getWidth()/2,e.internal.pageSize.getHeight()-15,{align:"center"})}catch(r){console.error("Fallback footer also failed:",r)}}if(b==="blob")try{const t=e.output("blob");return console.log("PDF blob generated successfully"),y&&typeof y=="function"&&y(t),t}catch(t){throw console.error("Error generating PDF blob:",t),new Error(`Failed to generate PDF blob: ${t.message}`)}else{const t=new Date().getTime(),r=o.company||o.customer||o,c=`${(r.company_name||r.name||"Company").replace(/[^a-zA-Z0-9\s]/g,"").replace(/\s+/g,"_").substring(0,20)}_Receipt_${t}.pdf`;console.log("Attempting to save PDF with filename:",c);try{if(typeof e.save!="function")throw new Error("PDF save function is not available");return await new Promise((s,w)=>{try{e.save(c),setTimeout(s,100)}catch(S){w(S)}}),console.log("PDF save command executed successfully"),window.showToast&&window.showToast("success","PDF receipt generated successfully!"),c}catch(s){throw console.error("Error during PDF save:",s),new Error(`Failed to save PDF: ${s.message}`)}}}catch(m){console.error("Error generating PDF:",m),console.error("Error stack:",m.stack);const l=m.message||"Unknown error occurred";return console.error("Detailed error:",{message:l,receiptData:o?"Present":"Missing",userAgent:navigator.userAgent,timestamp:new Date().toISOString()}),window.showToast?window.showToast("danger",`Failed to generate PDF receipt: ${l}`):alert(`Failed to generate PDF receipt: ${l}`),null}}export{z as g};
