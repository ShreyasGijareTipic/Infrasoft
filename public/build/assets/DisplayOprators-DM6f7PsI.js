import{r as i,u as $,b as R,j as e,C as I}from"./index-DsLCqE06.js";import{a as N,b as H}from"./api-CIBCEetx.js";import{C as G,a as z}from"./CCardBody-DQWRa7c4.js";import{C as Z}from"./CCardHeader-PfItfEOJ.js";import{C as f}from"./CFormSelect-84oUtJFR.js";import{C as x}from"./CButton-DirJQzUR.js";import{C as D}from"./cil-mobile-CNtzZ120.js";import{C as J,a as K,b as k,c,d as Q,e as u}from"./CTable-BAKI_IEN.js";import{a as W,b as X,d as Y,e as ee}from"./DefaultLayout-5pHqimqm.js";import{C as re}from"./CForm-D8EjkW87.js";import{a as h,b as t}from"./index.esm-BlJU5mne.js";import{C as o}from"./CFormInput-Db5B42Su.js";import"./CFormControlWrapper-D9cjubv0.js";import"./CFormLabel-CVJu7LBr.js";import"./RawMaterial-BtjEDAbB.js";const Ce=()=>{const[b,A]=i.useState([]),[q,g]=i.useState([]),[P,T]=i.useState([]),[_,y]=i.useState(!0),[C,w]=i.useState(""),[E,p]=i.useState(!1),[a,v]=i.useState(null),[j,F]=i.useState(""),O=$(),{showToast:l}=R();i.useEffect(()=>{S(),B()},[]),i.useEffect(()=>{g(j===""?b:b.filter(r=>r.type===j))},[b,j]);const S=()=>{N("/api/operatorsByCompanyId").then(r=>{if(!r)throw new Error("Failed to fetch operators");A(r),y(!1)}).catch(r=>{w(r.message),y(!1)})},B=()=>{N("/api/myProjects").then(r=>{T(r||[])}).catch(r=>console.error("Failed to load projects:",r))},U=r=>{switch(r){case"0":return"Supervisor";case"1":return"Operator";case"2":return"Vendor";case"3":return"Purches Vendor";default:return"Unknown"}},L=r=>{v({...r,project_id:r.project_id||"",gst_no:r.gst_no||"",bank_name:r.bank_name||"",account_number:r.account_number||"",ifsc_code:r.ifsc_code||"",adhar_number:r.adhar_number||"",pan_number:r.pan_number||""}),p(!0)},n=r=>{const{name:d,value:s,type:ae}=r.target;let m=s;d==="mobile"?/^\d*$/.test(s)&&s.length<=10&&(m=s):d==="account_number"?/^\d*$/.test(s)&&(m=s):d==="adhar_number"?/^\d*$/.test(s)&&s.length<=12&&(m=s):d==="ifsc_code"||d==="pan_number"?(m=s.toUpperCase(),/^[A-Z0-9]*$/.test(s)&&(m=s.toUpperCase())):d==="gst_no"&&(m=s.toUpperCase(),/^[0-9A-Z]*$/.test(s)&&(m=s.toUpperCase())),v(V=>({...V,[d]:m}))},M=async()=>{try{if(!a.name.trim()){l("danger","Name is required");return}if(!a.mobile||a.mobile.length!==10){l("danger","Mobile number must be 10 digits");return}if(!a.address.trim()){l("danger","Address is required");return}if(a.type==="0"&&!a.project_id){l("danger","Project is required for Supervisor");return}if((a.type==="0"||a.type==="1")&&!a.payment){l("danger","Payment is required for Supervisor and Operator");return}if((a.type==="2"||a.type==="3")&&!a.gst_no.trim()){l("danger","GST Number is required for Vendor");return}if(a.bank_name&&!a.account_number){l("danger","Account Number is required when Bank Name is provided");return}if(a.account_number&&!a.bank_name){l("danger","Bank Name is required when Account Number is provided");return}if((a.bank_name||a.account_number)&&!a.ifsc_code){l("danger","IFSC Code is required when bank details are provided");return}const r={...a,project_id:a.project_id?String(a.project_id):"",payment:a.type==="2"?"0":a.payment};await H(`/api/operators/${a.id}`,r),p(!1),l("success","User updated successfully."),S()}catch(r){console.error("Error updating user:",r),l("danger","Failed to update user!")}};return e.jsxs(G,{className:"mb-4",children:[e.jsxs(Z,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Users List"}),e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsxs(f,{value:j,onChange:r=>F(r.target.value),style:{width:"200px"},children:[e.jsx("option",{value:"",children:"All Users"}),e.jsx("option",{value:"0",children:"Supervisors"}),e.jsx("option",{value:"1",children:"Operators"}),e.jsx("option",{value:"2",children:"Vendors"}),e.jsx("option",{value:"3",children:"Purches Vendors"})]}),e.jsx(x,{color:"danger",onClick:()=>O("/oprator"),children:"Add User"})]})]}),e.jsxs(z,{children:[_&&e.jsx(I,{color:"primary"}),C&&e.jsx(D,{color:"danger",children:C}),!_&&!C&&e.jsxs(J,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(K,{children:e.jsxs(k,{children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Mobile"}),e.jsx(c,{children:"Address"}),e.jsx(c,{children:"Role"}),e.jsx(c,{children:"Payment/GST/Bank"}),e.jsx(c,{children:"Project"}),e.jsx(c,{children:"Action"})]})}),e.jsx(Q,{children:q.map((r,d)=>{var s;return e.jsxs(k,{children:[e.jsx(c,{children:d+1}),e.jsx(u,{children:r.name}),e.jsx(u,{children:r.mobile}),e.jsx(u,{children:r.address}),e.jsx(u,{children:U(r.type)}),e.jsxs(u,{children:[r.type==="2"?r.gst_no||"-":(r.type==="0"||r.type==="1")&&r.payment||"-",r.bank_name&&`, ${r.bank_name}`,r.account_number&&` (Acc: ${r.account_number})`]}),e.jsx(u,{children:((s=r.project)==null?void 0:s.project_name)||"-"}),e.jsx(u,{children:e.jsx(x,{color:"info",size:"sm",onClick:()=>L(r),children:"Edit"})})]},r.id)})})]})]}),e.jsxs(W,{visible:E,onClose:()=>p(!1),size:"lg",children:[e.jsx(X,{closeButton:!0,children:"Edit User"}),e.jsx(Y,{children:a&&e.jsxs(re,{children:[e.jsxs(h,{className:"mb-3",children:[e.jsx(t,{md:6,children:e.jsx(o,{label:"Name *",name:"name",value:a.name,onChange:n,required:!0})}),e.jsx(t,{md:6,children:e.jsx(o,{label:"Mobile *",name:"mobile",maxLength:10,value:a.mobile,onChange:n,required:!0})})]}),e.jsx(h,{className:"mb-3",children:e.jsx(t,{md:12,children:e.jsx(o,{label:"Address *",name:"address",value:a.address,onChange:n,required:!0})})}),e.jsxs(h,{className:"mb-3",children:[e.jsx(t,{md:4,children:e.jsx(f,{label:"Role *",name:"type",value:a.type,onChange:n,options:[{label:"Select Role",value:""},{label:"Supervisor",value:"0"},{label:"Operator",value:"1"},{label:"Vendor",value:"2"},{label:"Purches Vendor",value:"3"}],required:!0})}),(a.type==="0"||a.type==="1")&&e.jsx(t,{md:4,children:e.jsx(o,{label:"Payment *",name:"payment",type:"number",value:a.payment,onChange:n,required:!0})})]}),(a.type==="2"||a.type==="3")&&e.jsx(t,{md:4,children:e.jsx(o,{label:"GST Number *",name:"gst_no",maxLength:15,value:a.gst_no,onChange:n,required:!0})}),a.type==="0"&&e.jsx(h,{className:"mb-3",children:e.jsx(t,{md:6,children:e.jsxs(f,{label:"Project *",name:"project_id",value:a.project_id,onChange:n,required:!0,children:[e.jsx("option",{value:"",children:"Select Project"}),P.map(r=>e.jsx("option",{value:r.id,children:r.project_name},r.id))]})})}),e.jsxs(h,{className:"mb-3",children:[e.jsx(t,{md:4,children:e.jsx(o,{label:"Bank Name",name:"bank_name",value:a.bank_name,onChange:n})}),e.jsx(t,{md:4,children:e.jsx(o,{label:"Account Number",name:"account_number",maxLength:18,value:a.account_number,onChange:n})}),e.jsx(t,{md:4,children:e.jsx(o,{label:"IFSC Code",name:"ifsc_code",maxLength:11,value:a.ifsc_code,onChange:n})})]}),e.jsxs(h,{className:"mb-3",children:[e.jsx(t,{md:6,children:e.jsx(o,{label:"Aadhar Number",name:"adhar_number",maxLength:12,value:a.adhar_number,onChange:n})}),e.jsx(t,{md:6,children:e.jsx(o,{label:"PAN Number",name:"pan_number",maxLength:10,value:a.pan_number,onChange:n})})]})]})}),e.jsxs(ee,{children:[e.jsx(x,{color:"secondary",onClick:()=>p(!1),children:"Close"}),e.jsx(x,{color:"primary",onClick:M,children:"Save Changes"})]})]})]})};export{Ce as default};
