import{b as R,r as j,j as a}from"./index-Cs-5ghpe.js";import{g as U,p as Z}from"./api-CIBCEetx.js";import{u as J,a as K,b as P,c as Q,d as W,e as X}from"./DefaultLayout-05E0ZdWa.js";import{C as Y}from"./CForm-BcOVBk6n.js";import{C as f}from"./CFormLabel-DHukGEEc.js";import{C as v}from"./CFormInput-BnDllJdd.js";import{C as V}from"./CFormTextarea-DYz0YCBi.js";import{C as I}from"./CButton-n5jldtHI.js";function le({visible:S,hint:l,setVisible:C,onSuccess:z}){var A,B,D;const M=U(),{showToast:_}=R(),{t:s}=J("global"),[t,g]=j.useState({name:l,mobile:"",discount:0,company_id:M==null?void 0:M.company_id,show:!0,address:"",start_date:"",end_date:""}),[r,u]=j.useState({}),[N,L]=j.useState(!1);j.useEffect(()=>{S&&(/^\d+$/.test(l==null?void 0:l.trim())?g({...t,mobile:l.trim()}):g({...t,name:l==null?void 0:l.trim()}),u({}))},[l,S]);const E=e=>!e||e.trim().length===0?s("MSG.project_name_is_required_msg"):e.trim().length<2?s("MSG.project_name_min_length"):e.trim().length>50?s("MSG.project_name_max_length"):/^[a-zA-Z\u0900-\u097F\s.'-]+$/.test(e.trim())?null:s("MSG.project_name_invalid_chars"),y=e=>!e||e.trim().length===0?s("MSG.mobile_number_is_required_msg"):/^\d{10}$/.test(e.trim())?/^(\d)\1{9}$/.test(e.trim())?s("MSG.mobile_all_same_digits"):/^[0-2]/.test(e.trim())?s("MSG.mobile_invalid_start"):null:s("MSG.please_provide_mobile_number_msg"),G=e=>{if(e===""||e===null||e===void 0)return null;const d=parseFloat(e);return isNaN(d)?s("MSG.discount_not_number"):d<0?s("MSG.discount_negative"):d>100?s("MSG.discount_exceed"):null},F=e=>e&&e.length>500?s("MSG.address_max_length"):null,p=(e,d)=>{if(!e||e.trim().length===0)return null;const n=new Date(e);return isNaN(n.getTime())?s(`MSG.${d}_invalid`,`${d} is invalid`):null},H=()=>{const e={},d=E(t.name);d&&(e.name=d);const n=y(t.mobile);n&&(e.mobile=n);const o=G(t.discount);o&&(e.discount=o);const i=F(t.address);i&&(e.address=i);const c=p(t.start_date,"start_date");c&&(e.start_date=c);const h=p(t.end_date,"end_date");return h&&(e.end_date=h),u(e),Object.keys(e).length===0},b=e=>{const{name:d,value:n}=e.target;if(g({...t,[d]:n}),r[d]){const o={...r};delete o[d],u(o),setTimeout(()=>{let i=null;switch(d){case"name":i=E(n);break;case"mobile":i=y(n);break;case"discount":i=G(n);break;case"address":i=F(n);break;case"start_date":i=p(n,"start_date");break;case"end_date":i=p(n,"end_date");break}i&&u(c=>({...c,[d]:i}))},500)}},w=async e=>{var n,o,i,c,h,T,$,q;if(e.preventDefault(),!H()){_("danger",s("MSG.check_fields_before_submit"));return}L(!0);let d={name:(n=t.name)==null?void 0:n.trim(),mobile:(o=t.mobile)==null?void 0:o.trim(),discount:t.discount||0,company_id:t.company_id,show:t.show,address:(i=t.address)==null?void 0:i.trim(),start_date:t.start_date,end_date:t.end_date};try{const m=await Z("/api/customer",d);m!=null&&m.id?(_("success",s("MSG.data_saved_successfully_msg")),z(m),C(!1),k()):_("danger",s("MSG.failed_to_create_project"))}catch(m){const x=(h=(c=m.response)==null?void 0:c.data)==null?void 0:h.errors;if(((T=x==null?void 0:x.mobile)==null?void 0:T.length)>0){const O=x.mobile[0];u({mobile:O}),_("danger",O)}else(q=($=m.response)==null?void 0:$.data)!=null&&q.message?_("danger",m.response.data.message):_("danger",s("MSG.mobile_already_taken"))}finally{L(!1)}},k=()=>{g({name:"",mobile:"",discount:0,company_id:t.company_id,show:!0,address:"",start_date:"",end_date:""}),u({})};return a.jsxs(K,{backdrop:"static",visible:S,onClose:()=>{k(),C(!1)},children:[a.jsx(P,{children:a.jsx(Q,{children:s("LABELS.new_project")})}),a.jsx(W,{children:a.jsxs(Y,{onSubmit:w,children:[a.jsxs("div",{className:"mb-3",children:[a.jsxs(f,{htmlFor:"pname",children:[s("LABELS.project_name")," ",a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(v,{type:"text",id:"pname",name:"name",placeholder:s("MSG.enter_project_name_msg"),value:t.name||"",onChange:b,invalid:!!r.name,valid:!r.name&&((A=t.name)==null?void 0:A.trim().length)>0,maxLength:50}),r.name&&a.jsx("div",{className:"invalid-feedback d-block",children:r.name})]}),a.jsxs("div",{className:"mb-3",children:[a.jsxs(f,{htmlFor:"plmobile",children:[s("LABELS.mobile_number")," ",a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx(v,{type:"tel",id:"plmobile",name:"mobile",placeholder:s("MSG.enter_mob_no_msg"),value:t.mobile||"",onChange:e=>{const d=e.target.value.replace(/\D/g,"").slice(0,10);b({target:{name:"mobile",value:d}})},invalid:!!r.mobile,valid:!r.mobile&&/^\d{10}$/.test(t.mobile),maxLength:10,autoComplete:"off"}),r.mobile&&a.jsx("div",{className:"invalid-feedback d-block",children:r.mobile}),t.mobile&&t.mobile.length>0&&t.mobile.length<10&&!r.mobile&&a.jsxs("div",{className:"form-text",children:[10-t.mobile.length," more digits required"]})]}),a.jsxs("div",{className:"mb-3",children:[a.jsx(f,{htmlFor:"address",children:s("LABELS.address")}),a.jsx(V,{id:"address",rows:3,name:"address",value:t.address||"",onChange:b,placeholder:s("MSG.enter_address"),invalid:!!r.address,maxLength:500}),r.address&&a.jsx("div",{className:"invalid-feedback d-block",children:r.address}),t.address&&a.jsxs("div",{className:"form-text",children:[t.address.length,"/500 characters"]})]}),a.jsxs("div",{className:"mb-3",children:[a.jsx(f,{htmlFor:"start_date",children:s("LABELS.start_date")}),a.jsx(v,{type:"date",id:"start_date",name:"start_date",value:t.start_date||"",onChange:b,invalid:!!r.start_date,valid:!r.start_date&&((B=t.start_date)==null?void 0:B.trim().length)>0}),r.start_date&&a.jsx("div",{className:"invalid-feedback d-block",children:r.start_date})]}),a.jsxs("div",{className:"mb-3",children:[a.jsx(f,{htmlFor:"end_date",children:s("LABELS.end_date")}),a.jsx(v,{type:"date",id:"end_date",name:"end_date",value:t.end_date||"",onChange:b,invalid:!!r.end_date,valid:!r.end_date&&((D=t.end_date)==null?void 0:D.trim().length)>0}),r.end_date&&a.jsx("div",{className:"invalid-feedback d-block",children:r.end_date})]})]})}),a.jsxs(X,{className:"d-flex justify-content-end gap-2",children:[a.jsx(I,{color:"success",onClick:w,disabled:N||Object.keys(r).length>0,children:N?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"spinner-border spinner-border-sm me-2"}),s("LABELS.saving")]}):s("LABELS.submit")}),a.jsx(I,{color:"secondary",onClick:()=>{k(),C(!1)},disabled:N,children:s("LABELS.close")})]})]})}export{le as N};
