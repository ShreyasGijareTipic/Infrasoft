import{r as o,j as e,C as k}from"./index-Cs-5ghpe.js";import{C as B,c as v,a as b,b as l}from"./index.esm-DS-fhHF9.js";import{S as re}from"./react-select.esm-_lzIqaSS.js";import{a as O}from"./api-CIBCEetx.js";import{C as x,a as h}from"./CCardBody-CWVv-Bam.js";import{C as le}from"./CCardHeader-B5GdMtlk.js";import{c as ne}from"./cil-file-CeQgYs_D.js";import{C as ce}from"./cil-mobile-CqmbNfnm.js";import{C as ie}from"./CForm-BcOVBk6n.js";import{c as de}from"./cil-search-CDkY_4k-.js";import{C as n}from"./CFormLabel-DHukGEEc.js";import{C as c}from"./CFormInput-BnDllJdd.js";import{C as i}from"./CInputGroup-BJM5fT4R.js";import{C as d}from"./CInputGroupText-CpxPBx2W.js";import{C as oe}from"./CButton-n5jldtHI.js";import{c as me}from"./cil-minus-DGBbwmfG.js";import{c as xe}from"./cil-plus-D8mtC-W5.js";import{C as he}from"./CCollapse-DXIMF2-5.js";import{C as H,a as U,b as C,c as j,d as z,e as u}from"./CTable-CVLQWVEb.js";import{C as je}from"./DefaultLayout-05E0ZdWa.js";import{c as ue}from"./cil-location-pin-CQr6GRP7.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./emotion-react.browser.esm-DdLgCZ37.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./CFormControlWrapper-fc1Ss_Cu.js";import"./RawMaterial-BtjEDAbB.js";const Ue=()=>{const[_,Q]=o.useState([]),[W,S]=o.useState(0),[D,F]=o.useState(!1),[R,q]=o.useState([]),[G,P]=o.useState(""),[I,L]=o.useState(""),[f,A]=o.useState([]),[J,M]=o.useState(!1),[p,K]=o.useState(!1),[w,T]=o.useState([]),[X,V]=o.useState(!1);o.useState(!1);const r=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(Number(s||0)),g=s=>Number(s||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),E=async s=>{if(s){M(!0);try{const a=await O(`/api/vendor-payments/${s}`);A(Array.isArray(a)?a:(a==null?void 0:a.data)||[])}catch(a){console.error("Error fetching vendor payments:",a),A([])}finally{M(!1)}}},$=async s=>{if(s){V(!0);try{const a=await O(`/api/getRawMaterialsForSummary?project_id=${s}`);T(Array.isArray(a)?a:(a==null?void 0:a.data)||[])}catch(a){console.error("Error fetching raw materials:",a),T([])}finally{V(!1)}}},Y=()=>f.reduce((s,a)=>({totalAmount:s.totalAmount+Number(a.total_amount||0),paidAmount:s.paidAmount+Number(a.paid_amount||0),balanceAmount:s.balanceAmount+Number(a.balance_amount||0)}),{totalAmount:0,paidAmount:0,balanceAmount:0}),Z=()=>w.reduce((s,a)=>s+Number(a.used_qty||0),0),ee=s=>{const a=parseFloat(s.total_amount||0),m=parseFloat(s.paid_amount||0);return m===0?{text:"Unpaid",color:"danger"}:m>=a?{text:"Paid",color:"success"}:{text:"Partial",color:"warning"}},se=async(s=null)=>{F(!0);try{const a=await O(`/api/project-summary${s?`?project_id=${s}`:""}`);Q(a.data);const m=a.data.map(N=>({value:N.sr_no.toString(),label:`${N.site_name} - ${N.company_name}`}));q(m),!s&&a.data.length>0&&(P(a.data[0].sr_no.toString()),S(0),E(a.data[0].sr_no),$(a.data[0].sr_no))}catch{L("Error fetching project summary data")}finally{F(!1)}};o.useEffect(()=>{se()},[]);const ae=s=>{if(s){P(s.value);const a=_.findIndex(m=>m.sr_no.toString()===s.value);a!==-1&&(S(a),E(s.value),$(s.value))}else P(""),S(0),A([]),T([])},t=_[W],y=Y(),te=Z();return D?e.jsx(B,{fluid:!0,children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx(k,{color:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading project summary..."})]})}):e.jsx(B,{fluid:!0,children:e.jsxs(x,{children:[e.jsx(le,{className:"bg-primary text-white",children:e.jsxs("h1",{className:"mb-0 h4 d-flex align-items-center",children:[e.jsx(v,{icon:ne,className:"me-2"})," Project Summary Report"]})}),e.jsxs(h,{className:"p-4",children:[I&&e.jsx(ce,{color:"danger",dismissible:!0,onClose:()=>L(""),children:I}),t&&e.jsxs(ie,{children:[e.jsx(x,{className:"mb-4 border-0",color:"primary",textColor:"dark",children:e.jsxs(h,{className:"bg-primary-subtle rounded",children:[e.jsxs("h5",{className:"text-primary mb-3 d-flex align-items-center",children:[e.jsx(v,{icon:de,className:"me-2"})," Project Selection & Customer Information"]}),e.jsxs(b,{className:"g-3",children:[e.jsxs(l,{lg:6,md:12,children:[e.jsx(n,{children:"Select Project"}),e.jsx(re,{options:R,isSearchable:!0,isClearable:!0,placeholder:"Select a project...",value:R.find(s=>s.value===G)||null,onChange:ae,className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs(l,{lg:6,md:12,children:[e.jsx(n,{children:"Company Name"}),e.jsx(c,{value:t.company_name,readOnly:!0,className:"bg-white"})]})]})]})}),e.jsx(x,{className:"mb-4 border-0",color:t.is_profit?"success":"danger",textColor:"dark",children:e.jsxs(h,{className:`${t.is_profit?"bg-success-subtle":"bg-danger-subtle"} rounded`,children:[e.jsx("h5",{className:`${t.is_profit?"text-success":"text-danger"} mb-3`,children:t.is_profit?"ðŸ’° Profit":"ðŸ“‰ Loss"}),e.jsxs(b,{className:"g-3",children:[e.jsxs(l,{lg:4,md:4,sm:12,children:[e.jsx(n,{className:"fs-6 fw-bold",children:"Total Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-info text-white",children:"â‚¹"}),e.jsx(c,{value:r(t.total_amount),readOnly:!0,className:"bg-white fw-bold text-info"})]})]}),e.jsxs(l,{lg:4,md:4,sm:12,children:[e.jsx(n,{className:"fs-6 fw-bold",children:"Total Expenses"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-warning text-dark",children:"â‚¹"}),e.jsx(c,{value:r(t.total_expenses),readOnly:!0,className:"bg-white fw-bold text-warning"})]})]}),e.jsxs(l,{lg:4,md:4,sm:12,children:[e.jsx(n,{className:"fs-6 fw-bold",children:t.is_profit?"Net Profit":"Net Loss"}),e.jsxs(i,{children:[e.jsx(d,{className:t.is_profit?"bg-success text-white":"bg-danger text-white",children:"â‚¹"}),e.jsx(c,{value:r(Math.abs(t.profit_or_loss)),readOnly:!0,className:`bg-white fw-bold ${t.is_profit?"text-success":"text-danger"}`})]})]})]})]})}),e.jsx(x,{className:"mb-4 border-0",color:"info",textColor:"dark",children:e.jsxs(h,{className:"bg-info-subtle rounded",children:[e.jsxs("div",{className:"d-flex gap-4 mb-3",children:[e.jsx("h5",{className:"text-info mb-0",children:"Payment / Order Details"}),e.jsxs("h5",{className:"text-dark mb-0",children:["( Total:",e.jsx("span",{className:"text-info fw-bold ms-1",children:r(t.total_amount)})," )"]})]}),e.jsxs(b,{className:"g-3",children:[e.jsxs(l,{lg:6,md:12,children:[e.jsx(n,{children:"Paid Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-success text-white",children:"â‚¹"}),e.jsx(c,{value:r(t.paid_amount),readOnly:!0,className:"bg-white fw-bold text-success"})]})]}),e.jsxs(l,{lg:6,md:12,children:[e.jsx(n,{children:"Pending Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-warning text-dark",children:"â‚¹"}),e.jsx(c,{value:r(t.pending_amount),readOnly:!0,className:"bg-white fw-bold text-warning"})]})]})]})]})}),e.jsx(x,{className:"mb-4 border-0",color:"success",textColor:"dark",children:e.jsxs(h,{className:"bg-success-subtle rounded",children:[e.jsx("h5",{className:"text-success mb-4",children:"Work Done"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-success mb-3",children:"DTH Work"}),e.jsxs(b,{className:"g-3",children:[e.jsxs(l,{lg:4,md:4,sm:12,children:[e.jsx(n,{children:"Total DTH Points"}),e.jsx(c,{value:g(t.total_dth_points),readOnly:!0,className:"bg-white fw-bold text-center"})]}),e.jsxs(l,{lg:4,md:4,sm:12,children:[e.jsx(n,{children:"Average Rate per Point"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:g(t.avg_dth_rate),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(l,{lg:4,md:4,sm:12,children:[e.jsx(n,{children:"Total DTH Billing"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-success text-white",children:"â‚¹"}),e.jsx(c,{value:r(t.total_dth_billing_amount),readOnly:!0,className:"bg-white fw-bold text-success"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-success mb-3",children:"Survey Work"}),e.jsxs(b,{className:"g-3",children:[e.jsxs(l,{lg:4,md:4,sm:12,children:[e.jsx(n,{children:"Total Survey Points"}),e.jsx(c,{value:g(t.total_survey_points),readOnly:!0,className:"bg-white fw-bold text-center"})]}),e.jsxs(l,{lg:4,md:4,sm:12,children:[e.jsx(n,{children:"Average Rate per Point"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:g(t.avg_survey_rate),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(l,{lg:4,md:4,sm:12,children:[e.jsx(n,{children:"Total Survey Billing"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-success text-white",children:"â‚¹"}),e.jsx(c,{value:r(t.total_survey_billing_amount),readOnly:!0,className:"bg-white fw-bold text-success"})]})]})]})]})]})}),e.jsx(x,{className:"mb-4 border-0",color:"warning",textColor:"dark",children:e.jsxs(h,{className:"bg-warning-subtle rounded",children:[e.jsxs("div",{className:"d-flex gap-4 mb-3",children:[e.jsx("h5",{className:"text-warning mb-0",children:"Expenses"}),e.jsxs("h5",{className:"text-dark mb-0",children:["( Total:",e.jsx("span",{className:"text-warning fw-bold ms-1",children:r(t.total_expenses)})," )"]})]}),e.jsxs(b,{className:"g-3",children:[e.jsxs(l,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Transport"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(t.transport),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(l,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Other Billing"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(t.other_billing),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(l,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Total Fuel Amount"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(t.total_diesel_amount),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(l,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Extra Billing"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(t.extra_billing||0),readOnly:!0,className:"bg-white fw-bold"})]})]})]})]})}),e.jsx(x,{className:"mb-4 border-0",color:"dark",textColor:"dark",children:e.jsxs(h,{className:"bg-dark-subtle rounded",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{className:"d-flex gap-4",children:[e.jsx("h5",{className:"text-dark mb-0",children:"Vendor Payments"}),f.length>0&&e.jsxs("h5",{className:"text-muted mb-0",children:["( Total:",e.jsx("span",{className:"text-dark fw-bold ms-1",children:r(y.totalAmount)})," )"]})]}),f.length>0&&e.jsxs(oe,{color:"dark",variant:"outline",size:"sm",onClick:()=>K(!p),children:[e.jsx(v,{icon:p?me:xe,className:"me-1"}),p?"Hide Details":"Show Details"]})]}),J?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(k,{size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading vendor payments..."})]}):f.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(b,{className:"g-3",children:[e.jsxs(l,{xl:4,lg:6,md:12,children:[e.jsx(n,{children:"Total Vendor Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-dark text-white",children:"â‚¹"}),e.jsx(c,{value:r(y.totalAmount),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(l,{xl:4,lg:6,md:12,children:[e.jsx(n,{children:"Total Paid Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-success text-white",children:"â‚¹"}),e.jsx(c,{value:r(y.paidAmount),readOnly:!0,className:"bg-white fw-bold text-success"})]})]}),e.jsxs(l,{xl:4,lg:12,md:12,children:[e.jsx(n,{children:"Total Remaining Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-warning text-dark",children:"â‚¹"}),e.jsx(c,{value:r(y.balanceAmount),readOnly:!0,className:"bg-white fw-bold text-warning"})]})]})]}),e.jsx(he,{visible:p,children:e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{className:"text-dark mb-3",children:"Individual Vendor Details"}),e.jsx("div",{className:"table-responsive",children:e.jsxs(H,{striped:!0,hover:!0,className:"bg-white",children:[e.jsx(U,{color:"dark",children:e.jsxs(C,{children:[e.jsx(j,{children:"Vendor Name"}),e.jsx(j,{children:"Total Amount"}),e.jsx(j,{children:"Paid Amount"}),e.jsx(j,{children:"Balance Amount"}),e.jsx(j,{children:"Status"})]})}),e.jsx(z,{children:f.map(s=>{var m,N;const a=ee(s);return e.jsxs(C,{children:[e.jsx(u,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:((m=s.vendor)==null?void 0:m.name)||"Unknown Vendor"}),((N=s.vendor)==null?void 0:N.mobile)&&e.jsx("small",{className:"text-muted",children:s.vendor.mobile})]})}),e.jsx(u,{children:r(s.total_amount)}),e.jsx(u,{className:"text-success fw-bold",children:r(s.paid_amount)}),e.jsx(u,{className:"text-warning fw-bold",children:r(s.balance_amount)}),e.jsx(u,{children:e.jsx(je,{color:a.color,children:a.text})})]},s.id)})})]})})]})})]}):e.jsx("div",{className:"text-center py-3 text-muted",children:e.jsx("p",{className:"mb-0",children:"No vendor payments found for this project"})})]})}),e.jsx(x,{className:"mb-4 border-0",color:"info",textColor:"dark",children:e.jsxs(h,{className:"bg-info-subtle rounded",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsxs("div",{className:"d-flex gap-4",children:[e.jsx("h5",{className:"text-info mb-0",children:"Used Raw Material"}),w.length>0&&e.jsxs("h5",{className:"text-muted mb-0",children:["( Total Quantity:",e.jsx("span",{className:"text-info fw-bold ms-1",children:g(te)})," )"]})]})}),X?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(k,{size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading raw materials..."})]}):w.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs(H,{striped:!0,hover:!0,className:"bg-white",children:[e.jsx(U,{color:"dark",children:e.jsxs(C,{children:[e.jsx(j,{children:"Material Name"}),e.jsx(j,{children:"Used Quantity"}),e.jsx(j,{children:"Amount"})]})}),e.jsx(z,{children:w.map(s=>e.jsxs(C,{children:[e.jsxs(u,{children:[e.jsx("div",{className:"fw-bold",children:s.material_name||"Unknown Material"}),s.local_name&&s.local_name!==s.material_name&&e.jsx("small",{className:"text-muted",children:s.local_name})]}),e.jsx(u,{children:g(s.used_qty)}),e.jsx(u,{children:s.misc?r(s.misc):"-"})]},s.id))})]})}):e.jsx("div",{className:"text-center py-3 text-muted",children:e.jsx("p",{className:"mb-0",children:"No raw materials found for this project"})})]})})]}),!D&&_.length===0&&e.jsxs("div",{className:"text-center p-4 text-muted",children:[e.jsx(v,{icon:ue,size:"3xl",className:"mb-3"}),e.jsx("h5",{children:"No Projects Found"}),e.jsx("p",{children:"No project data available at the moment."})]})]})]})})};export{Ue as default};
