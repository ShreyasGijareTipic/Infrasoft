import{b as B,r as p,j as e}from"./index-2dn3aAPo.js";import{g as L,a as M,p as H}from"./api-CIBCEetx.js";import{u as z}from"./DefaultLayout-iLQNBb61.js";import{a as x,b as f}from"./index.esm-BqU7uZM5.js";import{C as I,a as U}from"./CCardBody-HQDdpy5u.js";import{C as q}from"./CCardHeader-CSgV6VVv.js";import{C as K}from"./CForm-BXgIXJvs.js";import{C as T}from"./CFormLabel-DZUJOBB2.js";import{C as O}from"./CFormSelect-B9c0-O3a.js";import{b as y}from"./CFormControlWrapper-DrysVgi4.js";import{C as F}from"./CFormTextarea-BuvJZLbz.js";import{C as W,a as G,b as A,c as u,d as J,e as h}from"./CTable-CvasYDPA.js";import{C as g}from"./CFormInput-DgsDA3z5.js";import{C as v}from"./CButton-BUp8JCLl.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-Mmz4KEyA.js";const de=()=>{const{showToast:i}=B();z("global");const b=L(),[N,w]=p.useState([]),[m,E]=p.useState(""),[c,j]=p.useState({}),[n,d]=p.useState([{name:"",mobile:"",address:"",credit:0,company_id:""}]);p.useEffect(()=>{(async()=>{try{const a=await M("/api/companies");if(a!=null&&a.length){const r=a.map(o=>({label:o.company_name,value:o.company_id}));b.type===0?w(r):(w(r.filter(o=>o.value===b.company_id)),E(b.company_id))}}catch(a){i("danger","Error occurred fetching companies: "+a)}})()},[]);const C=(s,a)=>{const{name:r,value:o}=a.target,t=[...n];t[s][r]=o,d(t)},k=()=>{d([...n,{name:"",mobile:"",address:"",credit:0,company_id:m}])},P=s=>{const a=n.filter((r,o)=>o!==s);d(a)},R=s=>{const o=s.clipboardData.getData("text").trim().split(`
`).map(t=>{var S,_,D;const l=t.split(/\t|,/);return{name:((S=l[0])==null?void 0:S.trim())||"",mobile:((_=l[1])==null?void 0:_.trim())||"",address:((D=l[2])==null?void 0:D.trim())||"",credit:parseFloat(l[3])||0,company_id:m}});d(o),s.preventDefault()},$=async s=>{s.preventDefault();const a={};if(m||(a.selectedCompany=!0),n.forEach((t,l)=>{t.name.trim()||(a[`name-${l}`]=!0),/^\d{10}$/.test(t.mobile)||(a[`mobile-${l}`]=!0)}),new Set(n.map(t=>t.mobile)).size!==n.length){i("danger","Duplicate mobile numbers are not allowed.");return}if(Object.keys(a).length>0){j(a),i("danger","Please fix validation errors before submitting.");return}let o=[...n];o=o.map(t=>({...t,company_id:m}));try{const t=await H("/api/bulkCustomerCreation",o);t!=null&&t.success?(i("success","Customers created"),d([{name:"",mobile:"",address:"",credit:0,company_id:m}]),j({})):i("danger","Error occurred, please try again later.")}catch(t){i("danger","Error occurred "+t)}};return e.jsx(x,{children:e.jsx(f,{xs:12,children:e.jsxs(I,{className:"mb-4",children:[e.jsx(q,{children:e.jsx("strong",{children:"Bulk Add Customers"})}),e.jsx(U,{children:e.jsxs(K,{onSubmit:$,children:[e.jsx(x,{className:"mb-3",children:e.jsxs(f,{md:6,children:[e.jsx(T,{children:"Select Company"}),e.jsxs(O,{value:m,onChange:s=>{E(s.target.value),j(a=>({...a,selectedCompany:!1})),d(n.map(a=>({...a,company_id:s.target.value})))},invalid:c.selectedCompany,children:[e.jsx("option",{value:"",children:"Select"}),N.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),c.selectedCompany&&e.jsx(y,{invalid:!0,children:"Please select a company."})]})}),e.jsx(x,{className:"mb-3",children:e.jsxs(f,{children:[e.jsx(T,{children:"Paste Excel Data (Name, Mobile, Address, Credit)"}),e.jsx(F,{rows:2,placeholder:"Paste tab or comma separated data here, or data from excel sheet. Eg= Ravi Kumar,9871234567,Bazaar Road,0",onPaste:R})]})}),e.jsxs(W,{bordered:!0,responsive:!0,children:[e.jsx(G,{children:e.jsxs(A,{children:[e.jsx(u,{children:"Name"}),e.jsx(u,{children:"Mobile"}),e.jsx(u,{children:"Address"}),e.jsx(u,{children:"Credit"}),e.jsx(u,{children:"Actions"})]})}),e.jsx(J,{children:n.map((s,a)=>e.jsxs(A,{children:[e.jsxs(h,{children:[e.jsx(g,{name:"name",value:s.name,onChange:r=>C(a,r),invalid:!!c[`name-${a}`]}),c[`name-${a}`]&&e.jsx(y,{invalid:!0,children:"Name is required."})]}),e.jsxs(h,{children:[e.jsx(g,{name:"mobile",value:s.mobile,onChange:r=>C(a,r),minLength:10,maxLength:10,pattern:"\\d{10}",invalid:!!c[`mobile-${a}`]}),c[`mobile-${a}`]&&e.jsx(y,{invalid:!0,children:"Enter a valid 10-digit mobile."})]}),e.jsx(h,{children:e.jsx(F,{name:"address",rows:1,value:s.address,onChange:r=>C(a,r)})}),e.jsx(h,{children:e.jsx(g,{type:"number",name:"credit",onWheel:r=>r.target.blur(),value:s.credit,onChange:r=>C(a,r),min:0})}),e.jsx(h,{children:e.jsx(v,{color:"danger",onClick:()=>P(a),children:"Remove"})})]},a))})]}),e.jsxs("div",{className:"d-flex justify-content-between mt-3",children:[e.jsx(v,{color:"primary",onClick:k,children:"Add Another Customer"}),e.jsx(v,{color:"success",type:"submit",children:"Submit"})]})]})})]})})})};export{de as default};
