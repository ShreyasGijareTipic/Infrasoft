import{b as L,r as x,j as e}from"./index-DQ9cqY-w.js";import{b as E}from"./api-CIBCEetx.js";import{r as A,p as M}from"./Feilds-BHjWXeSc.js";import{u as B,a as T,b as w,c as Q,d as N,e as R}from"./DefaultLayout-D1v7lmV6.js";import{a as o,b as s}from"./index.esm-t1uhsutJ.js";import{C as r}from"./CFormLabel-C-r2uEyX.js";import{C as d}from"./CFormInput-C2pMQ5Ja.js";import{C as u}from"./CFormSelect-D_PQmfUM.js";import{C as D}from"./CFormCheck-R-WMkSma.js";import{C as j}from"./CButton-Cv8rOKs_.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-Cf1prUnf.js";import"./CFormControlWrapper-C03sehqW.js";const Y=({visible:_,onClose:i,material:p,refreshList:C})=>{const{showToast:h}=L(),{t:c}=B("global"),[a,m]=x.useState({current_stock:0,unit:"",price:0,total:0,add_qty:0,contact:"",payment_by:"",payment_type:"",expense_flag:!1}),b=["kg","pcs","mg","ltr","bag"];x.useEffect(()=>{var t;if(p){const n=((t=p.logs)==null?void 0:t[0])||{};m({current_stock:n.current_stock||0,unit:n.unit||"",price:n.price||0,total:n.total||0,add_qty:0,expense_flag:!0})}},[p]);const y=t=>{const{name:n,type:v,value:f,checked:k}=t.target;m(F=>{const l={...F,[n]:v==="checkbox"?!!k:f};if(n==="add_qty"||n==="price"){const S=parseFloat(l.current_stock)+(parseFloat(l.add_qty)||0),q=parseFloat(l.price)||0;l.total=S*q}return l})},g=async()=>{try{await E(`/api/rawMaterial/addQty/${p.id}`,{add_qty:a.add_qty,price:a.price,unit:a.unit,contact:a.contact,payment_by:a.payment_by,payment_type:a.payment_type,expense_flag:!!a.expense_flag}),h("success","Quantity added successfully!"),C(),i()}catch(t){console.error(t),h("danger","Failed to update quantity")}};return e.jsxs(T,{visible:_,onClose:i,children:[e.jsx(w,{onClose:i,children:e.jsx(Q,{children:"Add Quantity"})}),e.jsxs(N,{children:[e.jsxs(o,{className:"mb-3",children:[e.jsxs(s,{md:6,children:[e.jsx(r,{children:"Current Stock"}),e.jsx(d,{value:a.current_stock,readOnly:!0})]}),e.jsxs(s,{md:6,children:[e.jsx(r,{children:"Unit *"}),e.jsxs(u,{name:"unit",value:a.unit,onChange:y,children:[e.jsx("option",{value:"",children:"-- Select Unit --"}),b.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs(o,{className:"mb-3",children:[e.jsxs(s,{md:6,children:[e.jsx(r,{children:"Price"}),e.jsx(d,{name:"price",type:"number",min:"0",step:"0.01",value:a.price,onChange:t=>{const n=t.target.value.replace(/[^0-9.]/g,"");m({...a,price:n})}})]}),e.jsxs(s,{md:6,children:[e.jsx(r,{children:"Total"}),e.jsx(d,{value:a.total,readOnly:!0})]})]}),e.jsx(o,{children:e.jsxs(s,{md:12,children:[e.jsx(r,{children:"Add Qty"}),e.jsx(d,{name:"add_qty",type:"number",min:"0",step:"1",value:a.add_qty,placeholder:"Enter quantity to add",onChange:t=>{const n=t.target.value.replace(/[^0-9]/g,"");m({...a,add_qty:n})}})]})}),e.jsxs(o,{className:"mb-3",children:[e.jsxs(s,{sm:4,children:[e.jsx(r,{htmlFor:"contact",children:e.jsx("p",{children:c("LABELS.contact")})}),e.jsx(d,{type:"text",id:"contact",placeholder:c("LABELS.enter_contact"),name:"contact",value:a.contact,onChange:y,maxLength:10,inputMode:"numeric"})]}),e.jsxs(s,{sm:4,children:[e.jsx(r,{htmlFor:"payment_by",children:e.jsx("p",{children:c("LABELS.payment_by")})}),e.jsxs(u,{id:"payment_by",name:"payment_by",value:a.payment_by,onChange:y,children:[e.jsx("option",{value:"",children:c("LABELS.select_payment_by")}),A.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]}),e.jsxs(s,{sm:4,children:[e.jsx(r,{htmlFor:"payment_type",children:e.jsx("p",{children:c("LABELS.payment_type")})}),e.jsxs(u,{id:"payment_type",name:"payment_type",value:a.payment_type,onChange:y,required:!0,children:[e.jsx("option",{value:"",children:"Select Payment Type"}),M.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]})]}),e.jsx(o,{className:"mb-2",children:e.jsx(s,{children:e.jsx(D,{type:"checkbox",name:"expense_flag",id:"expense_flag",label:"Add in Expense Record...",checked:!0})})})]}),e.jsxs(R,{children:[e.jsx(j,{color:"secondary",onClick:i,children:"Cancel"}),e.jsx(j,{color:"primary",onClick:g,children:"Save"})]})]})};export{Y as default};
