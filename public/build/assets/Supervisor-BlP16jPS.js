import{r,b as Le,j as e}from"./index-DQ9cqY-w.js";import{C as qe,a as Ve,b as De,c as v}from"./index.esm-t1uhsutJ.js";import{g as Fe,a as ve,r as He,b as Be}from"./api-CIBCEetx.js";import{C as Ze,a as $e}from"./CCardBody-nJ-qIk-T.js";import{C as Ge}from"./CCardHeader-Dxk59cNM.js";import{C as x}from"./CButton-Cv8rOKs_.js";import{C as Ye,a as Je,b as xe,c,d as Ke,e as d}from"./CTable-Bg7ZIw-y.js";import{a as be,b as je,c as Ce,d as ye,e as ge}from"./DefaultLayout-D1v7lmV6.js";import{C as Oe}from"./CForm-Dfp3PuZs.js";import{C as u}from"./CInputGroup-CX6YuGRq.js";import{C as p}from"./CInputGroupText-CFKboCAQ.js";import{c as Qe}from"./cib-amazon-pay-kD6VdHHX.js";import{C as Z}from"./CFormSelect-D_PQmfUM.js";import{c as We}from"./cil-people-DQU-yEHN.js";import{c as Xe}from"./RawMaterial-BtjEDAbB.js";import{C as i}from"./CFormInput-C2pMQ5Ja.js";import{c as es,a as we}from"./cil-mobile-Cf1prUnf.js";import"./CFormControlWrapper-C03sehqW.js";import"./CFormLabel-C-r2uEyX.js";const Cs=()=>{var ie,ne;const[Se,N]=r.useState([]),[Pe,$]=r.useState(!1),[Ie,P]=r.useState(!1),[l,b]=r.useState(null),[k,G]=r.useState(!1),[Y,J]=r.useState([]),[I,K]=r.useState(!1),[E,O]=r.useState(!1),[Q,R]=r.useState(!1),[W,T]=r.useState(!1),[U,A]=r.useState(!1),[z,_]=r.useState(!1),[X,ee]=r.useState(!1),[se,ae]=r.useState(!1),[Ee,L]=r.useState(""),[Me,q]=r.useState(""),[Ne,V]=r.useState(""),[ke,D]=r.useState(""),j=r.useRef(),m=r.useRef(),C=r.useRef(),f=r.useRef(),h=r.useRef(),y=r.useRef(),g=r.useRef(),{showToast:o}=Le(),w=Fe();let S=[];w.type===0?S=[{label:"Select User Type ",value:""},{label:"Super Admin",value:"0"},{label:"Admin",value:"1"},{label:"User",value:"2",disabled:!1},{label:"User++",value:"3",disabled:!1},{label:"Purchase Vendor",value:"4",disabled:!1}]:w.type===1?S=[{label:"Select User Type ",value:""},{label:"Admin",value:"1"},{label:"User",value:"2",disabled:!1},{label:"User++",value:"3",disabled:!1},{label:"Purchase Vendor",value:"4",disabled:!1}]:S=[{label:"Select User Type ",value:""},{label:"User",value:"2",disabled:!1},{label:"User++",value:"3",disabled:!1},{label:"Purchase Vendor",value:"4",disabled:!1}];const Re=s=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(s),Te=s=>s.replace(/\D/g,"").length===10,Ue=s=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(s),re=()=>{var a;const s=((a=m.current)==null?void 0:a.value)||"";s&&!Re(s)?(R(!0),L("Please enter a valid email address")):(R(!1),L(""))},le=()=>{var a;const s=((a=C.current)==null?void 0:a.value)||"";s&&!Te(s)?(T(!0),q("Please enter exactly 10 digits")):(T(!1),q(""))},te=()=>{var a,t;const s=((a=f.current)==null?void 0:a.value)||"";s&&!Ue(s)?(A(!0),V("Password must be at least 8 characters with uppercase, lowercase, number and special character")):(A(!1),V("")),(t=h.current)!=null&&t.value&&F()},F=()=>{var t,n;const s=((t=f.current)==null?void 0:t.value)||"",a=((n=h.current)==null?void 0:n.value)||"";a&&s!==a?(_(!0),D("Passwords do not match")):(_(!1),D(""))},M=(s,a=!1)=>{const t=parseInt(a?g.current.value:y.current.value,10);a?ae(!(t>0)):ee(![0,1,2,3,4].includes(t))};r.useEffect(()=>{ve("/api/company").then(s=>{if(s!=null&&s.length){const a=s.map(t=>({label:t.company_name,value:t.company_id}));w.type===0?J(a):J(a.filter(t=>t.value===w.company_id))}}).catch(s=>o("danger","Error: "+s))},[]);const H=async()=>{try{const s=await ve("/api/appUsers");s!=null&&s.data?N(s.data):N([])}catch(s){console.error("Error fetching supervisors:",s),o("danger","Error fetching supervisors: "+s.message),N([])}};r.useEffect(()=>{H()},[]);const Ae=()=>{j.current&&(j.current.value=""),m.current&&(m.current.value=""),C.current&&(C.current.value=""),f.current&&(f.current.value=""),h.current&&(h.current.value=""),y.current&&(y.current.value=""),g.current&&(g.current.value=""),G(!1),ee(!1),ae(!1),R(!1),T(!1),A(!1),_(!1),L(""),q(""),V(""),D(""),K(!1),O(!1)},B=()=>{$(!1),Ae()},oe=async s=>{var n,ce,de,ue,pe,me,fe;s.preventDefault(),s.stopPropagation();const a=s.currentTarget;if(G(!0),re(),le(),te(),F(),M(null,!1),M(null,!0),a.checkValidity()===!1||Q||W||U||z||X||se){o("danger","Please fix all errors before submitting");return}const t={name:(n=j.current)==null?void 0:n.value.trim(),email:(ce=m.current)==null?void 0:ce.value.trim(),mobile:(de=C.current)==null?void 0:de.value.trim(),password:(ue=f.current)==null?void 0:ue.value,password_confirmation:(pe=h.current)==null?void 0:pe.value,type:(me=y.current)==null?void 0:me.value,company_id:(fe=g.current)==null?void 0:fe.value};try{await He(t)?(o("success","New supervisor created successfully"),B(),H()):o("danger","Error occurred, please try again later.")}catch(he){o("danger","Error occurred "+he)}},ze=s=>{b(s),P(!0)},_e=async()=>{if(l)try{const s={id:l.id,name:l.name,email:l.email,mobile:l.mobile,type:l.type,company_id:l.company_id||w.company_id,blocked:l.blocked??0},a=await Be(`/api/userUpdated/${l.id}`,s);a!=null&&a.success?(o("success","Supervisor updated successfully"),P(!1),H()):o("danger",(a==null?void 0:a.message)||"Update failed")}catch(s){o("danger","Error updating supervisor: "+s)}};return e.jsxs("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-column",children:[e.jsx(qe,{children:e.jsx(Ve,{className:"justify-content-center",children:e.jsx(De,{md:12,lg:12,xl:12,children:e.jsxs(Ze,{children:[e.jsxs(Ge,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Supervisors List"}),e.jsx(x,{color:"danger",onClick:()=>$(!0),className:"text-white",children:"Add New Supervisor"})]}),e.jsx($e,{children:e.jsxs(Ye,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(Je,{children:e.jsxs(xe,{children:[e.jsx(c,{children:"#"}),e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Mobile"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Company"}),e.jsx(c,{children:"Action"})]})}),e.jsx(Ke,{children:Se.map((s,a)=>{var t;return e.jsxs(xe,{children:[e.jsx(d,{children:a+1}),e.jsx(d,{children:s.name}),e.jsx(d,{children:s.email}),e.jsx(d,{children:s.mobile}),e.jsx(d,{children:s.type===0?"Super Admin":s.type===1?"Admin":s.type===2?"User":s.type===3?"User++":s.type===4?"Purchase Vendor":"Unknown"}),e.jsx(d,{children:((t=Y.find(n=>n.value===s.company_id))==null?void 0:t.label)||"N/A"}),e.jsx(d,{children:e.jsx(x,{size:"sm",color:"info",className:"text-white",onClick:()=>ze(s),children:"Edit"})})]},s.id)})})]})})]})})})}),e.jsxs(be,{visible:Pe,onClose:B,backdrop:"static",keyboard:!1,size:"lg",children:[e.jsx(je,{closeButton:!0,children:e.jsx(Ce,{children:"Add New Supervisor"})}),e.jsx(ye,{children:e.jsxs(Oe,{noValidate:!0,validated:k,onSubmit:oe,children:[e.jsxs(u,{className:"mb-4",children:[e.jsx(p,{children:e.jsx(v,{icon:Qe})}),e.jsx(Z,{onChange:s=>M(s,!0),"aria-label":"Select Shop / Company",ref:g,invalid:se,options:Y,feedbackInvalid:"Select Shop / Company",required:!0})]}),e.jsxs(u,{className:"mb-4",children:[e.jsx(p,{children:e.jsx(v,{icon:We})}),e.jsx(Z,{onChange:M,"aria-label":"Select user type",ref:y,invalid:X,options:S,feedbackInvalid:"Please select a valid option.",required:!0})]}),e.jsxs(u,{className:"mb-3",children:[e.jsx(p,{children:e.jsx(v,{icon:Xe})}),e.jsx(i,{ref:j,type:"text",placeholder:"Supervisor Name",required:!0,invalid:k&&!((ie=j.current)!=null&&ie.value),feedbackInvalid:"Please provide a valid supervisor name."})]}),e.jsxs(u,{className:"mb-3",children:[e.jsx(p,{children:"@"}),e.jsx(i,{ref:m,type:"email",placeholder:"Email",required:!0,invalid:k&&(Q||!((ne=m.current)!=null&&ne.value)),onChange:re,feedbackInvalid:Ee||"Please provide a valid email."})]}),e.jsxs(u,{className:"mb-3",children:[e.jsx(p,{children:e.jsx(v,{icon:es})}),e.jsx(i,{ref:C,placeholder:"Mobile (10 digits)",required:!0,invalid:W,onChange:s=>{const a=s.target.value.replace(/\D/g,"");s.target.value=a,le()},feedbackInvalid:Me||"Please provide a valid mobile number.",maxLength:"10"})]}),e.jsxs("div",{className:"mb-3",style:{position:"relative"},children:[e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(v,{icon:we})}),e.jsx(i,{type:I?"text":"password",ref:f,placeholder:"Enter New Password",required:!0,onChange:te,autoComplete:"new-password",style:{paddingRight:"45px",border:U?"1px solid #dc3545":void 0}}),e.jsx("div",{onClick:()=>K(!I),style:{position:"absolute",right:"15px",top:"50%",transform:"translateY(-50%)",cursor:"pointer",fontSize:"18px",color:"#6c757d",zIndex:10,userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px"},title:I?"Hide password":"Show password",children:I?"ðŸ™ˆ":"ðŸ‘ï¸"})]}),U&&e.jsx("div",{className:"invalid-feedback",style:{display:"block"},children:Ne||"Please provide a valid password."})]}),e.jsxs("div",{className:"mb-4",style:{position:"relative"},children:[e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(v,{icon:we})}),e.jsx(i,{type:E?"text":"password",ref:h,placeholder:"Confirm Password",required:!0,onChange:F,autoComplete:"new-password",style:{paddingRight:"45px",border:z?"1px solid #dc3545":void 0}}),e.jsx("div",{onClick:()=>O(!E),style:{position:"absolute",right:"15px",top:"50%",transform:"translateY(-50%)",cursor:"pointer",fontSize:"18px",color:"#6c757d",zIndex:10,userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px"},title:E?"Hide password":"Show password",children:E?"ðŸ™ˆ":"ðŸ‘ï¸"})]}),z&&e.jsx("div",{className:"invalid-feedback",style:{display:"block"},children:ke||"Please confirm your password."})]})]})}),e.jsxs(ge,{children:[e.jsx(x,{color:"secondary",onClick:B,children:"Cancel"}),e.jsx(x,{color:"success",onClick:oe,children:"Save Supervisor"})]})]}),e.jsxs(be,{visible:Ie,onClose:()=>P(!1),children:[e.jsx(je,{children:e.jsx(Ce,{children:"Edit Supervisor"})}),e.jsx(ye,{children:l&&e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"mb-2",label:"Name",value:l.name,onChange:s=>b({...l,name:s.target.value})}),e.jsx(i,{className:"mb-2",label:"Email",value:l.email,onChange:s=>b({...l,email:s.target.value})}),e.jsx(i,{className:"mb-2",label:"Mobile",value:l.mobile,onChange:s=>b({...l,mobile:s.target.value})}),e.jsx(Z,{className:"mb-2",label:"Type",value:l.type,onChange:s=>b({...l,type:parseInt(s.target.value)}),options:S})]})}),e.jsxs(ge,{children:[e.jsx(x,{color:"secondary",onClick:()=>P(!1),children:"Close"}),e.jsx(x,{color:"success",onClick:_e,children:"Save Changes"})]})]})]})};export{Cs as default};
