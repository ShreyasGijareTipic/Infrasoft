import{b as Y,r as c,j as e}from"./index-RpBzfmRP.js";import{M as J}from"./mantine-react-table.esm-BVso0d4Q.js";import{a as S,b as w,c as p}from"./index.esm-DUetlGrP.js";import{a as Q,d as X,p as Z,b as ee}from"./api-CIBCEetx.js";import{C as ae}from"./ConfirmationModal-CcMGRpGQ.js";import{C as f}from"./CButton-L7dQWiht.js";import{c as se}from"./cil-plus-D8mtC-W5.js";import{C as M}from"./CForm-HJD6m-Ck.js";import{C as j}from"./CInputGroup-zC7AuBYL.js";import{C as y}from"./CInputGroupText-CmPlvCyb.js";import{c as V}from"./cil-people-DQU-yEHN.js";import{C as v}from"./CFormInput-DA1SntO8.js";import{c as z}from"./cil-money-Dk3vHnQB.js";import{C as I}from"./DefaultLayout-8YNBKV_4.js";import{c as te}from"./cil-pencil-m516yCOw.js";import{c as re}from"./cil-trash-CBbKHhHb.js";import"./Table-B0BxSSAw.js";import"./MantineProvider-CyXtl0YD.js";import"./emotion-react.browser.esm-CMGNWn0o.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./CFormControlWrapper-D2DOCb2Z.js";import"./CFormLabel-CbpozHkd.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-BmZiFZXB.js";const Ee=()=>{const{showToast:o}=Y(),[A,R]=c.useState([]),[h,$]=c.useState(),[F,C]=c.useState(!1),[q,T]=c.useState(!1),[d,l]=c.useState({}),[u,x]=c.useState({visible:!1,validated:!1,formData:{partner_type:"",commission:""}}),[m,g]=c.useState({visible:!1,validated:!1,formData:{id:"",partner_type:"",commission:""}}),b=async()=>{try{T(!0);const a=await Q("/api/partner-types");R(a||[])}catch(a){o("danger","Error fetching partner types: "+a.message)}finally{T(!1)}};c.useEffect(()=>{b()},[]);const P=a=>{const s=parseFloat(a);return!isNaN(s)&&s>=0&&s<=100},D=(a,s,n)=>{let t="";switch(a){case"partner_type":(!s||s.trim().length<2)&&(t="Partner type must be at least 2 characters long");break;case"commission":(!s||!P(s))&&(t="Commission must be a number between 0 and 100");break}l(r=>({...r,[`${n}_${a}`]:t}))},K=a=>{$(a),C(!0)},B=async()=>{try{await X(`/api/partner-types/${h.id}`),C(!1),o("success","Partner type deleted successfully!"),b()}catch(a){o("danger","Error deleting partner type: "+a.message)}},G=a=>{g({visible:!0,validated:!1,formData:{id:a.id,partner_type:a.partner_type||"",commission:a.commission||""}}),l({})},H=()=>{x({visible:!0,validated:!1,formData:{partner_type:"",commission:""}}),l({})},N=()=>{x(a=>({...a,visible:!1,validated:!1})),l({})},k=a=>{const{name:s,value:n}=a.target;let t=n;if(s==="commission"){t=n.replace(/[^0-9.]/g,"");const r=t.split(".");r.length>2&&(t=r[0]+"."+r.slice(1).join(""))}x(r=>({...r,formData:{...r.formData,[s]:t}})),D(s,t,"add")},L=async a=>{a.preventDefault(),a.stopPropagation();const s=a.target;let n=!1;const{partner_type:t,commission:r}=u.formData;if((!t||t.trim().length<2)&&(l(i=>({...i,add_partner_type:"Partner type must be at least 2 characters long"})),n=!0),(!r||!P(r))&&(l(i=>({...i,add_commission:"Commission must be a number between 0 and 100"})),n=!0),!s.checkValidity()||n){x(i=>({...i,validated:!0}));return}try{await Z("/api/partner-types",u.formData)?(o("success","Partner type created successfully"),N(),b()):o("danger","Error occurred, please try again later.")}catch(i){o("danger","Error creating partner type: "+i.message)}},_=()=>{g(a=>({...a,visible:!1,validated:!1})),l({})},E=a=>{const{name:s,value:n}=a.target;let t=n;if(s==="commission"){t=n.replace(/[^0-9.]/g,"");const r=t.split(".");r.length>2&&(t=r[0]+"."+r.slice(1).join(""))}g(r=>({...r,formData:{...r.formData,[s]:t}})),D(s,t,"edit")},O=async a=>{a.preventDefault(),a.stopPropagation();const s=a.target;let n=!1;const{partner_type:t,commission:r}=m.formData;if((!t||t.trim().length<2)&&(l(i=>({...i,edit_partner_type:"Partner type must be at least 2 characters long"})),n=!0),(!r||!P(r))&&(l(i=>({...i,edit_commission:"Commission must be a number between 0 and 100"})),n=!0),!s.checkValidity()||n){g(i=>({...i,validated:!0}));return}try{await ee(`/api/partner-types/${m.formData.id}`,m.formData)?(o("success","Partner type updated successfully"),_(),b()):o("danger","Error occurred, please try again later.")}catch(i){o("danger","Error updating partner type: "+i.message)}},U=[{accessorKey:"index",header:"#",size:60,Cell:({row:a})=>a.index+1},{accessorKey:"partner_type",header:"Partner Type",size:200},{accessorKey:"commission",header:"Commission (%)",size:150,Cell:({cell:a})=>`${a.getValue()} %`},{accessorKey:"actions",header:"Actions",size:150,Cell:({cell:a})=>e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsxs(I,{role:"button",color:"info",className:"d-flex align-items-center gap-1",onClick:()=>G(a.row.original),children:[e.jsx(p,{icon:te,size:"sm"}),"Edit"]}),e.jsxs(I,{role:"button",color:"danger",className:"d-flex align-items-center gap-1",onClick:()=>K(a.row.original),children:[e.jsx(p,{icon:re,size:"sm"}),"Delete"]})]})}],W=A.map((a,s)=>({...a,index:s+1}));return e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mb-3",children:e.jsxs(w,{xs:12,className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Partner Types Management"}),e.jsxs(f,{color:"primary",onClick:H,className:"d-flex align-items-center gap-2",children:[e.jsx(p,{icon:se}),"Add Partner Type"]})]})}),e.jsxs(S,{children:[e.jsx(ae,{visible:F,setVisible:C,onYes:B,resource:`Delete partner type - ${h==null?void 0:h.partner_type}`}),e.jsx(w,{xs:12,children:e.jsx(J,{columns:U,data:W,enableFullScreenToggle:!1,enableColumnResizing:!0,enableStickyHeader:!0,initialState:{density:"xs"},enableRowNumbers:!1,state:{isLoading:q},defaultColumn:{size:130,Cell:({cell:a})=>e.jsx("div",{style:{fontSize:"12px",padding:"5px"},children:a.getValue()})},muiTableBodyCellProps:{style:{padding:"8px",fontSize:"12px"}},muiTableHeadCellProps:{style:{padding:"8px",fontSize:"13px",fontWeight:"bold"}}})})]}),u.visible&&e.jsx("div",{className:"modal d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Add New Partner Type"}),e.jsx("button",{type:"button",className:"btn-close",onClick:N})]}),e.jsx("div",{className:"modal-body",children:e.jsxs(M,{className:"needs-validation",noValidate:!0,validated:u.validated,onSubmit:L,children:[e.jsxs(j,{className:"mb-3",children:[e.jsx(y,{children:e.jsx(p,{icon:V})}),e.jsx(v,{type:"text",name:"partner_type",placeholder:"Partner Type Name (e.g., Retailer, Distributor)",value:u.formData.partner_type,onChange:k,invalid:!!d.add_partner_type,required:!0,feedbackInvalid:d.add_partner_type||"Please provide partner type name."})]}),e.jsxs(j,{className:"mb-4",children:[e.jsx(y,{children:e.jsx(p,{icon:z})}),e.jsx(v,{type:"text",name:"commission",placeholder:"Commission Percentage (e.g., 15.50)",value:u.formData.commission,onChange:k,invalid:!!d.add_commission,required:!0,feedbackInvalid:d.add_commission||"Please provide commission percentage."}),e.jsx(y,{children:"%"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(f,{color:"secondary",onClick:N,children:"Cancel"}),e.jsx(f,{color:"success",type:"submit",children:"Create Partner Type"})]})]})})]})})}),m.visible&&e.jsx("div",{className:"modal d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Edit Partner Type"}),e.jsx("button",{type:"button",className:"btn-close",onClick:_})]}),e.jsx("div",{className:"modal-body",children:e.jsxs(M,{className:"needs-validation",noValidate:!0,validated:m.validated,onSubmit:O,children:[e.jsxs(j,{className:"mb-3",children:[e.jsx(y,{children:e.jsx(p,{icon:V})}),e.jsx(v,{type:"text",name:"partner_type",placeholder:"Partner Type Name (e.g., Retailer, Distributor)",value:m.formData.partner_type,onChange:E,invalid:!!d.edit_partner_type,required:!0,feedbackInvalid:d.edit_partner_type||"Please provide partner type name."})]}),e.jsxs(j,{className:"mb-4",children:[e.jsx(y,{children:e.jsx(p,{icon:z})}),e.jsx(v,{type:"text",name:"commission",placeholder:"Commission Percentage (e.g., 15.50)",value:m.formData.commission,onChange:E,invalid:!!d.edit_commission,required:!0,feedbackInvalid:d.edit_commission||"Please provide commission percentage."}),e.jsx(y,{children:"%"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx(f,{color:"secondary",onClick:_,children:"Cancel"}),e.jsx(f,{color:"success",type:"submit",children:"Update Partner Type"})]})]})})]})})})]})};export{Ee as default};
