const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-UyVKh0wM.js","./index-2HJ-j-Kr.js","./index-BznZZSPc.css","./typeof-QjJsDpFa.js","./jspdf.plugin.autotable-CwP2yIMN.js","./jspdf.es.min-Fk_hPh8Q.js"])))=>i.map(i=>d[i]);
import{b as re,r as c,j as e,C as Z,o as se}from"./index-2HJ-j-Kr.js";import{S as le}from"./react-select.esm-BurVT27W.js";import{f as oe,a as J,b as Ne,e as Fe}from"./api-CIBCEetx.js";import{a as E,b as p,c as X}from"./index.esm-DegARfP0.js";import{P as de}from"./ProjectSelectionModal-B6GtEWMq.js";import{C as me}from"./CForm-DYbbRBNz.js";import{C as x}from"./CFormLabel-DMp8BC0Y.js";import{C as j}from"./CFormInput-DYM7ipjm.js";import{C as y}from"./CButton-ChW-yoOE.js";import{c as ue}from"./cil-search-CDkY_4k-.js";import{c as pe}from"./cil-x-0440B5Ce.js";import{C as xe}from"./CFormCheck-Dys85onz.js";import{e as je,a as ge,b as he,c as _e,d as Pe,C as ie}from"./DefaultLayout-CyVOLzSQ.js";import{C as we,a as Te}from"./CCardBody-B36NFFEm.js";import{C as qe}from"./CCardHeader-Cm87llrc.js";import{C as ke,a as Ae,b as ce,c as k,d as Ee,e as A}from"./CTable-B6LbYphX.js";import{C as Me}from"./cil-mobile-B5UOp7tH.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./emotion-react.browser.esm-Do5ntrfq.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./CFormControlWrapper-BOjiYF1h.js";import"./RawMaterial-BtjEDAbB.js";const Ie=({vendors:z,onSuccess:t,onCancel:O,editData:u=null})=>{const{showToast:C}=re(),[S,b]=c.useState({name:"",id:null}),[V,N]=c.useState([]),[G,w]=c.useState(!1),[M,I]=c.useState(!1),[r,s]=c.useState({project_id:"",vendor_id:"",material_name:"",about:"",price_per_unit:0,qty:1,total:0,date:new Date().toISOString().split("T")[0],include_gst:!1,gst_percent:18,cgst_percent:9,sgst_percent:9});c.useEffect(()=>{if(u){const i=u.gst_included===1||u.gst_percent>0,m=parseFloat(u.gst_percent)||18;s({project_id:u.project_id||"",vendor_id:u.vendor_id||"",material_name:u.material_name||"",about:u.about||"",price_per_unit:parseFloat(u.price_per_unit)||0,qty:parseFloat(u.qty)||1,total:parseFloat(u.total)||0,date:u.date||new Date().toISOString().split("T")[0],include_gst:i,gst_percent:m,cgst_percent:Number((m/2).toFixed(2)),sgst_percent:Number((m/2).toFixed(2))}),u.project&&b({name:u.project.project_name,id:u.project_id})}},[u]),c.useEffect(()=>{const i=(parseFloat(r.qty)||0)*(parseFloat(r.price_per_unit)||0);let m=i;if(r.include_gst&&r.gst_percent>0){const _=i*(parseFloat(r.gst_percent)/100);m=i+_}s(_=>({..._,total:Number(m.toFixed(2))}))},[r.qty,r.price_per_unit,r.include_gst,r.gst_percent]);const f=i=>{const m=parseFloat(i.target.value)||0;s(_=>({..._,gst_percent:m,cgst_percent:Number((m/2).toFixed(2)),sgst_percent:Number((m/2).toFixed(2))}))},T=i=>{const{name:m,value:_,type:a,checked:d}=i.target;s(a==="checkbox"?g=>({...g,[m]:d}):g=>({...g,[m]:_}))},F=async i=>{if(!i.trim()){N([]);return}try{const m=await J(`/api/projects?searchQuery=${i}`);N(m||[])}catch{C("danger","Error searching projects")}},L=i=>{const m=i.target.value;b({name:m,id:null}),F(m)},R=i=>{b({name:i.project_name,id:i.id}),s(m=>({...m,project_id:i.id})),N([])},H=async i=>{var _,a;if(i.preventDefault(),!r.project_id)return C("danger","Please select a project");if(!r.vendor_id)return C("danger","Please select a vendor");if(!r.material_name.trim())return C("danger","Enter material name");if(r.price_per_unit<=0)return C("danger","Price must be > 0");if(r.qty<=0)return C("danger","Quantity must be > 0");const m={project_id:parseInt(r.project_id),vendor_id:parseInt(r.vendor_id),material_name:r.material_name,about:r.about||null,price_per_unit:parseFloat(r.price_per_unit),qty:parseFloat(r.qty),total:parseFloat(r.total),date:r.date,paid_amount:0,gst_included:r.include_gst?1:0,gst_percent:r.include_gst?parseFloat(r.gst_percent):0,cgst_percent:r.include_gst?parseFloat(r.cgst_percent):0,sgst_percent:r.include_gst?parseFloat(r.sgst_percent):0};I(!0);try{u?(await oe("/api/updatePurchase",{...m,id:u.id}),C("success","Purchase updated successfully!")):(await oe("/api/purchesVendor",m),C("success","Purchase saved successfully!")),t()}catch(d){C("danger",((a=(_=d.response)==null?void 0:_.data)==null?void 0:a.message)||"Operation failed")}finally{I(!1)}},$=()=>{s({project_id:"",vendor_id:"",material_name:"",about:"",price_per_unit:0,qty:1,total:0,date:new Date().toISOString().split("T")[0],include_gst:!1,gst_percent:18,cgst_percent:9,sgst_percent:9}),b({name:"",id:null}),N([])};return e.jsxs(e.Fragment,{children:[e.jsx("style",{jsx:!0,global:!0,children:`
        .total-input {
          background-color: #e9f7ef !important;
          font-weight: 700;
          font-size: 1.1em;
          color: #155724;
        }
        .gst-section {
          background: #f8f9fa;
          padding: 16px;
          border-radius: 8px;
          border: 1px dashed #28a745;
        }
      `}),e.jsxs(me,{onSubmit:H,className:"needs-validation p-4",children:[e.jsxs(E,{className:"g-4 align-items-end mb-3",children:[e.jsxs(p,{md:4,style:{position:"relative"},children:[e.jsxs(x,{className:"fw-bold",children:["Project Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(j,{type:"text",placeholder:"Search project...",value:S.name,onChange:L,autoComplete:"off",required:!0,className:"pe-5"}),S.id?e.jsx(y,{color:"danger",variant:"outline",size:"sm",onClick:()=>{b({name:"",id:null}),s(i=>({...i,project_id:""}))},style:{position:"absolute",right:2,top:2,bottom:2,width:"36px"},children:e.jsx(X,{icon:pe,size:"sm"})}):e.jsx(y,{color:"primary",variant:"outline",size:"sm",onClick:()=>w(!0),style:{position:"absolute",right:2,top:2,bottom:2,width:"36px"},children:e.jsx(X,{icon:ue,size:"sm"})})]}),V.length>0&&e.jsx("ul",{className:"suggestions-list",children:V.map(i=>e.jsx("li",{onClick:()=>R(i),children:i.project_name},i.id))})]}),e.jsxs(p,{md:4,children:[e.jsxs(x,{className:"fw-bold",children:["Vendor ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{className:"form-select",name:"vendor_id",value:r.vendor_id,onChange:T,required:!0,children:[e.jsx("option",{value:"",children:"Select Vendor"}),z.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs(p,{md:4,children:[e.jsxs(x,{className:"fw-bold",children:["Material Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(j,{type:"text",name:"material_name",placeholder:"e.g. Cement, Sand",value:r.material_name,onChange:T,required:!0})]})]}),e.jsx(E,{className:"g-4 mb-3",children:e.jsxs(p,{md:12,children:[e.jsx(x,{className:"fw-bold",children:"About (optional)"}),e.jsx(j,{type:"text",name:"about",placeholder:"Enter description...",value:r.about,onChange:T})]})}),e.jsxs(E,{className:"g-4 mb-3 align-items-end",children:[e.jsxs(p,{md:3,children:[e.jsxs(x,{className:"fw-bold",children:["Price/Unit ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(j,{type:"number",name:"price_per_unit",value:r.price_per_unit,onChange:T,min:"0",step:"0.01",required:!0})]}),e.jsxs(p,{md:3,children:[e.jsxs(x,{className:"fw-bold",children:["Quantity ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(j,{type:"number",name:"qty",value:r.qty,onChange:T,min:"0.01",step:"0.01",required:!0})]}),e.jsxs(p,{md:3,children:[e.jsx(x,{className:"fw-bold",children:"Include GST?"}),e.jsx(xe,{id:"include_gst",label:"Yes, Add GST",checked:r.include_gst,onChange:T,name:"include_gst"})]}),e.jsxs(p,{md:3,children:[e.jsx(x,{className:"fw-bold",children:"Total Amount"}),e.jsx(j,{type:"number",value:r.total,readOnly:!0,className:"total-input text-success fw-bold"})]})]}),r.include_gst&&e.jsxs("div",{className:"gst-section mb-4",children:[e.jsxs(E,{className:"g-3",children:[e.jsxs(p,{md:4,children:[e.jsx(x,{children:"GST %"}),e.jsx(j,{type:"number",value:r.gst_percent,onChange:f,min:"0",step:"0.01",placeholder:"18"})]}),e.jsxs(p,{md:4,children:[e.jsx(x,{children:"CGST % (auto)"}),e.jsx(j,{type:"text",value:r.cgst_percent,readOnly:!0,className:"bg-light"})]}),e.jsxs(p,{md:4,children:[e.jsx(x,{children:"SGST % (auto)"}),e.jsx(j,{type:"text",value:r.sgst_percent,readOnly:!0,className:"bg-light"})]})]}),e.jsxs("small",{className:"text-success d-block mt-2 fw-bold",children:["GST Amount: ₹",(r.qty*r.price_per_unit*r.gst_percent/100).toFixed(2)]})]}),e.jsx(E,{className:"g-4 mb-4",children:e.jsxs(p,{md:4,children:[e.jsxs(x,{className:"fw-bold",children:["Date ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(j,{type:"date",name:"date",value:r.date,onChange:T,max:new Date().toISOString().split("T")[0],required:!0})]})}),e.jsxs(je,{className:"border-0 pt-4 justify-content-between",children:[e.jsxs("div",{children:[e.jsx(y,{color:"secondary",onClick:$,className:"me-2",children:"Clear"}),e.jsx(y,{color:"secondary",onClick:O,children:"Cancel"})]}),e.jsx(y,{color:"success",type:"submit",disabled:M,children:M?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:"sm",className:"me-2"}),"Saving..."]}):u?"Update Purchase":"Submit Purchase"})]})]}),e.jsx(de,{visible:G,onClose:()=>w(!1),onSelectProject:R})]})},ze=({visible:z,purchase:t,vendors:O,onClose:u,onSuccess:C})=>{var m,_;const{showToast:S}=re(),[b,V]=c.useState(!1),[N,G]=c.useState(!1),[w,M]=c.useState({name:"",id:null}),[I,r]=c.useState([]),[s,f]=c.useState({payment_id:(t==null?void 0:t.id)||"",vendor_id:((m=t==null?void 0:t.vendor_id)==null?void 0:m.toString())||"",project_id:((_=t==null?void 0:t.project_id)==null?void 0:_.toString())||"",material_name:(t==null?void 0:t.material_name)||"",about:(t==null?void 0:t.about)||"",price_per_unit:parseFloat(t==null?void 0:t.price_per_unit)||0,qty:parseFloat(t==null?void 0:t.qty)||1,total:parseFloat(t==null?void 0:t.total)||0,date:(t==null?void 0:t.date)||"",include_gst:(t==null?void 0:t.gst_included)===1||(t==null?void 0:t.gst_percent)>0,gst_percent:parseFloat(t==null?void 0:t.gst_percent)||18,cgst_percent:parseFloat(t==null?void 0:t.cgst_percent)||9,sgst_percent:parseFloat(t==null?void 0:t.sgst_percent)||9});c.useEffect(()=>{t!=null&&t.project&&(M({name:t.project.project_name,id:t.project_id}),f(a=>{var d;return{...a,project_id:(d=t.project_id)==null?void 0:d.toString()}}))},[t]),c.useEffect(()=>{const a=(parseFloat(s.qty)||0)*(parseFloat(s.price_per_unit)||0);let d=a;if(s.include_gst&&s.gst_percent>0){const g=a*(parseFloat(s.gst_percent)/100);d=a+g}f(g=>({...g,total:Number(d.toFixed(2))}))},[s.qty,s.price_per_unit,s.include_gst,s.gst_percent]);const T=a=>{const d=parseFloat(a.target.value)||0;f(g=>({...g,gst_percent:d,cgst_percent:Number((d/2).toFixed(2)),sgst_percent:Number((d/2).toFixed(2))}))},F=a=>{const{name:d,value:g,type:D,checked:ee}=a.target;f(K=>({...K,[d]:D==="checkbox"?ee:g}))},L=async a=>{if(!a.trim()){r([]);return}try{const d=await J(`/api/projects?searchQuery=${a}`);r(d||[])}catch{S("danger","Error searching projects")}},R=a=>{const d=a.target.value;M({name:d,id:null}),f(g=>({...g,project_id:""})),L(d)},H=a=>{M({name:a.project_name,id:a.id}),f(d=>({...d,project_id:a.id.toString()})),r([])},$=()=>{M({name:"",id:null}),f(a=>({...a,project_id:""})),r([])},i=async()=>{var d,g;if(!s.project_id)return S("danger","Please select a project");if(!s.vendor_id)return S("danger","Please select a vendor");if(!s.material_name.trim())return S("danger","Material name is required");if(s.price_per_unit<=0)return S("danger","Price must be > 0");if(s.qty<=0)return S("danger","Quantity must be > 0");const a={payment_id:parseInt(s.payment_id),vendor_id:parseInt(s.vendor_id),project_id:parseInt(s.project_id),material_name:s.material_name,about:s.about||null,price_per_unit:parseFloat(s.price_per_unit),qty:parseFloat(s.qty),total:parseFloat(s.total),date:s.date,gst_included:s.include_gst?1:0,gst_percent:s.include_gst?parseFloat(s.gst_percent):0,cgst_percent:s.include_gst?parseFloat(s.cgst_percent):0,sgst_percent:s.include_gst?parseFloat(s.sgst_percent):0};V(!0);try{await Ne("/api/updatePurchesVendorPayment",a),S("success","Purchase updated successfully!"),C(),u()}catch(D){S("danger","Update failed: "+(((g=(d=D.response)==null?void 0:d.data)==null?void 0:g.message)||D.message))}finally{V(!1)}};return e.jsxs(ge,{visible:z,onClose:u,backdrop:"static",size:"xl",children:[e.jsx(he,{closeButton:!0,children:e.jsx(_e,{children:"Edit Purchase"})}),e.jsx(Pe,{children:e.jsxs(me,{children:[e.jsxs(E,{className:"g-4 mb-3 align-items-end",children:[e.jsxs(p,{md:6,style:{position:"relative"},children:[e.jsxs(x,{className:"fw-bold",children:["Project ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(j,{type:"text",placeholder:"Search project...",value:w.name,onChange:R,autoComplete:"off",required:!0,className:"pe-5"}),w.id?e.jsx(y,{color:"danger",variant:"outline",size:"sm",onClick:$,style:{position:"absolute",right:2,top:2,bottom:2,width:"36px"},children:e.jsx(X,{icon:pe,size:"sm"})}):e.jsx(y,{color:"primary",variant:"outline",size:"sm",onClick:()=>G(!0),style:{position:"absolute",right:2,top:2,bottom:2,width:"36px"},children:e.jsx(X,{icon:ue,size:"sm"})})]}),I.length>0&&e.jsx("ul",{className:"list-group position-absolute z-index-1000 w-100 mt-1",style:{maxHeight:"200px",overflowY:"auto"},children:I.map(a=>e.jsx("li",{className:"list-group-item list-group-item-action",style:{cursor:"pointer"},onClick:()=>H(a),children:a.project_name},a.id))})]}),e.jsxs(p,{md:6,children:[e.jsxs(x,{className:"fw-bold",children:["Vendor ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{className:"form-select",name:"vendor_id",value:s.vendor_id,onChange:F,required:!0,children:[e.jsx("option",{value:"",children:"Select Vendor"}),O.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsx(E,{className:"g-3 mb-3",children:e.jsxs(p,{md:12,children:[e.jsxs(x,{className:"fw-bold",children:["Material Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(j,{type:"text",name:"material_name",value:s.material_name,onChange:F,required:!0})]})}),e.jsx(E,{className:"g-3 mb-3",children:e.jsxs(p,{md:12,children:[e.jsx(x,{children:"About (optional)"}),e.jsx(j,{type:"text",name:"about",placeholder:"Description...",value:s.about,onChange:F})]})}),e.jsxs(E,{className:"g-3 mb-3 align-items-end",children:[e.jsxs(p,{md:3,children:[e.jsx(x,{children:"Price/Unit *"}),e.jsx(j,{type:"number",name:"price_per_unit",value:s.price_per_unit,onChange:F,min:"0",step:"0.01",required:!0})]}),e.jsxs(p,{md:3,children:[e.jsx(x,{children:"Quantity *"}),e.jsx(j,{type:"number",name:"qty",value:s.qty,onChange:F,min:"0.01",step:"0.01",required:!0})]}),e.jsxs(p,{md:3,children:[e.jsx(x,{children:"Include GST?"}),e.jsx(xe,{id:"include_gst_edit",label:"Yes, Add GST",checked:s.include_gst,onChange:F,name:"include_gst"})]}),e.jsxs(p,{md:3,children:[e.jsx(x,{children:"Total Amount"}),e.jsx(j,{type:"text",value:`₹${s.total.toFixed(2)}`,readOnly:!0,className:"bg-success text-white fw-bold"})]})]}),s.include_gst&&e.jsxs("div",{style:{background:"#f8f9fa",padding:"16px",borderRadius:"8px",border:"1px dashed #28a745"},className:"mb-3",children:[e.jsxs(E,{className:"g-3",children:[e.jsxs(p,{md:4,children:[e.jsx(x,{children:"GST %"}),e.jsx(j,{type:"number",value:s.gst_percent,onChange:T,min:"0",step:"0.01"})]}),e.jsxs(p,{md:4,children:[e.jsx(x,{children:"CGST % (auto)"}),e.jsx(j,{type:"text",value:s.cgst_percent,readOnly:!0,className:"bg-light"})]}),e.jsxs(p,{md:4,children:[e.jsx(x,{children:"SGST % (auto)"}),e.jsx(j,{type:"text",value:s.sgst_percent,readOnly:!0,className:"bg-light"})]})]}),e.jsxs("small",{className:"text-success fw-bold d-block mt-2",children:["GST Amount: ₹",(s.qty*s.price_per_unit*s.gst_percent/100).toFixed(2)]})]}),e.jsx(E,{className:"g-3",children:e.jsxs(p,{md:4,children:[e.jsx(x,{children:"Date *"}),e.jsx(j,{type:"date",name:"date",value:s.date,onChange:F,max:new Date().toISOString().split("T")[0],required:!0})]})})]})}),e.jsxs(je,{children:[e.jsx(y,{color:"secondary",onClick:u,children:"Cancel"}),e.jsx(y,{color:"primary",onClick:i,disabled:b,children:b?e.jsx(Z,{size:"sm",className:"me-2"}):"Update Purchase"})]}),e.jsx(de,{visible:N,onClose:()=>G(!1),onSelectProject:H})]})},lt=()=>{const[z,t]=c.useState([]),[O,u]=c.useState([]),[C,S]=c.useState([]),[b,V]=c.useState(!1),[N,G]=c.useState(!1),[w,M]=c.useState(!0),[I,r]=c.useState(null),[s,f]=c.useState(!1),[T,F]=c.useState(!1),[L,R]=c.useState(null),[H,$]=c.useState(!1),[i,m]=c.useState(null),{showToast:_}=re(),a=Fe(),[d,g]=c.useState(null),[D,ee]=c.useState(null),K=c.useRef(null),be=async()=>{try{const n=await J("/api/getPurchesVendor");u(n||[])}catch{_("danger","Error loading vendors")}},fe=async()=>{try{const n=await J("/api/projects");S(n||[])}catch{_("danger","Failed to load projects")}},te=async(n=null,o=!1)=>{try{o?G(!0):V(!0);const v=n?`/api/purchesVendor?cursor=${n}&perPage=10`:"/api/purchesVendor?perPage=10",P=await J(v),U=(P==null?void 0:P.data)||[];t(o?Q=>[...Q,...U]:U),r(P.next_cursor),M(P.has_more_pages)}catch{_("danger","Failed to load purchases"),o||t([])}finally{V(!1),G(!1)}};c.useEffect(()=>{be(),fe(),te()},[]);const ne=c.useCallback(()=>{!N&&!b&&w&&I&&te(I,!0)},[N,b,w,I]);c.useEffect(()=>{const n=new IntersectionObserver(v=>{v[0].isIntersecting&&w&&!N&&!b&&ne()},{threshold:.1,rootMargin:"100px"}),o=K.current;return o&&n.observe(o),()=>{o&&n.unobserve(o)}},[w,N,b,ne]);const ae=()=>{t([]),r(null),M(!0),te()},ye=n=>{R(n),F(!0)},Ce=n=>{m(n),$(!0)},q=z.filter(n=>{const o=d?n.project_id===d.value:!0,v=D?n.vendor_id===D.value:!0;return o&&v}),Se=()=>{se(()=>import("./jspdf.es.min-UyVKh0wM.js").then(n=>n.j),__vite__mapDeps([0,1,2,3]),import.meta.url).then(n=>{se(()=>import("./jspdf.plugin.autotable-CwP2yIMN.js").then(o=>o.j),__vite__mapDeps([4,1,2,5,0,3]),import.meta.url).then(()=>{const o=new n.jsPDF("landscape");o.setFont("helvetica","bold"),o.setFontSize(18),o.text("PURCHASE REPORT",14,15),o.setFontSize(11),o.setFont("helvetica","normal"),o.text(`Generated On: ${new Date().toLocaleDateString()}`,14,25),o.setFontSize(12),o.setFont("helvetica","bold"),o.text(`Total Records: ${q.length}`,14,33);const v=q.reduce((l,h)=>l+Number(h.qty||0),0),P=q.reduce((l,h)=>l+Number(h.total||0),0),U=q.reduce((l,h)=>l+Number(h.price_per_unit||0),0),Q=["Sr No","Project","Vendor","Material","Price/Unit","Qty","Total","Date","About"],B=[];q.forEach((l,h)=>{var Y,W;B.push([h+1,((Y=l.project)==null?void 0:Y.project_name)||"—",((W=l.vendor)==null?void 0:W.name)||"—",l.material_name,parseFloat(l.price_per_unit).toFixed(2),l.qty,parseFloat(l.total).toFixed(2),new Date(l.date).toLocaleDateString(),l.about||"—"])}),B.push([{content:"Total:",colSpan:4,styles:{halign:"right",fontStyle:"bold"}},U.toFixed(2),v,P.toFixed(2),"",""]),o.autoTable({head:[Q],body:B,startY:45,theme:"grid",headStyles:{fillColor:[30,115,120],textColor:255,fontSize:10,halign:"center"},bodyStyles:{fontSize:9,halign:"center"},styles:{lineWidth:.25,lineColor:[120,120,120]},alternateRowStyles:{fillColor:[245,245,245]},didDrawPage:l=>{const h=o.internal.pageSize.height;o.setFontSize(10),o.setTextColor(100),o.text(`Purchase Report | Generated: ${new Date().toLocaleDateString()}`,l.settings.margin.left,h-10),o.text(`Page ${o.internal.getNumberOfPages()}`,o.internal.pageSize.width-30,h-10)}}),o.save("purchase_report.pdf")})})},ve=()=>{se(()=>import("./xlsx-B6sNpj_1.js"),[],import.meta.url).then(n=>{const o=q.reduce((l,h)=>l+Number(h.qty||0),0),v=q.reduce((l,h)=>l+Number(h.total||0),0),P=q.reduce((l,h)=>l+Number(h.price_per_unit||0),0),U=q.map((l,h)=>{var Y,W;return{"Sr No":h+1,Project:((Y=l.project)==null?void 0:Y.project_name)||"—",Vendor:((W=l.vendor)==null?void 0:W.name)||"—",Material:l.material_name,"Price/Unit":parseFloat(l.price_per_unit).toFixed(2),Qty:l.qty,Total:parseFloat(l.total).toFixed(2),Date:new Date(l.date).toLocaleDateString(),About:l.about||"—"}});U.push({"Sr No":"",Project:"",Vendor:"",Material:"Total:","Price/Unit":P.toFixed(2),Qty:o,Total:v.toFixed(2),Date:"",About:""});const Q=n.utils.json_to_sheet(U);Object.keys(Q).forEach(l=>{(l.startsWith("A1")||l.startsWith("B1")||l.startsWith("C1"))&&(Q[l].s={font:{bold:!0}})});const B=n.utils.book_new();n.utils.book_append_sheet(B,Q,"Purchases"),n.writeFile(B,"purchase_report.xlsx")})};return e.jsxs(e.Fragment,{children:[e.jsxs(we,{className:"mb-4",children:[e.jsxs(qe,{className:"d-flex justify-content-between align-items-center flex-wrap gap-3",style:{paddingBottom:"1rem"},children:[e.jsx("strong",{children:"Purchase History"}),e.jsxs("div",{className:"d-flex align-items-center gap-3 flex-wrap",children:[e.jsx(y,{color:"primary",onClick:Se,children:"Download PDF"}),e.jsx(y,{color:"info",onClick:ve,children:"Download Excel"}),e.jsx("div",{style:{width:200},children:e.jsx(le,{placeholder:"Filter by Project",options:C.map(n=>({value:n.id,label:n.project_name})),value:d,onChange:g,isClearable:!0})}),e.jsx("div",{style:{width:200},children:e.jsx(le,{placeholder:"Filter by Vendor",options:O.map(n=>({value:n.id,label:n.name})),value:D,onChange:ee,isClearable:!0})}),e.jsx(y,{color:"success",onClick:()=>f(!0),children:"Add Purchase"})]})]}),e.jsx(Te,{children:b&&z.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx(Z,{})}):q.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(ke,{striped:!0,hover:!0,bordered:!0,children:[e.jsx(Ae,{color:"light",children:e.jsxs(ce,{children:[e.jsx(k,{children:"Sr. No."}),e.jsx(k,{children:"Project"}),e.jsx(k,{children:"Vendor"}),e.jsx(k,{children:"Material"}),e.jsx(k,{children:"Price/Unit"}),e.jsx(k,{children:"Qty"}),e.jsx(k,{children:"Total"}),e.jsx(k,{children:"Include GST"}),e.jsx(k,{children:"Date"}),e.jsx(k,{children:"About"}),e.jsx(k,{children:"Action"})]})}),e.jsx(Ee,{children:q.map((n,o)=>{var v,P;return e.jsxs(ce,{children:[e.jsx(A,{children:o+1}),e.jsx(A,{children:((v=n.project)==null?void 0:v.project_name)||"—"}),e.jsx(A,{children:((P=n.vendor)==null?void 0:P.name)||"—"}),e.jsx(A,{children:n.material_name}),e.jsxs(A,{children:["₹",parseFloat(n.price_per_unit).toFixed(2)]}),e.jsx(A,{children:n.qty}),e.jsx(A,{children:e.jsxs("strong",{children:["₹",parseFloat(n.total).toFixed(2)]})}),e.jsx(A,{children:n.gst_included?e.jsx(ie,{color:"success",children:"Yes"}):e.jsx(ie,{color:"danger",children:"No"})}),e.jsx(A,{children:new Date(n.date).toLocaleDateString()}),e.jsx(A,{children:n.about||"—"}),e.jsxs(A,{children:[e.jsx(y,{color:"warning",size:"sm",className:"me-2",onClick:()=>ye(n),children:"Edit"}),a===1&&e.jsx(y,{color:"danger",size:"sm",onClick:()=>Ce(n.id),children:"Delete"})]})]},n.id)})})]})}),e.jsxs("div",{ref:K,style:{height:"20px",margin:"20px 0"},children:[N&&e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{size:"sm",className:"me-2"}),e.jsx("span",{className:"text-muted small",children:"Loading more purchases..."})]}),!w&&z.length>0&&e.jsxs("div",{className:"text-center text-muted small",children:[e.jsx("hr",{}),e.jsxs("p",{children:["All ",z.length," purchases loaded"]})]})]})]}):e.jsx(Me,{color:"info",className:"text-center",children:"No matching purchases found."})})]}),e.jsxs(ge,{size:"xl",visible:s,onClose:()=>f(!1),backdrop:"static",children:[e.jsx(he,{closeButton:!0,children:e.jsx(_e,{children:"Add New Purchase"})}),e.jsx(Ie,{vendors:O,onSuccess:()=>{f(!1),ae()},onCancel:()=>f(!1)})]}),L&&e.jsx(ze,{visible:T,purchase:L,vendors:O,onClose:()=>{F(!1),R(null)},onSuccess:ae})]})};export{lt as default};
