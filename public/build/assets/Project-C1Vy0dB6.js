import{r as t,b as K,j as e,u as O}from"./index-DkVkGOCn.js";import{e as I,a as V,b as W,d as Q}from"./api-CIBCEetx.js";import{S as X}from"./react-select.esm-DH4MyRa-.js";import{a as L,b as $,d as G,e as Y,c as Z,C as ee}from"./DefaultLayout-BgphJYJL.js";import{a as P,b as r}from"./index.esm-cOQ_-zh5.js";import{C as m}from"./CFormInput-DPw0cP7s.js";import{C as se}from"./CFormLabel-uqQeaLEa.js";import{C as ae}from"./CFormTextarea-Wt90fyhD.js";import{C as T}from"./CFormSwitch-CEJFJgZs.js";import{C as x}from"./CButton-Bx6A1OAo.js";import{C as U,a as H}from"./CCardBody-kTNIg812.js";import{C as le}from"./CCardHeader-DNnmeqn8.js";import{C as w}from"./cil-mobile-Bth8NvRk.js";import{C as re,a as ne,b as A,c,d as ie,e as i}from"./CTable-QHmTbIS6.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./emotion-react.browser.esm-DVNDhfws.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./RawMaterial-BtjEDAbB.js";import"./CFormControlWrapper-Bc0rLHg6.js";const te=({project:d,onClose:g,onUpdateSuccess:v})=>{const[l,f]=t.useState({...d,start_date:d.start_date?d.start_date.split("T")[0]:"",end_date:d.end_date?d.end_date.split("T")[0]:""}),{showToast:u}=K(),h=I(),[N,_]=t.useState([]),k=async()=>{try{const a=await V("/api/usersData");_((a==null?void 0:a.users)||[])}catch(a){console.error("Error fetching users:",a),_([])}};t.useEffect(()=>{(h===1||h===3)&&k()},[h]);const n=a=>{const{name:y,value:b,type:p,checked:E}=a.target;f(C=>({...C,[y]:p==="checkbox"?E?1:0:b}))},D=async()=>{try{(await W(`/api/projectsUpdate/${l.id}`,l)).success&&(u("success","Project updated successfully"),v())}catch(a){console.error("Error updating project:",a),u("danger","Error updating project")}};return e.jsxs(L,{visible:!0,onClose:g,alignment:"center",size:"lg",backdrop:"static",keyboard:!0,scrollable:!0,children:[e.jsx($,{closeButton:!0,children:e.jsx("strong",{children:"Update Project"})}),e.jsx(G,{className:"p-3 p-md-4",children:e.jsxs(P,{className:"g-3",children:[e.jsx(r,{xs:12,md:6,children:e.jsx(m,{label:"Customer Name",name:"customer_name",value:l.customer_name||"",onChange:n})}),e.jsx(r,{xs:12,md:6,children:e.jsx(m,{label:"Mobile Number",name:"mobile_number",type:"tel",value:l.mobile_number||"",onChange:n})}),e.jsx(r,{xs:12,md:6,children:e.jsx(m,{label:"Project Name",name:"project_name",value:l.project_name||"",onChange:n})}),e.jsx(r,{xs:12,md:6,children:e.jsx(m,{label:"Project Cost",name:"project_cost",type:"number",value:l.project_cost||"",onChange:n})}),e.jsx(r,{xs:12,md:6,children:e.jsx(m,{label:"Work Place",name:"work_place",value:l.work_place||"",onChange:n})}),e.jsx(r,{xs:12,md:6,children:e.jsx(m,{type:"date",label:"Start Date",name:"start_date",value:l.start_date||"",onChange:n})}),e.jsx(r,{xs:12,md:6,children:e.jsx(m,{type:"date",label:"End Date",name:"end_date",value:l.end_date||"",onChange:n})}),(h===1||h===3)&&e.jsxs(r,{xs:12,md:6,children:[e.jsx(se,{children:"Supervisor"}),e.jsx(X,{options:N.map(a=>({value:a.id,label:a.name})),value:N.map(a=>({value:a.id,label:a.name})).find(a=>a.value===l.supervisor_id)||null,onChange:a=>f(y=>({...y,supervisor_id:a?a.value:""})),placeholder:"Select Supervisor",isClearable:!0})]}),e.jsx(r,{xs:12,md:6,children:e.jsx(m,{label:"Commission",name:"commission",type:"number",value:l.commission||"",onChange:n})}),e.jsx(r,{xs:12,md:6,children:e.jsx(m,{label:"GST Number",name:"gst_number",value:l.gst_number||"",onChange:n})}),e.jsx(r,{xs:12,md:6,children:e.jsx(m,{label:"PAN Number",name:"pan_number",value:l.pan_number||"",onChange:n})}),e.jsx(r,{xs:12,children:e.jsx(ae,{label:"Remark",name:"remark",rows:3,value:l.remark||"",onChange:n})}),e.jsx(r,{xs:12,children:e.jsx(T,{id:"is_visible",label:"Visible",name:"is_visible",checked:l.is_visible===1||l.is_visible===!0,onChange:n})})]})}),e.jsxs(Y,{className:"d-flex gap-2",children:[e.jsx(x,{color:"secondary",onClick:g,children:"Cancel"}),e.jsx(x,{color:"primary",onClick:D,children:"Save Changes"})]})]})},Pe=()=>{const[d,g]=t.useState([]),[v,l]=t.useState(!1),[f,u]=t.useState({}),[h,N]=t.useState(""),_=O(),[k,n]=t.useState(null),[D,a]=t.useState(!1),[y,b]=t.useState(!1),[p,E]=t.useState(null),C=I(),M=s=>{n(s),a(!0)},S=async()=>{var s,o;try{l(!0);const j=await V("/api/myProjects");g(Array.isArray(j)?j:[]),u({})}catch(j){console.error("Error fetching projects:",j),g([]),u({general:((o=(s=j.response)==null?void 0:s.data)==null?void 0:o.message)||"Failed to fetch projects. Please check the server and try again."})}finally{l(!1)}};t.useEffect(()=>{S()},[]);const F=async(s,o)=>{var j,z;try{l(!0),await W(`/api/projects/${s}`,{is_visible:!o}),N("Project visibility updated successfully!"),await S()}catch(R){console.error("Error updating visibility:",R),u({general:((z=(j=R.response)==null?void 0:j.data)==null?void 0:z.message)||"Failed to update project visibility."})}finally{l(!1)}},B=s=>{E(s),b(!0)},q=async()=>{try{await Q(`/api/projectsDelete/${p.id}`),b(!1),N("Project deleted successfully!"),S()}catch(s){console.log("Delete error:",s),u({general:"Failed to delete project."})}},J=({project:s})=>{var o;return e.jsx(U,{className:"mb-3",children:e.jsxs(H,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:s.project_name}),e.jsxs("small",{className:"text-muted",children:["ID: ",s.id]})]}),e.jsx(ee,{color:s.is_visible?"success":"secondary",children:s.is_visible?"Visible":"Hidden"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted d-block",children:"Customer"}),e.jsx("div",{children:s.customer_name})]}),e.jsxs(P,{className:"mb-2",children:[e.jsxs(r,{xs:"6",children:[e.jsx("small",{className:"text-muted d-block",children:"Work Place"}),e.jsx("div",{className:"small",children:s.work_place})]}),e.jsxs(r,{xs:"6",children:[e.jsx("small",{className:"text-muted d-block",children:"Supervisor"}),e.jsx("div",{className:"small",children:((o=s.supervisor)==null?void 0:o.name)||"N/A"})]})]}),e.jsxs(P,{className:"mb-2",children:[e.jsxs(r,{xs:"6",children:[e.jsx("small",{className:"text-muted d-block",children:"Start Date"}),e.jsx("div",{className:"small",children:s.start_date||"N/A"})]}),e.jsxs(r,{xs:"6",children:[e.jsx("small",{className:"text-muted d-block",children:"End Date"}),e.jsx("div",{className:"small",children:s.end_date||"N/A"})]})]}),e.jsxs(P,{className:"mb-3",children:[e.jsxs(r,{xs:"6",children:[e.jsx("small",{className:"text-muted d-block",children:"Commission"}),e.jsx("div",{className:"small",children:s.commission||"N/A"})]}),e.jsxs(r,{xs:"6",children:[e.jsx("small",{className:"text-muted d-block",children:"Remark"}),e.jsx("div",{className:"small text-truncate",children:s.remark||"N/A"})]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("small",{className:"text-muted me-2",children:"Visibility:"}),e.jsx(T,{checked:s.is_visible,onChange:()=>F(s.id,s.is_visible),disabled:v})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(x,{color:"warning",size:"sm",onClick:()=>M(s),children:"Edit"}),(C===1||C===3)&&e.jsx(x,{color:"danger",size:"sm",onClick:()=>B(s),children:"Delete"})]})]})]})})};return e.jsx("div",{className:"container-fluid p-2 p-md-3",children:e.jsxs(U,{children:[e.jsxs(le,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Projects"}),e.jsx(x,{color:"danger",onClick:()=>_("/projects/new"),children:"New Project"})]}),e.jsxs(H,{children:[h&&e.jsx(w,{color:"success",children:h}),f.general&&e.jsx(w,{color:"danger",children:f.general}),v&&e.jsx(w,{color:"info",children:"Loading projects..."}),e.jsx("div",{className:"d-none d-lg-block",children:e.jsx("div",{className:"table-responsive",children:e.jsxs(re,{hover:!0,children:[e.jsx(ne,{children:e.jsxs(A,{children:[e.jsx(c,{children:"ID"}),e.jsx(c,{children:"Customer Name"}),e.jsx(c,{children:"Project Name"}),e.jsx(c,{children:"Work Place"}),e.jsx(c,{children:"Start Date"}),e.jsx(c,{children:"End Date"}),e.jsx(c,{children:"Supervisor"}),e.jsx(c,{children:"Remark"}),e.jsx(c,{children:"Commission"}),e.jsx(c,{children:"Visible"}),e.jsx(c,{children:"Action"})]})}),e.jsx(ie,{children:d.length>0?d.map(s=>{var o;return e.jsxs(A,{children:[e.jsx(i,{children:s.id}),e.jsx(i,{children:s.customer_name}),e.jsx(i,{children:s.project_name}),e.jsx(i,{children:s.work_place}),e.jsx(i,{children:s.start_date||"N/A"}),e.jsx(i,{children:s.end_date||"N/A"}),e.jsx(i,{children:((o=s.supervisor)==null?void 0:o.name)||"N/A"}),e.jsx(i,{children:e.jsx("div",{style:{maxWidth:"150px"},className:"text-truncate",children:s.remark||"N/A"})}),e.jsx(i,{children:s.commission||"N/A"}),e.jsx(i,{children:e.jsx(T,{checked:s.is_visible,onChange:()=>F(s.id,s.is_visible),disabled:v})}),e.jsx(i,{children:e.jsxs("div",{className:"d-flex gap-2 flex-nowrap",children:[e.jsx(x,{color:"warning",size:"sm",onClick:()=>M(s),children:"Edit"}),(C===1||C===3)&&e.jsx(x,{color:"danger",size:"sm",onClick:()=>B(s),children:"Delete"})]})})]},s.id)}):e.jsx(A,{children:e.jsx(i,{colSpan:"11",className:"text-center",children:"No projects found."})})})]})})}),e.jsx("div",{className:"d-lg-none",children:d.length>0?d.map(s=>e.jsx(J,{project:s},s.id)):e.jsx(w,{color:"info",className:"text-center",children:"No projects found."})}),D&&k&&e.jsx(te,{project:k,onClose:()=>a(!1),onUpdateSuccess:()=>{a(!1),S()}}),e.jsxs(L,{visible:y,onClose:()=>b(!1),children:[e.jsx($,{closeButton:!0,children:e.jsxs(Z,{children:["Delete Project - ",p==null?void 0:p.project_name,"?"]})}),e.jsx(G,{children:e.jsxs("p",{style:{fontSize:"16px"},children:["Do you really want to"," ",e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"Delete"})," ","this project?"]})}),e.jsxs(Y,{children:[e.jsx(x,{color:"secondary",onClick:()=>b(!1),children:"Close"}),e.jsx(x,{color:"primary",onClick:q,children:"Yes"})]})]})]})]})})};export{Pe as default};
