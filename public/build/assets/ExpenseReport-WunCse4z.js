import{u as et,b as tt,r as c,j as e,C as Ee}from"./index-DsLCqE06.js";import{e as st,a as Ge,d as rt,b as ot}from"./api-CIBCEetx.js";import{C as nt}from"./ConfirmationModal-C6oh5Dtx.js";import{E as lt}from"./EditExpense-B8-xza7Y.js";import{E as ct}from"./jspdf.es.min-cKyHKAYl.js";import"./jspdf.plugin.autotable-B41L-UUw.js";import{utils as w,writeFile as at}from"./xlsx-B6sNpj_1.js";import{u as it,a as dt,b as ht,c as mt,d as pt,e as ut,C as pe}from"./DefaultLayout-5pHqimqm.js";import{C as Se}from"./CButton-DirJQzUR.js";import{a as Le,b as be}from"./index.esm-BlJU5mne.js";import{C as Me,a as Ie}from"./CCardBody-DQWRa7c4.js";import{C as gt}from"./CCardHeader-PfItfEOJ.js";import{C as xt}from"./CForm-D8EjkW87.js";import{C as ue}from"./CFormLabel-CVJu7LBr.js";import{C as Pe}from"./CFormSelect-84oUtJFR.js";import{C as qe}from"./CFormInput-Db5B42Su.js";import{C as jt,a as yt,b as Ae,c as y,d as ft,e as j}from"./CTable-BAKI_IEN.js";import"./Feilds-BHjWXeSc.js";import"./typeof-QjJsDpFa.js";import"./jspdf.es.min-ButOjYP_.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-CNtzZ120.js";import"./CFormControlWrapper-D9cjubv0.js";const _t=(m,ce,V,G,z,H,i,ge,W,Q,U,O,Y,xe)=>{const a=new ct({orientation:"landscape",unit:"pt",format:"a4"}),x=a.internal.pageSize.getWidth(),k=a.internal.pageSize.getHeight(),F=40,A=T=>{a.setFontSize(18),a.setFont(void 0,"bold"),a.text("EXPENSE REPORT",x/2,30,{align:"center"}),a.setFontSize(10),a.setFont(void 0,"normal");const S=m.start_date||"All",C=m.end_date||"All",B=new Date().toLocaleDateString("en-GB");return a.text(`Period: ${S} to ${C}`,x/2,48,{align:"center"}),a.text(`Generated on: ${B}`,x/2,62,{align:"center"}),a.setLineWidth(1),a.line(F,70,x-F,70),80};let l=A(),Z=1;const f=ce.find(T=>T.id===parseInt(m.project_id));V.find(T=>T.id===parseInt(m.expense_type_id));const K=Q+U+O;l>k-100&&(a.addPage(),Z++,l=A()),a.setFillColor(231,76,60),a.setDrawColor(192,57,43),a.setLineWidth(2),a.rect(F,l,x-F*2,35,"FD"),a.setFontSize(10),a.setFont(void 0,"bold"),a.setTextColor(255,255,255);const P=`Grand Total of Expenses :   Amount: Rs ${i(G)} | GST: Rs ${i(K)} | CGST: Rs ${i(Q)} | SGST: Rs ${i(U)} | IGST: Rs ${i(O)}`;a.text(P,x/2,l+23,{align:"center"}),l+=45;let v={};f?v[f.project_name]=z:z.forEach(T=>{var C;const S=((C=T.project)==null?void 0:C.project_name)||"No Project";v[S]||(v[S]=[]),v[S].push(T)}),Object.keys(v).forEach((T,S)=>{const C=v[T];l>k-200&&(a.addPage(),Z++,l=A()),a.setFillColor(41,128,185),a.rect(F,l,x-F*2,20,"F"),a.setFontSize(11),a.setFont(void 0,"bold"),a.setTextColor(255,255,255),a.text(`Project: ${T}`,F+10,l+14),l+=25;const B=["Sr","Date","Expense Type","Category","Qty","Price","Base Amount","GST Rs","CGST Rs","SGST Rs","IGST Rs","Total","Payment By","Payment Type","Contact","Bank","Account","IFSC","Txn ID","About"],L=C.map((o,p)=>{var te,D;return[p+1,ge(o.expense_date),((te=o.expense_type)==null?void 0:te.name)||H[o.expense_id]||"-",((D=o.expense_type)==null?void 0:D.expense_category)||"-",o.qty||"-",i(o.price||0),i((o.qty||0)*(o.price||0)),o.isGst?i(o.gst||0):"-",o.isGst?i(o.cgst||0):"-",o.isGst?i(o.sgst||0):"-",o.isGst?i(o.igst||0):"-",i(o.total_price||0),o.payment_by||"-",o.payment_type||"-",o.contact||"-",o.bank_name||"-",o.account_number||"-",o.ifsc_code||"-",o.transaction_id||"-",o.name||"-"]}),ee=C.reduce((o,p)=>o+parseFloat(p.total_price||0),0),ae=C.reduce((o,p)=>o+parseFloat(p.qty||0),0),s=C.reduce((o,p)=>o+(p.qty||0)*(p.price||0),0),h=C.reduce((o,p)=>o+parseFloat(p.gst||0),0),N=C.reduce((o,p)=>o+parseFloat(p.cgst||0),0),E=C.reduce((o,p)=>o+parseFloat(p.sgst||0),0),b=C.reduce((o,p)=>o+parseFloat(p.igst||0),0);L.push([{content:"Total:",colSpan:4,styles:{fontStyle:"bold",halign:"right"}},ae,"-",i(s),i(h),i(N),i(E),i(b),i(ee),"","","","","","",""]),a.autoTable({head:[B],body:L,startY:l,theme:"grid",styles:{fontSize:7,cellPadding:3,halign:"center",valign:"middle",lineWidth:.5,lineColor:[200,200,200]},headStyles:{fillColor:[52,73,94],textColor:255,fontStyle:"bold",fontSize:7,halign:"center"},footStyles:{fillColor:[236,240,241],textColor:[0,0,0],fontStyle:"bold"},margin:{left:F,right:F},tableWidth:x-F*2,alternateRowStyles:{fillColor:[249,249,249]},didDrawPage:o=>{a.setFontSize(8),a.setTextColor(128,128,128),a.text(`Page ${Z}`,x/2,k-20,{align:"center"})}}),l=a.lastAutoTable.finalY+20}),a.setFontSize(8),a.setTextColor(128,128,128),a.text(`Expense Report | Period: ${m.start_date||"All"} to ${m.end_date||"All"} | Generated: ${new Date().toLocaleDateString("en-GB")}`,x/2,k-20,{align:"center"});const $=`Expense_Report_${m.start_date||"All"}_to_${m.end_date||"All"}_${new Date().toISOString().split("T")[0]}.pdf`;a.save($),W("success","PDF file downloaded successfully!")},Ct=(m,ce,V,G,z,H,i,ge,W,Q,U,O,Y,xe,a)=>{W("info","Preparing Excel file with images...");try{const x=w.book_new(),k=z.map((s,h)=>{var se,q,fe;const N=s.photo_url&&s.photo_url!=="NA"?`${Q}/${s.photo_url.replace(/\\/g,"/")}`:"-",E=s.photo_url&&s.photo_url!=="NA"?s.photo_url.split("/").pop():"-",b=parseFloat(s.price||0),o=parseFloat(s.qty||0),p=b*o,te=parseFloat(s.gst||0),D=parseFloat(s.cgst||0),je=parseFloat(s.sgst||0),g=parseFloat(s.igst||0),ye=s.isGst?p*D/100:0,X=s.isGst?p*je/100:0,M=s.isGst?p*g/100:0,I=ye+X+M;return{"Sr No":h+1,Date:ge(s.expense_date),Project:((se=s.project)==null?void 0:se.project_name)||"-","Expense Type":((q=s.expense_type)==null?void 0:q.name)||H[s.expense_id]||"-","Expense Category":((fe=s.expense_type)==null?void 0:fe.expense_category)||"-",Qty:s.qty||"-",Price:s.price?i(s.price):"-","Base Amount":i(p),"Payment By":s.payment_by||"-","Payment Type":s.payment_type||"-",Contact:s.contact||"-","Bank Name":s.bank_name||"-","Account Number":s.account_number||"-","IFSC Code":s.ifsc_code||"-","Transaction ID":s.transaction_id||"-",About:s.name||"-",Notes:s.photo_remark||"-","Photo/PDF":E,"GST (%)":s.isGst&&te||"-","CGST (%)":s.isGst&&D||"-","CGST Amount":s.isGst?i(ye):"-","SGST (%)":s.isGst&&je||"-","SGST Amount":s.isGst?i(X):"-","IGST (%)":s.isGst&&g||"-","IGST Amount":s.isGst?i(M):"-","Total GST":s.isGst?i(I):"-","Total Amount":i(s.total_price||p+I)}});k.push({"Sr No":"",Date:"",Project:"","Expense Type":"","Expense Category":"Total",Qty:xe,Price:"","Base Amount":i(a),"Payment By":"","Payment Type":"",Contact:"","Bank Name":"","Account Number":"","IFSC Code":"","Transaction ID":"",About:"",Notes:"","Photo/PDF":"","GST (%)":"","CGST (%)":"","CGST Amount":i(U),"SGST (%)":"","SGST Amount":i(O),"IGST (%)":"","IGST Amount":i(Y),"Total GST":i(U+O+Y),"Total Amount":i(G)});const F=[["EXPENSE REPORT"],[`Period: ${m.start_date||"All"} to ${m.end_date||"All"}`],[`Generated on: ${new Date().toLocaleDateString("en-GB")}`],[""]],A=["Sr No","Date","Project","Expense Type","Expense Category","Qty","Price","Base Amount","Payment By","Payment Type","Contact","Bank Name","Account Number","IFSC Code","Transaction ID","About","Notes","Photo/PDF","GST (%)","CGST (%)","CGST Amount","SGST (%)","SGST Amount","IGST (%)","IGST Amount","Total GST","Total Amount"],l=w.aoa_to_sheet([]);w.sheet_add_aoa(l,F,{origin:"A1"}),w.sheet_add_aoa(l,[A],{origin:"A5"}),w.sheet_add_json(l,k,{origin:"A6",skipHeader:!0}),l["!cols"]=[{wch:6},{wch:12},{wch:20},{wch:20},{wch:18},{wch:8},{wch:12},{wch:14},{wch:15},{wch:15},{wch:15},{wch:18},{wch:18},{wch:14},{wch:16},{wch:20},{wch:20},{wch:50},{wch:10},{wch:10},{wch:12},{wch:10},{wch:12},{wch:10},{wch:12},{wch:12},{wch:14}];const Z=w.decode_range(l["!ref"]),f=l.A1;f&&(f.s={font:{bold:!0,sz:18,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2980B9"}},alignment:{horizontal:"center",vertical:"center"}}),l["!merges"]||(l["!merges"]=[]),l["!merges"].push({s:{r:0,c:0},e:{r:0,c:26}});for(let s=1;s<=2;s++){const h=l[w.encode_cell({r:s,c:0})];h&&(h.s={font:{bold:!0,sz:11,color:{rgb:"34495E"}},alignment:{horizontal:"center"}}),l["!merges"].push({s:{r:s,c:0},e:{r:s,c:26}})}const K=4;for(let s=0;s<A.length;s++){const h=l[w.encode_cell({r:K,c:s})];h&&(h.s={font:{bold:!0,sz:11,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2C3E50"}},alignment:{horizontal:"center",vertical:"center",wrapText:!0},border:{top:{style:"medium",color:{rgb:"000000"}},bottom:{style:"medium",color:{rgb:"000000"}},left:{style:"thin",color:{rgb:"000000"}},right:{style:"thin",color:{rgb:"000000"}}}})}const P=5,v=P+k.length-1;for(let s=P;s<=v;s++){const h=s===v,N=h?"E74C3C":(s-P)%2===0?"FFFFFF":"ECF0F1",E=h?"FFFFFF":"000000";for(let b=0;b<A.length;b++){const o=l[w.encode_cell({r:s,c:b})];o&&(o.s={font:{sz:10,bold:h,color:{rgb:E}},fill:{fgColor:{rgb:N}},alignment:{horizontal:b===0||b>=5&&b<=7||b>=18?"right":"left",vertical:"center",wrapText:!0},border:{top:{style:h?"medium":"thin",color:{rgb:h?"000000":"BDC3C7"}},bottom:{style:h?"medium":"thin",color:{rgb:h?"000000":"BDC3C7"}},left:{style:"thin",color:{rgb:h?"000000":"BDC3C7"}},right:{style:"thin",color:{rgb:h?"000000":"BDC3C7"}}}})}}const $=A.indexOf("Photo/PDF"),T=P;for(let s=0;s<z.length;s++){const h=w.encode_cell({r:T+s,c:$}),N=z[s];if(N.photo_url&&N.photo_url!=="NA"){const E=`${Q}/${N.photo_url.replace(/\\/g,"/")}`,b=N.photo_url.split("/").pop();l[h]={t:"s",v:b,l:{Target:E,Tooltip:"Click to view file"},s:{font:{color:{rgb:"0563C1"},underline:!0},alignment:{horizontal:"left",vertical:"center"}}}}else l[h]={t:"s",v:"-",s:{font:{color:{rgb:"000000"}},alignment:{horizontal:"left",vertical:"center"}}}}const S=v+2,C=ce.find(s=>s.id===parseInt(m.project_id)),B=V.find(s=>s.id===parseInt(m.expense_type_id)),L=[["FILTERS APPLIED"],[""],["Total Records",z.length]];C&&L.push(["Project",C.project_name]),B&&L.push(["Expense Type",B.name]),w.sheet_add_aoa(l,L,{origin:w.encode_cell({r:S,c:0})});const ee=l[w.encode_cell({r:S,c:0})];ee&&(ee.s={font:{bold:!0,sz:14,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"16A085"}},alignment:{horizontal:"center",vertical:"center"}}),l["!merges"].push({s:{r:S,c:0},e:{r:S,c:7}});for(let s=2;s<L.length;s++){const h=S+s,N=l[w.encode_cell({r:h,c:0})],E=l[w.encode_cell({r:h,c:1})];N&&(N.s={font:{bold:!0,sz:10},fill:{fgColor:{rgb:"F0F8FF"}},alignment:{horizontal:"left",vertical:"center"}}),E&&(E.s={font:{sz:10},fill:{fgColor:{rgb:"F0F8FF"}},alignment:{horizontal:"left",vertical:"center"}}),l["!merges"].push({s:{r:h,c:1},e:{r:h,c:7}})}l["!rows"]=[],l["!rows"][0]={hpt:30},l["!rows"][K]={hpt:25},l["!rows"][S]={hpt:25},l["!rows"][v]={hpt:30},w.book_append_sheet(x,l,"Expense Report");const ae=`Expense_Report_${m.start_date||"All"}_to_${m.end_date||"All"}_${new Date().toISOString().split("T")[0]}.xlsx`;at(x,ae,{cellStyles:!0}),W("success",'Excel file downloaded successfully! Click on file links in the "Photo/PDF" column to view files.')}catch(x){console.error("Error generating Excel:",x),W("danger","Error generating Excel file: "+x.message)}},Wt=()=>{et();const{showToast:m}=tt(),{t:ce}=it("global"),V=st(),[G,z]=c.useState({}),[H,i]=c.useState([]),[ge,W]=c.useState(0),[Q,U]=c.useState(null),[O,Y]=c.useState(!1),[xe,a]=c.useState(!1),[x,k]=c.useState("");c.useState("");const[F,A]=c.useState(!1),[l,Z]=c.useState(null),[f,K]=c.useState({key:null,direction:"asc"}),[P,v]=c.useState(!1),[$,T]=c.useState(!1),[S,C]=c.useState(null),[B,L]=c.useState(!1),[ee,ae]=c.useState(window.innerWidth<=768),[s,h]=c.useState(""),[N,E]=c.useState(!1),[b,o]=c.useState(""),[p,te]=c.useState([]),[D,je]=c.useState([]),[g,ye]=c.useState({start_date:"",end_date:"",project_id:"",expense_type_id:""}),X=c.useRef(null),M=c.useRef(null),I=c.useRef(null),se=c.useRef(0),q=c.useRef(!1),fe=async()=>{try{const t=await Ge("/api/projects");te(t||[])}catch(t){m("danger","Error fetching projects: "+t)}},Ve=async()=>{try{const t=await Ge("/api/expenseType");je(t||[]);const r=t.reduce((n,d)=>(n[d.id]=d.name,n),{});z(r)}catch(t){m("danger","Error fetching expense types: "+t)}},_e=t=>{const{name:r,value:n}=t.target;ye({...g,[r]:n})},ie=async(t=!0)=>{if((!g.start_date||!g.end_date)&&!g.project_id&&!g.expense_type_id){m("warning","Please select dates or at least one filter (Project or Expense Type)");return}t?(v(!0),q.current=!1):T(!0);try{let r="/api/expense?";const n=[];g.start_date&&g.end_date&&(n.push(`startDate=${g.start_date}`),n.push(`endDate=${g.end_date}`)),g.project_id&&n.push(`customerId=${g.project_id}`),g.expense_type_id&&n.push(`expenseTypeId=${g.expense_type_id}`),S&&!t&&n.push(`cursor=${S}`),r+=n.join("&");const d=await Ge(r);if(d.error)m("danger",d.error);else{const _=t?d.data:[...H,...d.data];i(_),W(d.totalExpense||0),C(d.next_cursor||null),L(d.has_more_pages),q.current&&!t&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{X.current&&(X.current.scrollTop=se.current),q.current=!1})})}}catch(r){m("danger","Error occurred: "+r)}finally{v(!1),T(!1)}},He=async t=>{try{const r=t.currentTarget;t.preventDefault(),t.stopPropagation(),a(!0),r.checkValidity()&&(q.current=!1,se.current=0,C(null),await ie(!0))}catch(r){m("danger","Error occurred: "+r)}},We=c.useCallback(()=>{I.current&&clearTimeout(I.current),I.current=setTimeout(()=>{const t=X.current;if(!t)return;const{scrollTop:r,scrollHeight:n,clientHeight:d}=t,_=100;se.current=r,r+d>=n-_&&B&&!$&&!P&&(q.current=!0,ie(!1))},100)},[B,$,P]);c.useCallback(t=>{M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{k(t)},300)},[]);const ke=t=>{U(t),Y(!0)},Qe=async()=>{try{await rt("/api/expense/"+Q.id),Y(!1),ie(!0),m("success",ce("MSG.expense_deleted_successfully")||"Expense deleted successfully")}catch(t){m("danger","Error occurred: "+t)}},De=async t=>{try{await ot("/api/expense/"+t.id,{...t,show:!t.show}),ie(!0)}catch(r){m("danger","Error occurred: "+r)}},we=t=>{Z(t),A(!0)},Ue=()=>{ie(!0)},Re=t=>{o(t.photo_url||""),E(!0)},re=t=>{let r="asc";f.key===t&&f.direction==="asc"&&(r="desc"),K({key:t,direction:r})},oe=t=>f.key===t?f.direction==="asc"?"â†‘":"â†“":"â†•",ne=t=>({marginLeft:"8px",fontSize:"14px",opacity:f.key===t?1:.5,color:f.key===t?"#0d6efd":"#6c757d",transition:"all 0.2s ease"}),de=t=>{const r=parseFloat(t)||0;if(isNaN(r))return"0.00";const[n,d="00"]=r.toFixed(2).split("."),_=n.slice(-3),R=n.slice(0,-3);return`${R.length>0?R.replace(/\B(?=(\d{2})+(?!\d))/g,",")+","+_:_}.${d}`},J=t=>`Rs ${de(t)}`,Ce=t=>{const r={day:"numeric",month:"short",year:"numeric"},d=new Date(t).toLocaleDateString("en-US",r).replace(",",""),[_,R]=d.split(" ");return`${R} ${_}`},Oe=()=>{_t(g,p,D,Te,u,G,de,Ce,m,Fe,ve,Ne)},Ye=()=>{Ct(g,p,D,Te,u,G,de,Ce,m,window.location.origin,Fe,ve,Ne,Xe,Je)},u=c.useMemo(()=>{let t=H.map((r,n)=>({...r,sr_no:n+1}));if(x.trim()){const r=x.toLowerCase();t=t.filter(n=>{var d,_,R,le,he,me,ze,$e,Be;return((d=G[n.expense_id])==null?void 0:d.toLowerCase().includes(r))||((_=n.expense_date)==null?void 0:_.toLowerCase().includes(r))||((R=n.total_price)==null?void 0:R.toString().includes(x))||((le=n.contact)==null?void 0:le.toLowerCase().includes(r))||((he=n.desc)==null?void 0:he.toLowerCase().includes(r))||((me=n.payment_by)==null?void 0:me.toLowerCase().includes(r))||((ze=n.payment_type)==null?void 0:ze.toLowerCase().includes(r))||((Be=($e=n.project)==null?void 0:$e.project_name)==null?void 0:Be.toLowerCase().includes(r))})}return s==="gst"?t=t.filter(r=>r.isGst===1||r.isGst===!0):s==="non-gst"&&(t=t.filter(r=>r.isGst===0||r.isGst===!1)),f.key?[...t].sort((r,n)=>{var R,le,he,me;let d=r[f.key],_=n[f.key];return f.key==="expense_type"?(d=G[r.expense_id]||"",_=G[n.expense_id]||""):f.key==="customer_name"?(d=((R=r.project)==null?void 0:R.project_name)||"",_=((le=n.project)==null?void 0:le.project_name)||""):f.key==="category"&&(d=((he=r.expense_type)==null?void 0:he.expense_category)||"",_=((me=n.expense_type)==null?void 0:me.expense_category)||""),typeof d=="string"&&(d=d.toLowerCase()),typeof _=="string"&&(_=_.toLowerCase()),d<_?f.direction==="asc"?-1:1:d>_?f.direction==="asc"?1:-1:0}):t},[H,x,f,G,s]),Te=c.useMemo(()=>u.reduce((t,r)=>t+parseFloat(r.total_price||0),0),[u]),Xe=c.useMemo(()=>u.reduce((t,r)=>t+parseFloat(r.qty||0),0),[u]);c.useMemo(()=>u.reduce((t,r)=>t+parseFloat(r.price||0),0),[u]);const Je=c.useMemo(()=>u.reduce((t,r)=>{const n=parseFloat(r.qty||0),d=parseFloat(r.price||0);return t+n*d},0),[u]),Fe=c.useMemo(()=>u.reduce((t,r)=>t+parseFloat(r.cgst||0),0),[u]),ve=c.useMemo(()=>u.reduce((t,r)=>t+parseFloat(r.sgst||0),0),[u]),Ne=c.useMemo(()=>u.reduce((t,r)=>t+parseFloat(r.igst||0),0),[u]),Ze=c.useMemo(()=>u.reduce((t,r)=>t+parseFloat(r.gst||0),0),[u]);c.useEffect(()=>{fe(),Ve()},[]),c.useEffect(()=>{const t=()=>{ae(window.innerWidth<=768)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),c.useEffect(()=>()=>{M.current&&clearTimeout(M.current),I.current&&clearTimeout(I.current)},[]);const Ke=t=>{var r,n;return e.jsx(Me,{className:"mb-3 expense-card",children:e.jsxs(Ie,{children:[e.jsxs("div",{className:"card-row-1",children:[e.jsxs("div",{className:"expense-name-section",children:[e.jsx("div",{className:"expense-name",children:G[t.expense_id]||"N/A"}),e.jsx("div",{className:"expense-type",children:e.jsx("span",{className:"category-text",children:t.sr_no})})]}),e.jsxs("div",{className:"expense-total",children:[e.jsx("div",{className:"total-amount",children:J(t.total_price)}),e.jsx("div",{className:"total-label",children:"Amount"})]})]}),e.jsxs("div",{className:"card-row-2",children:[e.jsxs("div",{className:"expense-date",children:["ðŸ“… ",Ce(t.expense_date)]}),e.jsx("div",{className:"expense-details",children:e.jsx("span",{className:"detail-item",children:((r=t.project)==null?void 0:r.project_name)||"-"})})]}),e.jsx("div",{className:"card-row-2",children:e.jsxs("div",{className:"expense-details",children:[e.jsxs("span",{className:"detail-item",children:["Category: ",((n=t.expense_type)==null?void 0:n.expense_category)||"-"]}),e.jsxs("span",{className:"detail-item",children:["Qty: ",t.qty||"-"]})]})}),e.jsx("div",{className:"card-row-2",children:e.jsxs("div",{className:"expense-details",children:[e.jsxs("span",{className:"detail-item",children:["Price: Rs ",de(t.price||0)]}),e.jsx("span",{className:"detail-item",children:t.isGst?e.jsxs(e.Fragment,{children:["GST: ",t.gst||0,"Rs | CGST: ",t.cgst||0,"Rs | SGST: ",t.sgst||0,"Rs | IGST: ",t.igst||0,"Rs"]}):"Non-GST"})]})}),e.jsx("div",{className:"card-row-2",children:e.jsxs("div",{className:"expense-details",children:[e.jsx("span",{className:"detail-item",children:t.contact||"-"}),e.jsx("span",{className:"detail-item",children:t.payment_by||"-"})]})}),e.jsx("div",{className:"card-row-2",children:e.jsxs("div",{className:"expense-details",children:[e.jsx("span",{className:"detail-item",children:t.payment_type||"-"}),e.jsx("span",{className:"detail-item",children:t.bank_name||"-"})]})}),e.jsx("div",{className:"card-row-3",children:e.jsx("div",{className:"expense-details",children:e.jsxs("span",{className:"detail-item",children:["Acc: ",t.account_number||"-"," IFSC: ",t.ifsc_code||"-"," Trans: ",t.transaction_id||"-"]})})}),e.jsx("div",{className:"card-row-3",children:e.jsx("div",{className:"expense-details",children:e.jsx("span",{className:"detail-item",children:t.name||"-"})})}),e.jsx("div",{className:"card-row-3",children:e.jsx("div",{className:"expense-details",children:e.jsx("span",{className:"detail-item",children:t.photo_remark||"-"})})}),e.jsx("div",{className:"card-row-3",children:e.jsxs("div",{className:"action-buttons-mobile",children:[V===1&&e.jsx("button",{className:"badge bg-info",onClick:()=>De(t),role:"button",children:t.show?"Valid":"Invalid"}),e.jsx("button",{className:"badge bg-primary",onClick:()=>we(t),role:"button",children:"Edit"}),V===1&&e.jsx("button",{className:"badge bg-danger",onClick:()=>ke(t),role:"button",children:"Delete"}),t.photo_url&&t.photo_url!=="NA"&&e.jsx("button",{className:"badge bg-secondary",onClick:()=>Re(t),role:"button",children:"View"})]})})]})},t.id)};return P&&!$?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ee,{color:"primary",size:"lg"}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading expenses..."})]})}):(p.find(t=>t.id===parseInt(g.project_id)),D.find(t=>t.id===parseInt(g.expense_type_id)),e.jsxs(e.Fragment,{children:[e.jsx("style",{jsx:!0,global:!0,children:`
        .expense-card {
          border: 1px solid #dee2e6;
          border-radius: 8px;
          box-shadow: 0 1px 4px rgba(0,0,0,0.1);
          transition: all 0.3s ease;
        }
        .expense-card:hover {
          transform: translateY(-1px);
          box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .expense-card .card-body {
          padding: 12px !important;
        }
        .card-row-1 {
          display: flex;
          justify-content: space-between;
          margin-bottom: 8px;
        }
        .expense-name {
          font-weight: 600;
          font-size: 1em;
          color: #333;
        }
        .expense-total {
          text-align: right;
        }
        .total-amount {
          font-weight: 600;
          font-size: 1.1em;
          color: #d32f2f;
        }
        .card-row-2, .card-row-3 {
          margin-bottom: 8px;
          padding: 4px 0;
          border-top: 1px solid #f0f0f0;
        }
        .action-buttons-mobile {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
        }
        .action-buttons-mobile .badge {
          font-size: 0.85em;
          padding: 6px 12px;
          border-radius: 16px;
          cursor: pointer;
        }
        .table-container {
          height: 350px;
          overflow-y: auto;
          border: 1px solid #dee2e6;
          border-radius: 0.375rem;
        }
        .expenses-table thead th {
          position: sticky;
          top: 0;
          z-index: 10;
          background-color: #f8f9fa;
          border-bottom: 2px solid #dee2e6;
        }
        .search-container {
          position: relative;
        }
        .search-input {
          padding-left: 40px;
        }
        .search-icon {
          position: absolute;
          left: 12px;
          top: 50%;
          transform: translateY(-50%);
          color: #6c757d;
        }
        .clear-search {
          position: absolute;
          right: 12px;
          top: 50%;
          transform: translateY(-50%);
          background: none;
          border: none;
          color: #6c757d;
          cursor: pointer;
        }
        .summary-container {
          margin-bottom: 20px;
          padding: 10px;
          background-color: #f8f9fa;
          border: 1px solid #dee2e6;
          border-radius: 0.375rem;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        .summary-item {
          flex: 1;
          text-align: center;
          font-weight: 500;
        }
        .summary-item strong {
          display: block;
          font-size: 0.9em;
          color: #555;
        }
      `}),e.jsx(lt,{visible:F,onClose:()=>A(!1),expense:l,onExpenseUpdated:Ue}),e.jsxs(dt,{visible:N,onClose:()=>E(!1),children:[e.jsx(ht,{children:e.jsx(mt,{children:"View File"})}),e.jsx(pt,{children:b?(()=>{const t=b.split("/").pop(),r=`/img/bill/${t}`,n=t.split(".").pop().toLowerCase();return n==="pdf"?e.jsx("iframe",{src:r,title:"PDF Preview",style:{width:"100%",height:"70vh",border:"none"}}):["jpg","jpeg","png"].includes(n)?e.jsx("img",{src:r,alt:"Expense",style:{maxWidth:"100%",maxHeight:"70vh",display:"block",margin:"auto"}}):e.jsx("p",{style:{color:"red",textAlign:"center"},children:"Unsupported file type"})})():e.jsx("p",{style:{color:"red",textAlign:"center"},children:"File not available"})}),e.jsx(ut,{children:e.jsx(Se,{color:"secondary",onClick:()=>E(!1),children:"Close"})})]}),e.jsxs(Le,{children:[e.jsx(nt,{visible:O,setVisible:Y,onYes:Qe,resource:"Delete expense"}),e.jsx(be,{xs:12,children:e.jsxs(Me,{className:"mb-4",children:[e.jsxs(gt,{children:[e.jsx("strong",{children:"Expense Report"}),e.jsxs("span",{className:"ms-2 text-muted",children:["Total ",u.length," expenses"]})]}),e.jsxs(Ie,{children:[e.jsx(xt,{noValidate:!0,validated:xe,onSubmit:He,children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-sm-3",children:e.jsxs("div",{className:"mb-1",children:[e.jsx(ue,{htmlFor:"project_id",children:"Project"}),e.jsxs(Pe,{id:"project_id",name:"project_id",value:g.project_id,onChange:_e,children:[e.jsx("option",{value:"",children:"All Projects"}),p.map(t=>e.jsx("option",{value:t.id,children:t.project_name},t.id))]})]})}),e.jsx("div",{className:"col-sm-2",children:e.jsxs("div",{className:"mb-1",children:[e.jsx(ue,{htmlFor:"start_date",children:"Start Date"}),e.jsx(qe,{type:"date",id:"start_date",name:"start_date",value:g.start_date,onChange:_e})]})}),e.jsx("div",{className:"col-sm-2",children:e.jsxs("div",{className:"mb-1",children:[e.jsx(ue,{htmlFor:"end_date",children:"End Date"}),e.jsx(qe,{type:"date",id:"end_date",name:"end_date",value:g.end_date,onChange:_e})]})}),e.jsx("div",{className:"col-sm-3",children:e.jsxs("div",{className:"mb-1",children:[e.jsx(ue,{htmlFor:"expense_type_id",children:"Expense Type"}),e.jsxs(Pe,{id:"expense_type_id",name:"expense_type_id",value:g.expense_type_id,onChange:_e,children:[e.jsx("option",{value:"",children:"All Expense Types"}),D.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})}),e.jsx("div",{className:"col-sm-2",children:e.jsx("div",{className:"mb-1 mt-4",children:e.jsx(Se,{color:"success",type:"submit",disabled:P,className:"w-100",children:P?"Loading...":"Submit"})})})]})}),e.jsx("hr",{}),e.jsxs(Le,{className:"mb-3",children:[e.jsx(be,{xs:12,md:6,lg:3,children:e.jsxs("div",{className:"mb-1",children:[e.jsx(ue,{htmlFor:"gstFilter",children:"GST/Non-GST"}),e.jsxs(Pe,{id:"gstFilter",value:s,onChange:t=>h(t.target.value),children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"gst",children:"GST"}),e.jsx("option",{value:"non-gst",children:"Non-GST"})]})]})}),e.jsx(be,{xs:12,md:6,lg:3,children:e.jsxs("div",{className:"d-flex gap-2 mt-4",children:[e.jsx(Se,{color:"primary",onClick:Ye,disabled:!u.length,children:"Download Excel"}),e.jsx(Se,{color:"warning",onClick:Oe,disabled:!u.length,children:"Download PDF"})]})}),x&&e.jsx(be,{xs:12,className:"mt-2",children:e.jsxs("small",{className:"text-muted",children:[u.length,' expenses found for "',x,'"']})})]}),ee?e.jsxs("div",{className:"mobile-cards-container",children:[u.length===0?e.jsx("div",{className:"text-center text-muted py-4",children:e.jsx("p",{children:"No expenses found"})}):u.map(Ke),$&&e.jsxs("div",{className:"loading-more",children:[e.jsx(Ee,{color:"primary",size:"sm"}),e.jsx("span",{className:"ms-2 text-muted",children:"Loading more..."})]})]}):e.jsxs(e.Fragment,{children:[u.length>0&&e.jsxs("div",{className:"summary-container",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Total Amount"}),J(Te)]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"GST"}),J(Ze)]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"CGST"}),J(Fe)]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"SGST"}),J(ve)]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"IGST"}),J(Ne)]})]}),e.jsxs("div",{className:"table-container",ref:X,onScroll:We,children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(jt,{className:"expenses-table",children:[e.jsx(yt,{children:e.jsxs(Ae,{children:[e.jsxs(y,{onClick:()=>re("sr_no"),style:{cursor:"pointer"},children:["Sr No ",e.jsx("span",{style:ne("sr_no"),children:oe("sr_no")})]}),e.jsxs(y,{onClick:()=>re("expense_date"),style:{cursor:"pointer"},children:["Date ",e.jsx("span",{style:ne("expense_date"),children:oe("expense_date")})]}),e.jsxs(y,{onClick:()=>re("customer_name"),style:{cursor:"pointer"},children:["Project ",e.jsx("span",{style:ne("customer_name"),children:oe("customer_name")})]}),e.jsxs(y,{onClick:()=>re("expense_type"),style:{cursor:"pointer"},children:["Expense Type ",e.jsx("span",{style:ne("expense_type"),children:oe("expense_type")})]}),e.jsx(y,{children:"Category"}),e.jsx(y,{children:"Qty"}),e.jsxs(y,{onClick:()=>re("price"),style:{cursor:"pointer"},children:["Price ",e.jsx("span",{style:ne("price"),children:oe("price")})]}),e.jsxs(y,{onClick:()=>re("total_price"),style:{cursor:"pointer"},children:["Total ",e.jsx("span",{style:ne("total_price"),children:oe("total_price")})]}),e.jsx(y,{children:"GST Rs"}),e.jsx(y,{children:"CGST Rs"}),e.jsx(y,{children:"SGST Rs"}),e.jsx(y,{children:"IGST Rs"}),e.jsx(y,{children:"Payment By"}),e.jsx(y,{children:"Payment Type"}),e.jsx(y,{children:"Contact"}),e.jsx(y,{children:"Bank Name"}),e.jsx(y,{children:"Account Number"}),e.jsx(y,{children:"IFSC"}),e.jsx(y,{children:"Transaction ID"}),e.jsx(y,{children:"About"}),e.jsx(y,{children:"Notes"}),e.jsx(y,{children:"Actions"})]})}),e.jsx(ft,{children:u.length===0?e.jsx(Ae,{children:e.jsx(j,{colSpan:22,className:"text-center py-4",children:e.jsx("p",{children:"No expenses found"})})}):u.map(t=>{var r,n;return e.jsxs(Ae,{children:[e.jsx(j,{children:t.sr_no}),e.jsx(j,{children:Ce(t.expense_date)}),e.jsx(j,{children:((r=t.project)==null?void 0:r.project_name)||"-"}),e.jsx(j,{children:G[t.expense_id]||"-"}),e.jsx(j,{children:((n=t.expense_type)==null?void 0:n.expense_category)||"-"}),e.jsx(j,{children:t.qty||"-"}),e.jsx(j,{children:t.price?de(t.price):"-"}),e.jsx(j,{children:e.jsx("span",{style:{fontWeight:"500",color:"#dc3545"},children:J(t.total_price)})}),e.jsx(j,{children:t.isGst&&t.gst!==null?`${t.gst}Rs`:"-"}),e.jsx(j,{children:t.isGst&&t.cgst!==null?`${t.cgst}Rs`:"-"}),e.jsx(j,{children:t.isGst&&t.sgst!==null?`${t.sgst}Rs`:"-"}),e.jsx(j,{children:t.isGst&&t.igst!==null?`${t.igst}Rs`:"-"}),e.jsx(j,{children:t.payment_by||"-"}),e.jsx(j,{children:t.payment_type||"-"}),e.jsx(j,{children:t.contact||"-"}),e.jsx(j,{children:t.bank_name||"-"}),e.jsx(j,{children:t.acc_number||"-"}),e.jsx(j,{children:t.ifsc||"-"}),e.jsx(j,{children:t.transaction_id||"-"}),e.jsx(j,{children:t.name||"-"}),e.jsx(j,{children:t.photo_remark||"-"}),e.jsx(j,{children:e.jsxs("div",{className:"action-buttons",children:[V===1?e.jsxs(e.Fragment,{children:[e.jsx(pe,{role:"button",color:t.show?"success":"danger",onClick:()=>De(t),style:{cursor:"pointer",fontSize:"0.75em"},children:t.show?"Valid":"Invalid"}),e.jsx(pe,{role:"button",color:"primary",onClick:()=>we(t),style:{cursor:"pointer",fontSize:"0.75em"},children:"Edit"}),e.jsx(pe,{role:"button",color:"danger",onClick:()=>ke(t),style:{cursor:"pointer",fontSize:"0.75em"},children:"Delete"})]}):e.jsx(pe,{role:"button",color:"primary",onClick:()=>we(t),style:{cursor:"pointer",fontSize:"0.75em"},children:"Edit"}),t.photo_url&&t.photo_url!=="NA"&&e.jsx(pe,{role:"button",color:"secondary",onClick:()=>Re(t),style:{cursor:"pointer",fontSize:"0.75em"},children:"View"})]})})]},t.id)})})]})}),$&&e.jsxs("div",{className:"loading-more",children:[e.jsx(Ee,{color:"primary",size:"sm"}),e.jsx("span",{className:"ms-2 text-muted",children:"Loading more..."})]})]})]})]})]})})]})]}))};export{Wt as default};
