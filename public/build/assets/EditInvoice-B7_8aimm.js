import{d as f,u as A,e as T,r as m,b as v,j as c}from"./index-fatTeUCR.js";import{a as P,b as h}from"./api-CIBCEetx.js";import j from"./Invoice-B9OoRhaE.js";import{u as S}from"./DefaultLayout-Dto4nkGD.js";/* empty css                */import"./index.esm-Mmat67Is.js";import"./ProjectSelectionModal-B73fOGfp.js";import"./CFormInput-wID138bU.js";import"./CFormControlWrapper-BGWL0obt.js";import"./CFormLabel-Cp8KupB2.js";import"./CTable-BlnPdtp1.js";import"./CButton-Dnh0eu3x.js";import"./CCardBody-CWs2rFEf.js";import"./CCardHeader-DIjx7CZA.js";import"./CForm-BbEA8t0A.js";import"./CInputGroup-B1hWyDLI.js";import"./CInputGroupText-5zhABSqH.js";import"./cil-x-0440B5Ce.js";import"./cil-search-CDkY_4k-.js";import"./cil-plus-D8mtC-W5.js";import"./CFormSelect-f1NQQOIZ.js";import"./cil-pencil-m516yCOw.js";import"./CFormTextarea-cNlJlc5V.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-D_M5GP1R.js";const Z=()=>{const{id:a}=f(),u=A(),d=T(),n=new URLSearchParams(d.search).get("convertTo"),[p,l]=m.useState(null),[g,b]=m.useState(!0),[_,N]=m.useState(!1),{showToast:s}=v(),{t:o}=S("global");m.useEffect(()=>{(async()=>{try{const e=await P(`/api/order/${a}`);if(console.log("Fetched order:",e),e){const t=e.project||{};l({projectId:e.project_id||t.id||null,customer_id:e.customer_id||null,projectName:t.project_name||"N/A",customer:{name:t.customer_name||"Unknown",address:t.work_place||"",mobile:t.mobile_number||""},lat:e.lat||"",long:e.long||"",payLater:!!e.payLater,isSettled:!!e.isSettled,invoiceDate:e.invoiceDate||"",deliveryTime:e.deliveryTime||"",deliveryDate:e.deliveryDate||"",invoiceType:n?parseInt(n):e.invoiceType||3,orderStatus:n?parseInt(n):e.orderStatus||1,items:(e.items||[]).map(r=>({id:r.id,work_type:r.work_type||"",uom:r.uom||"",qty:Number(r.qty||0),price:Number(r.price||0),total_price:Number(r.total_price||0),remark:r.remark||"",gst_percent:Number(r.gst_percent||0),cgst_amount:Number(r.cgst_amount||0),sgst_amount:Number(r.sgst_amount||0)})),totalAmount:Number(e.totalAmount||0),subtotal:Number(e.totalAmount||0),taxableAmount:Number(e.totalAmount||0),discount:Number(e.discount||0),paidAmount:Number(e.paidAmount||0),finalAmount:Number(e.finalAmount||0),balanceAmount:Number(e.finalAmount||0)-Number(e.paidAmount||0),gstAmount:Number(e.gst||0),sgstAmount:Number(e.sgst||0),cgstAmount:Number(e.cgst||0),igstAmount:Number(e.igst||0),gstPercentage:Number(e.gstPercentage||18),sgstPercentage:Number(e.sgstPercentage||9),cgstPercentage:Number(e.cgstPercentage||9),igstPercentage:Number(e.igstPercentage||0),paymentType:e.paymentType||0,company_id:e.company_id||null,payment_terms:e.payment_terms||"",terms_and_conditions:e.terms_and_conditions||"",note:e.note||"",ref_id:e.ref_id||"",po_number:e.po_number||""}),N(!0)}else s("danger","No order data found")}catch(e){console.error("Fetch order error:",e),s("danger",o("TOAST.fetch_order_failed"))}finally{b(!1)}})()},[a,n,o]);const y=async i=>{try{const e={...i,id:a,project_id:i.projectId,remainingBalance:Number(i.finalAmount||0)-Number(i.paidAmount||0)};console.log("Updating order:",e);const t=await h(`/api/order/${a}`,e);t!=null&&t.success?(s("success",o("TOAST.order_updated")),u(`/invoice-details/${a}`)):s("danger",(t==null?void 0:t.message)||o("TOAST.update_failed"))}catch(e){console.error("Update error:",e),s("danger",o("TOAST.update_error"))}};return g||!_?c.jsx("div",{children:o("TOAST.loading")}):c.jsx(j,{editMode:!0,initialData:p,onSubmit:y})};export{Z as default};
