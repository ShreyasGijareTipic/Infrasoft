import{r as j,b as Ze,j as e}from"./index-DkVkGOCn.js";import{a as m,b as a,c as u}from"./index.esm-cOQ_-zh5.js";import{g as We,a as Qe}from"./api-CIBCEetx.js";import{u as Je,m as Ie,f as Ke,g as $,h as L,n as Xe,i as es,j as H,C as O}from"./DefaultLayout-BgphJYJL.js";import{C as Me}from"./cil-mobile-Bth8NvRk.js";import{C as w,a as C}from"./CCardBody-kTNIg812.js";import{C as $e}from"./CFormSelect-CsovC7Xz.js";import{c as ss}from"./cil-building-DVuwBvuD.js";import{c as as}from"./cil-money-Dk3vHnQB.js";import{c as is}from"./cil-people-DQU-yEHN.js";import{c as ls}from"./cil-credit-card-KG5pHjdT.js";import{c as rs}from"./cil-calendar-B69zOQSH.js";import{C as ts}from"./CInputGroup-Ct8Orevz.js";import{C as ns}from"./CFormInput-DPw0cP7s.js";import{C as cs}from"./CInputGroupText-XkMvTSml.js";import{c as ds}from"./cil-search-CDkY_4k-.js";import{C as P,a as T,b as p,c as l,d as D,e as i}from"./CTable-QHmTbIS6.js";import{c as ms,a as os}from"./cil-phone-DD-NWLBR.js";import"./CButton-Bx6A1OAo.js";import"./RawMaterial-BtjEDAbB.js";import"./CFormControlWrapper-Bc0rLHg6.js";import"./CFormLabel-uqQeaLEa.js";var xs=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M450.27,348.569,406.6,267.945V184c0-83.813-68.187-152-152-152s-152,68.187-152,152v83.945L58.928,348.568A24,24,0,0,0,80.031,384h86.935c-.238,2.636-.367,5.3-.367,8a88,88,0,0,0,176,0c0-2.7-.129-5.364-.367-8h86.935a24,24,0,0,0,21.1-35.431ZM310.6,392a56,56,0,1,1-111.419-8H310.018A56.14,56.14,0,0,1,310.6,392ZM93.462,352,134.6,276.055V184a120,120,0,0,1,240,0v92.055L415.736,352Z' class='ci-primary'/>"],hs=["512 512","<rect width='32' height='176' x='240' y='176' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='240' y='384' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M274.014,16H237.986L16,445.174V496H496V445.174ZM464,464H48V452.959L256,50.826,464,452.959Z' class='ci-primary'/>"];const $s=()=>{var W,Q,J,K,X,ee,se,ae,ie,le,re,te,ne,ce,de,me,oe,xe,he,je,ue,pe,ge,ve,be,Ne,fe,ye,_e,we,Ce,Se,ke,Ae,Pe,Te,De,Re,Ee;const[o,Le]=j.useState(null),[N,R]=j.useState(0),[V,He]=j.useState(new Date().toISOString().split("T")[0].slice(0,8)+"01"),[q,Oe]=j.useState(new Date().toISOString().split("T")[0]),[B,Fe]=j.useState(""),[ze,G]=j.useState(!0),[Z,Ye]=j.useState(null),[x,E]=j.useState("all"),F=new Date().getFullYear(),[S,Be]=j.useState(F),[I,Ue]=j.useState("all"),{showToast:z}=Ze();We(),Je("global");const k=(o==null?void 0:o.sales_summary)||{},A=(o==null?void 0:o.partners_summary)||{},y=(o==null?void 0:o.payment_overview)||{},_=(o==null?void 0:o.commission_summary)||{},t=(o==null?void 0:o.renewal_alerts)||{},U=j.useMemo(()=>{const s=t.expiring_companies||[],v=(t.expired_companies||[]).map(c=>({...c,days_remaining:c.days_remaining!==void 0?c.days_remaining:c.days_overdue?-Math.abs(c.days_overdue):-1})),g=[...s,...v];if(g.length===0)return[];switch(x){case"critical":return g.filter(c=>c.days_remaining<=7&&c.days_remaining>=0);case"upcoming":return g.filter(c=>c.days_remaining>7&&c.days_remaining<=30);case"overdue":return g.filter(c=>c.days_remaining<0);default:return g}},[t.expiring_companies,t.expired_companies,x]),Y=s=>{const n=t.expiring_companies||[],g=(t.expired_companies||[]).map(r=>({...r,days_remaining:r.days_remaining!==void 0?r.days_remaining:r.days_overdue?-Math.abs(r.days_overdue):-1})),c=[...n,...g];let h=[],f="";switch(s){case"critical":h=c.filter(r=>r.days_remaining<=7&&r.days_remaining>=0),f="Critical_Renewals";break;case"upcoming":h=c.filter(r=>r.days_remaining>7&&r.days_remaining<=30),f="Upcoming_Renewals";break;case"overdue":h=c.filter(r=>r.days_remaining<0),f="Overdue_Renewals";break;default:h=c,f="All_Renewals"}const M=h.map(r=>{let b;return r.days_remaining<0?b=`${Math.abs(r.days_remaining)} days overdue`:r.days_remaining<=7?b="Critical":r.days_remaining<=15?b="Warning":b="Upcoming",{"Company Name":r.company_name||"N/A","Company ID":r.company_id||"N/A",Email:r.email_id||"N/A","Phone Number":r.phone_no||"N/A","Days Remaining":r.days_remaining,Status:b,"Export Date":new Date().toLocaleDateString(),"Export Time":new Date().toLocaleTimeString()}});console.log(`Attempting to export ${h.length} ${s} records`),console.log("Sample data:",h.slice(0,2)),M.length>0?(Ve(M,f),z("success",`Exported ${M.length} records to ${f}.csv`)):(z("warning",`No ${s} data to export`),console.log("All companies data:",c))},Ve=(s,n)=>{if(s.length===0){z("warning","No data to export");return}const v=Object.keys(s[0]),g=[v.join(","),...s.map(M=>v.map(r=>{const b=M[r]||"";return typeof b=="string"&&(b.includes(",")||b.includes('"'))?`"${b.replace(/"/g,'""')}"`:b}).join(","))].join(`
`),c=new Blob([g],{type:"text/csv;charset=utf-8;"}),h=document.createElement("a"),f=URL.createObjectURL(c);h.setAttribute("href",f),h.setAttribute("download",`${n}.csv`),h.style.visibility="hidden",document.body.appendChild(h),h.click(),document.body.removeChild(h)},qe=async()=>{try{G(!0);const s=new URLSearchParams({startDate:V,endDate:q}),n=await Qe(`/api/admin/dashboard/overview?${s.toString()}`);if(n&&n.success)Le(n.data);else throw new Error("Failed to fetch dashboard data")}catch(s){Ye("Failed to load dashboard data"),z("danger","Error occurred: "+s.message),console.error("Dashboard fetch error:",s)}finally{G(!1)}};j.useEffect(()=>{let s,n;I==="all"?(s=new Date(S,0,1),n=new Date(S,11,31)):(s=new Date(S,I-1,1),n=new Date(S,I,0)),He(s.toISOString().split("T")[0]),Oe(n.toISOString().split("T")[0])},[S,I]),j.useEffect(()=>{qe()},[V,q]);const d=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0}).format(s||0),Ge=s=>new Date(s).toLocaleDateString("en-IN");return ze?e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("span",{className:"ms-2",children:"Loading Tipic Admin Dashboard..."})]}):Z?e.jsxs(Me,{color:"danger",children:[e.jsx("strong",{children:"Error:"})," ",Z]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mb-4",children:e.jsx(C,{children:e.jsxs(m,{className:"align-items-center",children:[e.jsxs(a,{children:[e.jsx("h2",{className:"mb-1",children:"Tipic Admin Dashboard"}),e.jsx("p",{className:"text-muted mb-0",children:"Complete business overview and analytics"})]}),e.jsx(a,{xs:"auto",children:e.jsxs(m,{className:"g-2",children:[e.jsxs(a,{children:[e.jsx("label",{className:"form-label small",children:"Select Month"}),e.jsxs($e,{size:"sm",value:I,onChange:s=>Ue(s.target.value),children:[e.jsx("option",{value:"all",children:"All Months"}),[...Array(12).keys()].map(s=>e.jsx("option",{value:s+1,children:new Date(0,s).toLocaleString("default",{month:"long"})},s+1))]})]}),e.jsxs(a,{children:[e.jsx("label",{className:"form-label small",children:"Select Year"}),e.jsx($e,{size:"sm",value:S,onChange:s=>Be(parseInt(s.target.value)),children:[...Array(5).keys()].map(s=>e.jsx("option",{value:F-s,children:F-s},F-s))})]})]})})]})})}),e.jsxs(m,{className:"mb-4",children:[e.jsx(a,{sm:6,lg:3,children:e.jsx(w,{className:"mb-4",children:e.jsx(C,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(u,{icon:ss,className:"text-primary",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Total Active Companies"}),e.jsx("div",{className:"fs-4 fw-semibold",children:((W=k.summary)==null?void 0:W.total_companies)||0})]})]})})})}),e.jsx(a,{sm:6,lg:3,children:e.jsx(w,{className:"mb-4",children:e.jsx(C,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(u,{icon:Ie,className:"text-success",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Total Companies Sales"}),e.jsx("div",{className:"fs-4 fw-semibold",children:d((Q=k.summary)==null?void 0:Q.total_sales)})]})]})})})}),e.jsx(a,{sm:6,lg:3,children:e.jsx(w,{className:"mb-4",children:e.jsx(C,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-warning bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(u,{icon:as,className:"text-warning",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Total Commission"}),e.jsx("div",{className:"fs-4 fw-semibold",children:d((J=_.summary)==null?void 0:J.total_commission_paid)})]})]})})})}),e.jsx(a,{sm:6,lg:3,children:e.jsx(w,{className:"mb-4",children:e.jsx(C,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"bg-danger bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx(u,{icon:xs,className:"text-danger",size:"lg"})})}),e.jsxs("div",{className:"ms-3",children:[e.jsx("div",{className:"text-muted small",children:"Renewal Alerts"}),e.jsx("div",{className:"fs-4 fw-semibold",children:((K=t.renewal_stats)==null?void 0:K.total_requiring_attention)||0})]})]})})})})]}),t.renewal_stats&&t.renewal_stats.total_requiring_attention>0&&e.jsxs(Me,{color:"warning",className:"mb-4",children:[e.jsx(u,{icon:hs,className:"me-2"}),e.jsx("strong",{children:"Attention Required:"})," ",t.renewal_stats.critical_renewals," critical renewals,"," ",t.renewal_stats.upcoming_renewals," upcoming renewals, and"," ",t.renewal_stats.overdue_renewals," overdue subscriptions need follow-up."]}),e.jsx(w,{children:e.jsxs(C,{children:[e.jsxs(Ke,{variant:"tabs",role:"tablist",children:[e.jsx($,{children:e.jsxs(L,{active:N===0,onClick:()=>R(0),style:{cursor:"pointer"},children:[e.jsx(u,{icon:Ie,className:"me-2"}),"Sales Summary"]})}),e.jsx($,{children:e.jsxs(L,{active:N===1,onClick:()=>R(1),style:{cursor:"pointer"},children:[e.jsx(u,{icon:is,className:"me-2"}),"Partners Summary"]})}),e.jsx($,{children:e.jsxs(L,{active:N===2,onClick:()=>R(2),style:{cursor:"pointer"},children:[e.jsx(u,{icon:ls,className:"me-2"}),"Payment Overview"]})}),e.jsx($,{children:e.jsxs(L,{active:N===3,onClick:()=>R(3),style:{cursor:"pointer"},children:[e.jsx(u,{icon:Xe,className:"me-2"}),"Commission Details"]})}),e.jsx($,{children:e.jsxs(L,{active:N===4,onClick:()=>R(4),style:{cursor:"pointer"},children:[e.jsx(u,{icon:rs,className:"me-2"}),"Renewal Alerts"]})})]}),e.jsxs(es,{className:"mt-3",children:[e.jsxs(H,{role:"tabpanel",visible:N===0,children:[e.jsxs(m,{className:"mb-3",children:[e.jsxs(a,{children:[e.jsx("h4",{children:"All Companies Sales Summary"}),e.jsx("p",{className:"text-muted",children:"Sales performance of all onboarded companies"})]}),e.jsx(a,{md:4,children:e.jsxs(ts,{size:"sm",children:[e.jsx(ns,{placeholder:"Search companies...",value:B,onChange:s=>Fe(s.target.value)}),e.jsx(cs,{children:e.jsx(u,{icon:ds})})]})})]}),e.jsxs(m,{className:"mb-4",children:[e.jsx(a,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-primary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Total Orders"}),e.jsx("div",{className:"fs-5 fw-bold text-primary",children:((X=k.summary)==null?void 0:X.total_orders)||0})]})}),e.jsx(a,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-secondary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Avg Sale/Company"}),e.jsx("div",{className:"fs-6 fw-bold text-secondary",children:d((ee=k.summary)==null?void 0:ee.average_sale_per_company)})]})})]}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(p,{children:[e.jsx(l,{style:{width:"25%"},children:"Company Details"}),e.jsx(l,{style:{width:"25%"},children:"Partner"}),e.jsx(l,{style:{width:"25%"},children:"Orders"}),e.jsx(l,{style:{width:"25%"},children:"Total Sales"})]})}),e.jsx(D,{children:(se=k.companies_sales)==null?void 0:se.filter(s=>!B||s.company_name.toLowerCase().includes(B.toLowerCase())).map((s,n)=>e.jsxs(p,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.company_name}),e.jsxs("div",{className:"text-muted small",children:["Mobile: ",s.phone_no]})]})}),e.jsx(i,{children:s.partner_name?e.jsxs("div",{children:[e.jsx("div",{children:s.partner_name}),e.jsx("div",{className:"text-muted small",children:s.partner_mobile})]}):e.jsx("span",{className:"text-muted",children:"Direct"})}),e.jsx(i,{className:"fw-semibold",children:s.total_orders}),e.jsx(i,{className:" fw-semibold",children:d(s.total_sales)})]},n))})]})})]}),e.jsxs(H,{role:"tabpanel",visible:N===1,children:[e.jsx(m,{className:"mb-3",children:e.jsxs(a,{children:[e.jsx("h4",{children:"Sales Partners Performance"}),e.jsx("p",{className:"text-muted",children:"Customer onboarding by sales partners"})]})}),e.jsxs(m,{className:"mb-4",children:[e.jsx(a,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-primary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Total Partners"}),e.jsx("div",{className:"fs-5 fw-bold text-primary",children:((ae=A.summary)==null?void 0:ae.total_partners)||0})]})}),e.jsx(a,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-success bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Active Customers"}),e.jsx("div",{className:"fs-6 fw-bold text-success",children:((ie=A.summary)==null?void 0:ie.total_active_customers)||0})]})}),e.jsx(a,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-warning bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Blocked Customers"}),e.jsx("div",{className:"fs-6 fw-bold text-warning",children:((le=A.summary)==null?void 0:le.total_blocked_customers)||0})]})}),e.jsx(a,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-info bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Total New Customers"}),e.jsx("div",{className:"fs-6 fw-bold text-info",children:((re=A.summary)==null?void 0:re.total_end_customers)||0})]})})]}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(p,{children:[e.jsx(l,{children:"Partner Details"}),e.jsx(l,{children:"Partner Type"}),e.jsx(l,{className:"text-center",children:"Companies Onboarded"}),e.jsx(l,{className:"text-center",children:"Active/Blocked"}),e.jsx(l,{className:"text-center",children:"Recent Growth"})]})}),e.jsx(D,{children:(te=A.partners)==null?void 0:te.map((s,n)=>e.jsxs(p,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.partner_name}),e.jsxs("div",{className:"text-muted small",children:["Mobile: ",s.partner_mobile]}),e.jsxs("div",{className:"text-muted small",children:["Email: ",s.partner_email]})]})}),e.jsx(i,{children:e.jsxs("div",{children:[e.jsx(O,{color:"info",children:s.partner_type}),e.jsxs("div",{className:"text-muted small mt-1",children:["Commission: ",s.commission_rate,"%"]})]})}),e.jsx(i,{className:"text-center fw-semibold",children:s.total_customers_onboarded}),e.jsxs(i,{className:"text-center",children:[e.jsxs("div",{className:"text-success",children:[s.active_customers," Active"]}),e.jsxs("div",{className:"text-danger",children:[s.blocked_customers," Blocked"]})]}),e.jsx(i,{className:"text-center",children:e.jsxs(O,{color:"success",children:["+",s.new_customers_last_30_days," (30d)"]})})]},n))})]})})]}),e.jsxs(H,{role:"tabpanel",visible:N===2,children:[e.jsx(m,{className:"mb-3",children:e.jsxs(a,{children:[e.jsx("h4",{children:"Payment Overview"}),e.jsx("p",{className:"text-muted",children:"Payment details across all categories"})]})}),e.jsxs(m,{className:"mb-4",children:[e.jsx(a,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-success bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Subscription Revenue"}),e.jsx("div",{className:"fs-6 fw-bold text-success",children:d((ne=y.summary)==null?void 0:ne.total_subscription_revenue)})]})}),e.jsx(a,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-warning bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Partner Commission"}),e.jsx("div",{className:"fs-6 fw-bold text-warning",children:d((ce=y.summary)==null?void 0:ce.total_partner_commission)})]})}),e.jsx(a,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-info bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Customer Outstanding"}),e.jsx("div",{className:"fs-6 fw-bold text-info",children:d((de=y.summary)==null?void 0:de.total_customer_outstanding)})]})}),e.jsx(a,{md:2,children:e.jsxs("div",{className:"text-center p-3 bg-primary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Receivable"}),e.jsx("div",{className:"fs-6 fw-bold text-primary",children:d((me=y.summary)==null?void 0:me.total_customer_receivable)})]})}),e.jsx(a,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-danger bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Payable"}),e.jsx("div",{className:"fs-6 fw-bold text-danger",children:d((oe=y.summary)==null?void 0:oe.total_customer_payable)})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Subscription Payments"}),e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{children:e.jsxs(p,{children:[e.jsx(l,{children:"Plan Name"}),e.jsx(l,{children:"Plan Price"}),e.jsx(l,{className:"text-center",children:"Total Subscriptions"}),e.jsx(l,{className:"text-center",children:"Total Revenue"})]})}),e.jsx(D,{children:(xe=y.subscription_payments)==null?void 0:xe.map((s,n)=>e.jsxs(p,{children:[e.jsx(i,{className:"fw-semibold",children:s.plan_name}),e.jsx(i,{children:d(s.plan_price)}),e.jsx(i,{className:"text-center",children:s.total_subscriptions}),e.jsx(i,{className:"text-center fw-semibold",children:d(s.total_revenue)})]},n))})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"mb-3",children:"Customer Payment Details"}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(p,{children:[e.jsx(l,{children:"Company"}),e.jsx(l,{children:"Plan"}),e.jsx(l,{className:"text-center",children:"Amount Paid"}),e.jsx(l,{className:"text-center",children:"Outstanding"}),e.jsx(l,{className:"text-center",children:"Payment Status"}),e.jsx(l,{className:"text-center",children:"Last Payment"})]})}),e.jsx(D,{children:(he=y.customer_payments)==null?void 0:he.map((s,n)=>{var v;return e.jsxs(p,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.company_name}),e.jsx("div",{className:"text-muted small",children:s.owner_name})]})}),e.jsx(i,{children:e.jsx(O,{color:"info",children:s.plan_name})}),e.jsx(i,{className:"text-center text-success fw-semibold",children:d(s.amount_paid)}),e.jsx(i,{className:"text-center text-warning",children:d(s.outstanding_amount)}),e.jsx(i,{className:"text-center",children:e.jsx(O,{color:s.payment_status==="paid"?"success":s.payment_status==="partial"?"warning":"danger",children:(v=s.payment_status)==null?void 0:v.toUpperCase()})}),e.jsx(i,{className:"text-center",children:s.last_payment_date?Ge(s.last_payment_date):"N/A"})]},n)})})]})})]})]}),e.jsxs(H,{role:"tabpanel",visible:N===3,children:[e.jsx(m,{className:"mb-3",children:e.jsxs(a,{children:[e.jsx("h4",{children:"Commission Calculation Summary"}),e.jsxs("p",{className:"text-muted",children:["Commission details for all sales partners - ",(je=_.period)==null?void 0:je.month_name]})]})}),e.jsxs(m,{className:"mb-4",children:[e.jsx(a,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-primary bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Total Commission Paid"}),e.jsx("div",{className:"fs-5 fw-bold text-primary",children:d((ue=_.summary)==null?void 0:ue.total_commission_paid)})]})}),e.jsx(a,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-success bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Revenue Generated"}),e.jsx("div",{className:"fs-6 fw-bold text-success",children:d((pe=_.summary)==null?void 0:pe.total_revenue_generated)})]})}),e.jsx(a,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-info bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Partners with Earnings"}),e.jsx("div",{className:"fs-5 fw-bold text-info",children:((ge=_.summary)==null?void 0:ge.partners_with_earnings)||0})]})}),e.jsx(a,{md:3,children:e.jsxs("div",{className:"text-center p-3 bg-warning bg-opacity-10 rounded",children:[e.jsx("div",{className:"text-muted small",children:"Avg Commission/Partner"}),e.jsx("div",{className:"fs-6 fw-bold text-warning",children:d((ve=_.summary)==null?void 0:ve.average_commission_per_partner)})]})})]}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(p,{children:[e.jsx(l,{children:"Partner Details"}),e.jsx(l,{children:"Partner Type"}),e.jsx(l,{className:"text-center",children:"Referred Companies"}),e.jsx(l,{className:"text-center",children:"Companies with Payments"}),e.jsx(l,{className:"text-center",children:"Revenue Generated"}),e.jsx(l,{className:"text-center",children:"Commission Earned"})]})}),e.jsx(D,{children:(be=_.partners_commission)==null?void 0:be.map((s,n)=>e.jsxs(p,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.partner_name}),e.jsxs("div",{className:"text-muted small",children:["Mobile: ",s.partner_mobile]}),e.jsxs("div",{className:"text-muted small",children:["Email: ",s.partner_email]})]})}),e.jsx(i,{children:e.jsxs("div",{children:[e.jsx(O,{color:"info",children:s.partner_type}),e.jsxs("div",{className:"text-muted small mt-1",children:["Rate: ",s.commission_rate,"%"]})]})}),e.jsx(i,{className:"text-center fw-semibold",children:s.total_referred_companies}),e.jsx(i,{className:"text-center",children:s.companies_with_payments}),e.jsx(i,{className:"text-center text-success fw-semibold",children:d(s.revenue_generated)}),e.jsx(i,{className:"text-center text-warning fw-semibold",children:d(s.commission_earned)})]},n))})]})})]}),e.jsxs(H,{role:"tabpanel",visible:N===4,children:[e.jsx(m,{className:"mb-3",children:e.jsxs(a,{children:[e.jsx("h4",{children:"Subscription Renewal Alerts"}),e.jsx("p",{className:"text-muted",children:"Companies requiring subscription renewal follow-up"})]})}),e.jsxs(m,{className:"mb-4",children:[e.jsx(a,{md:3,children:e.jsxs("div",{className:`text-center p-3 bg-warning bg-opacity-10 rounded cursor-pointer border ${x==="critical"?"border-warning border-2":"border-0"}`,style:{cursor:"pointer",transition:"all 0.2s"},onClick:()=>E(x==="critical"?"all":"critical"),title:"Click to filter critical renewals",children:[e.jsx("div",{className:"text-muted small",children:"Critical (â‰¤7 days)"}),e.jsx("div",{className:"fs-5 fw-bold text-warning",children:((Ne=t.summary)==null?void 0:Ne.critical_renewals)||0}),x==="critical"&&e.jsx("div",{className:"small text-warning mt-1",children:"â— Filtered"})]})}),e.jsx(a,{md:3,children:e.jsxs("div",{className:`text-center p-3 bg-info bg-opacity-10 rounded cursor-pointer border ${x==="upcoming"?"border-info border-2":"border-0"}`,style:{cursor:"pointer",transition:"all 0.2s"},onClick:()=>E(x==="upcoming"?"all":"upcoming"),title:"Click to filter upcoming renewals",children:[e.jsx("div",{className:"text-muted small",children:"Upcoming (â‰¤30 days)"}),e.jsx("div",{className:"fs-5 fw-bold text-info",children:((fe=t.summary)==null?void 0:fe.upcoming_renewals)||0}),x==="upcoming"&&e.jsx("div",{className:"small text-info mt-1",children:"â— Filtered"})]})}),e.jsx(a,{md:3,children:e.jsxs("div",{className:`text-center p-3 bg-danger bg-opacity-10 rounded cursor-pointer border ${x==="overdue"?"border-danger border-2":"border-0"}`,style:{cursor:"pointer",transition:"all 0.2s"},onClick:()=>E(x==="overdue"?"all":"overdue"),title:"Click to filter overdue renewals",children:[e.jsx("div",{className:"text-muted small",children:"Overdue"}),e.jsx("div",{className:"fs-5 fw-bold text-danger",children:((ye=t.summary)==null?void 0:ye.overdue_renewals)||0}),x==="overdue"&&e.jsx("div",{className:"small text-danger mt-1",children:"â— Filtered"})]})}),e.jsx(a,{md:3,children:e.jsxs("div",{className:`text-center p-3 bg-info bg-opacity-10 rounded cursor-pointer border ${x==="all"?"border-info border-2":"border-0"}`,style:{cursor:"pointer",transition:"all 0.2s"},onClick:()=>E("all"),title:"Click to show all renewals",children:[e.jsx("div",{className:"text-muted small",children:"Total Requiring Attention"}),e.jsx("div",{className:"fs-5 fw-bold text-info",children:((_e=t.renewal_stats)==null?void 0:_e.total_requiring_attention)||0}),x==="all"&&e.jsx("div",{className:"small text-info mt-1",children:"â— All Data"})]})})]}),x!=="all"&&e.jsx(m,{className:"mb-3",children:e.jsx(a,{children:e.jsxs("div",{className:"alert alert-danger d-flex justify-content-between align-items-center",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"Filter Active:"})," Showing ",U.length," ",x," renewal(s)"]}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>E("all"),children:"Clear Filter"})]})})}),e.jsx("div",{style:{maxHeight:"500px",overflowY:"auto"},children:e.jsxs(P,{hover:!0,responsive:!0,children:[e.jsx(T,{style:{position:"sticky",top:0,backgroundColor:"#fff",zIndex:2},children:e.jsxs(p,{children:[e.jsx(l,{children:"Company Name"}),e.jsx(l,{children:"Email"}),e.jsx(l,{children:"Days Remaining"}),e.jsx(l,{children:"Call"}),e.jsx(l,{children:"Message"})]})}),e.jsxs(D,{children:[U.map((s,n)=>{var v,g;return e.jsxs(p,{className:s.days_remaining<0?"table-danger":s.days_remaining<=7?"table-warning":s.days_remaining<=15?"table-info":"",children:[e.jsxs(i,{children:[e.jsx("div",{className:"fw-semibold",children:s.company_name}),e.jsxs("div",{className:"text-muted small",children:["ID: ",s.company_id]})]}),e.jsx(i,{children:s.email_id||"N/A"}),e.jsx(i,{children:s.days_remaining>=0?e.jsxs("span",{className:`fw-bold ${s.days_remaining<=7?"text-warning":(s.days_remaining<=15,"text-info")}`,children:[s.days_remaining," days left"]}):e.jsxs("span",{className:"fw-bold text-danger",children:[Math.abs(s.days_remaining)," days overdue"]})}),e.jsx(i,{className:"text-center",children:e.jsx("a",{className:"btn btn-outline-primary btn-sm",href:`tel:+91${(v=s.phone_no)==null?void 0:v.replace(/^(\+91)?/,"")}`,title:"Call Customer",children:e.jsx(u,{icon:ms})})}),e.jsx(i,{className:"text-center",children:e.jsx("a",{className:"btn btn-outline-success btn-sm",href:`sms:+91${(g=s.phone_no)==null?void 0:g.replace(/^(\+91)?/,"")}?body=${encodeURIComponent(s.days_remaining>=0?`Hi ${s.company_name}, your subscription expires in ${s.days_remaining} days.

Available Plans:
- Yearly Plan: â‚¹9999
- Half Yearly Plan: â‚¹4999.50

Please renew soon to continue enjoying our services-TiPic ConsulTech.`:`Hi ${s.company_name}, your subscription expired ${Math.abs(s.days_remaining)} days ago.

Available Plans:
- Yearly Plan: â‚¹9999
- Half Yearly Plan: â‚¹4999.50

Please renew immediately to restore services.`)}`,title:"Send SMS",children:e.jsx(u,{icon:os})})})]},n)}),U.length===0&&e.jsx(p,{children:e.jsx(i,{colSpan:5,className:"text-center text-muted py-4",children:e.jsxs("div",{className:"py-3",children:[e.jsx("div",{className:"fs-5 mb-2",children:"ðŸ“‹"}),e.jsx("div",{children:"No companies found for the selected filter."}),e.jsx("small",{className:"text-muted",children:"Try selecting a different filter or clear the current filter."})]})})})]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{children:"Quick Actions"}),e.jsxs(m,{className:"mb-3",children:[e.jsx(a,{md:3,children:e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-warning",onClick:()=>Y("critical"),disabled:!((we=t.summary)!=null&&we.critical_renewals),children:["Export Critical Renewals (",((Ce=t.summary)==null?void 0:Ce.critical_renewals)||0,")"]})})}),e.jsx(a,{md:3,children:e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-info",onClick:()=>Y("upcoming"),disabled:!((Se=t.summary)!=null&&Se.upcoming_renewals),children:["Export Upcoming Renewals (",((ke=t.summary)==null?void 0:ke.upcoming_renewals)||0,")"]})})}),e.jsx(a,{md:3,children:e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-danger",onClick:()=>Y("overdue"),disabled:!((Ae=t.summary)!=null&&Ae.overdue_renewals),children:["Export Overdue Renewals (",((Pe=t.summary)==null?void 0:Pe.overdue_renewals)||0,")"]})})}),e.jsx(a,{md:3,children:e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-info",onClick:()=>Y("all"),disabled:!((Te=t.expiring_companies)!=null&&Te.length),children:["Export All Renewals (",((De=t.expiring_companies)==null?void 0:De.length)||0,")"]})})})]})]})]})]})]})}),e.jsxs(m,{className:"mt-4 mb-5",children:["  ",e.jsx(a,{md:6,children:e.jsx(w,{children:e.jsxs(C,{children:[e.jsx("h5",{children:"System Health"}),e.jsxs("div",{className:"row text-center",children:[e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"text-muted small",children:"Active Partners"}),e.jsx("div",{className:"fs-5 fw-bold text-primary",children:((Re=A.summary)==null?void 0:Re.total_partners)||0})]}),e.jsxs("div",{className:"col",children:[e.jsx("div",{className:"text-muted small",children:"Active Companies"}),e.jsx("div",{className:"fs-5 fw-bold text-info",children:((Ee=k.summary)==null?void 0:Ee.total_companies)||0})]})]})]})})})]})]})};export{$s as default};
