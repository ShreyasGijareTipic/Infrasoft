import{u as E,r as h,d as k,b as B,j as a}from"./index-95D3pMM8.js";import{a as F,b as q,c as A}from"./api-CIBCEetx.js";import{u as P}from"./DefaultLayout-CJHw--2-.js";import{a as z,b as I}from"./index.esm-DxutiY6j.js";import{C as M,a as G}from"./CCardBody-dOzHbfOa.js";import{C as O}from"./CCardHeader-Cq-j3fyp.js";import{C as H}from"./CForm-DyhjnECG.js";import{C as d}from"./CFormLabel-C_2Vxs-X.js";import{C as p}from"./CFormInput-C_VETgxc.js";import{C as D}from"./CFormCheck-Ct4OionT.js";import{C as f}from"./CButton-B_ZYbnJ4.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-DjllxSOU.js";import"./CFormControlWrapper-DhbFIWP9.js";const se=()=>{const{t,i18n:j}=P("global");j.language;const x=E(),[g,L]=h.useState([]),S=k(),{showToast:n}=B(),[o,c]=h.useState({id:0,name:"",localName:"",slug:"",categoryId:0,incStep:1,desc:"",multiSize:!1,show:!0,showOnHome:!0,returnable:!0,qty:0,stock:0,oPrice:"",media:[],sizes:[]}),m=s=>{const{name:e,value:r}=s.target;if(["qty","incStep"].includes(e)){if(r===""){c(l=>({...l,[e]:""}));return}let i=parseFloat(r);if(isNaN(i)||i<0)return;c(l=>({...l,[e]:i}))}else if(e==="oPrice"){if(r===""){c(l=>({...l,[e]:""}));return}if(!/^\d*\.?\d{0,2}$/.test(r))return;c(l=>({...l,[e]:r}))}else c(i=>({...i,[e]:r}))},v=s=>{const{name:e,checked:r}=s.target;c({...o,[e]:r})},b=async()=>{try{const s=await F("/api/product/"+S.id);c({id:s.id,name:s.name,localName:s.localName,slug:s.slug,categoryId:s.categoryId,incStep:Math.max(1,s.incStep),desc:s.desc,multiSize:s.multiSize,show:s.show,returnable:s.sizes[0].returnable,showOnHome:s.showOnHome,unit:s.unit,qty:Math.max(0,parseInt(s.sizes[0].qty)),stock:Math.max(0,parseInt(s.sizes[0].stock)),oPrice:parseFloat(s.sizes[0].oPrice).toFixed(2),media:s.media,sizes:s.sizes})}catch(s){n("danger",t("MSG.error_occurred")+" "+s)}},_=()=>{var e,r,u;const s=localStorage.getItem("userData");if(!s)return!1;try{const i=JSON.parse(s),l=((u=(r=(e=i==null?void 0:i.user)==null?void 0:e.company_info)==null?void 0:r.subscribed_plan_name)==null?void 0:u.toLowerCase())||"";return l.includes("golden growth")||l.includes("elite")}catch(i){return console.error("Failed to parse user data",i),!1}};h.useEffect(()=>{b()},[]);const y=async()=>{const s=parseFloat(o.oPrice);if(isNaN(s)||s<0){n("danger",t("MSG.invalid_price"));return}if(o.qty<0){n("danger",t("MSG.negative_values_not_allowed"));return}let e={...o};e.slug=e.name.replace(/[^\w]/g,"_"),o.multiSize||(e.sizes[0].name=e.name,e.sizes[0].localName=e.localName,e.sizes[0].qty=Math.max(0,parseInt(e.qty)),e.sizes[0].stock=Math.max(0,parseInt(e.stock)),e.sizes[0].oPrice=parseFloat(e.oPrice).toFixed(2),e.sizes[0].dPrice=parseFloat(e.oPrice).toFixed(2),e.sizes[0].show=!0,e.sizes[0].returnable=e.returnable,e.sizes[0].showOnHome=e.showOnHome,delete e.oPrice,delete e.qty);try{const r=await q("/api/product/"+e.id,e);r!=null&&r.id?(await N(r.id),n("success",t("MSG.product_updated_successfully")),x("/products/all")):n("danger",t("MSG.error_try_again_later"))}catch(r){n("danger",t("MSG.error_occurred")+" "+r)}},C=async()=>{x("/products/all")},N=async s=>{if(!g.length)return;console.log("Uploading images for product ID:",s);const e=new FormData;g.forEach(r=>e.append("images[]",r)),e.append("product_id",s.toString());for(let r of e.entries())console.log(r[0]+": "+r[1]);try{await A("/api/product/media/multiple",e)}catch(r){throw console.error("Upload error:",r),r}},w=s=>{const e=s.target.value;if(e&&!isNaN(parseFloat(e))){const r=parseFloat(e).toFixed(2);c(u=>({...u,oPrice:r}))}};return a.jsx(z,{children:a.jsx(I,{xs:12,children:a.jsxs(M,{className:"mb-4",children:[a.jsx(O,{children:a.jsx("strong",{children:t("LABELS.edit_product")})}),a.jsx(G,{children:a.jsxs(H,{children:[a.jsxs("div",{className:"row mb-2",children:[a.jsxs("div",{className:"col-6",children:[a.jsx(d,{htmlFor:"pname",children:a.jsx("b",{children:t("LABELS.product_name")})}),a.jsx(p,{type:"text",id:"pname",placeholder:t("LABELS.product_name"),name:"name",value:o.name,onChange:m,required:!0,feedbackInvalid:t("LABELS.please_provide_name"),feedbackValid:t("LABELS.looks_good")}),a.jsx("div",{className:"invalid-feedback",children:t("LABELS.product_name_required")})]}),a.jsxs("div",{className:"col-6",children:[a.jsx(d,{htmlFor:"plname",children:a.jsx("b",{children:t("LABELS.local_name")})}),a.jsx(p,{type:"text",id:"plname",placeholder:t("LABELS.local_name"),name:"localName",value:o.localName,onChange:m,required:!0,feedbackInvalid:t("LABELS.please_provide_local_name"),feedbackValid:t("LABELS.looks_good")}),a.jsx("div",{className:"invalid-feedback",children:t("LABELS.local_name_required")})]})]}),a.jsxs("div",{className:"row mb-2",children:[a.jsxs("div",{className:"col-4",children:[a.jsx(d,{htmlFor:"qty",children:a.jsx("b",{children:t("LABELS.capacity")})}),a.jsx(p,{type:"number",id:"qty",placeholder:"0",min:"0",onWheel:s=>s.target.blur(),name:"qty",value:o.qty,onChange:m,required:!0}),a.jsx("div",{className:"invalid-feedback",children:t("LABELS.quantity_required")})]}),a.jsxs("div",{className:"col-4",children:[a.jsx(d,{htmlFor:"stock",children:a.jsx("b",{children:t("LABELS.stock")})}),a.jsx(p,{type:"number",id:"stock",placeholder:"0",min:"0",onWheel:s=>s.target.blur(),name:"stock",value:o.stock,onChange:m,required:!0}),a.jsx("div",{className:"invalid-feedback",children:t("LABELS.quantity_required")})]}),a.jsxs("div",{className:"col-4",children:[a.jsx(d,{htmlFor:"oPrice",children:a.jsx("b",{children:t("LABELS.selling_price")})}),a.jsx(p,{type:"text",id:"oPrice",placeholder:"0.00",name:"oPrice",value:o.oPrice,onWheel:s=>s.target.blur(),onChange:m,onBlur:w,pattern:"^\\d*\\.?\\d{0,2}$",title:"Please enter a valid price (up to 2 decimal places)",required:!0}),a.jsx("div",{className:"invalid-feedback",children:t("LABELS.selling_price_required")})]})]}),_()&&a.jsxs("div",{className:"mb-3",children:[a.jsx(d,{children:a.jsx("b",{children:t("LABELS.add_images")})}),a.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:s=>L([...s.target.files]),className:"form-control"})]}),a.jsx("div",{className:"row mb-2",children:a.jsx("div",{className:"col-6",children:a.jsx(D,{id:"show",label:t("LABELS.show_for_invoicing"),name:"show",checked:o.show,value:o.show,onChange:v})})}),a.jsxs("div",{className:"mb-3",children:[a.jsx(f,{color:"success",onClick:y,children:t("LABELS.update")}),a.jsx(f,{color:"secondary",style:{marginLeft:"5px"},onClick:C,children:t("LABELS.cancel")})]})]})})]})})})};export{se as default};
