import{r as o,b as G,j as e,u as Y}from"./index-fatTeUCR.js";import{e as A,a as F,b as U,d as q}from"./api-CIBCEetx.js";import{S as J}from"./react-select.esm-BEmt4-z-.js";import{a as B,b as R,d as z,e as H,c as K}from"./DefaultLayout-Dto4nkGD.js";import{C as c}from"./CFormInput-wID138bU.js";import{b as E,a as O}from"./index.esm-Mmat67Is.js";import{C as Q}from"./CFormLabel-Cp8KupB2.js";import{C as X}from"./CFormTextarea-cNlJlc5V.js";import{C as I}from"./CFormSwitch-CQfvd2oX.js";import{C as x}from"./CButton-Dnh0eu3x.js";import{C as Z,a as ee}from"./CCardBody-CWs2rFEf.js";import{C as se}from"./CCardHeader-DIjx7CZA.js";import{C as w}from"./cil-mobile-D_M5GP1R.js";import{C as ae,a as re,b as D,c as n,d as le,e as t}from"./CTable-BlnPdtp1.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./emotion-react.browser.esm-BbVd1h2C.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./RawMaterial-BtjEDAbB.js";import"./CFormControlWrapper-BGWL0obt.js";const te=({project:i,onClose:b,onUpdateSuccess:v})=>{const[r,C]=o.useState({...i,start_date:i.start_date?i.start_date.split("T")[0]:"",end_date:i.end_date?i.end_date.split("T")[0]:""}),{showToast:h}=G(),d=A(),[g,y]=o.useState([]),_=async()=>{try{const a=await F("/api/usersData");y((a==null?void 0:a.users)||[])}catch(a){console.error("Error fetching users:",a),y([])}};o.useEffect(()=>{(d===1||d===3)&&_()},[d]);const l=a=>{const{name:f,value:u,type:p,checked:P}=a.target;C(N=>({...N,[f]:p==="checkbox"?P?1:0:u}))},k=async()=>{try{(await U(`/api/projectsUpdate/${r.id}`,r)).success&&(h("success","Project updated successfully"),v())}catch(a){console.error("Error updating project:",a),h("danger","Error updating project")}};return e.jsxs(B,{visible:!0,onClose:b,alignment:"center",size:"lg",children:[e.jsx(R,{children:"Update Project"}),e.jsx(z,{children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-2",children:e.jsx(c,{label:"Customer Name",name:"customer_name",value:r.customer_name||"",onChange:l})}),e.jsx("div",{className:"col-md-6 mb-2",children:e.jsx(c,{label:"Mobile Number",name:"mobile_number",value:r.mobile_number||"",onChange:l})}),e.jsx("div",{className:"col-md-6 mb-2",children:e.jsx(c,{label:"Project Name",name:"project_name",value:r.project_name||"",onChange:l})}),e.jsx("div",{className:"col-md-6 mb-2",children:e.jsx(c,{label:"Project Cost",name:"project_cost",value:r.project_cost||"",onChange:l})}),e.jsx("div",{className:"col-md-6 mb-2",children:e.jsx(c,{label:"Work Place",name:"work_place",value:r.work_place||"",onChange:l})}),e.jsx("div",{className:"col-md-6 mb-2",children:e.jsx(c,{type:"date",label:"Start Date",name:"start_date",value:r.start_date||"",onChange:l})}),e.jsx("div",{className:"col-md-6 mb-2",children:e.jsx(c,{type:"date",label:"End Date",name:"end_date",value:r.end_date||"",onChange:l})}),(d===1||d===3)&&e.jsxs(E,{md:6,className:"mb-2",children:[e.jsx(Q,{children:"Supervisor"}),e.jsx(J,{options:g.map(a=>({value:a.id,label:a.name})),value:g.map(a=>({value:a.id,label:a.name})).find(a=>a.value===r.supervisor_id)||null,onChange:a=>C(f=>({...f,supervisor_id:a?a.value:""})),placeholder:"Select Supervisor"})]}),e.jsx("div",{className:"col-md-6 mb-2",children:e.jsx(c,{label:"Commission",name:"commission",value:r.commission||"",onChange:l})}),e.jsx("div",{className:"col-md-6 mb-2",children:e.jsx(c,{label:"GST Number",name:"gst_number",value:r.gst_number||"",onChange:l})}),e.jsx("div",{className:"col-md-6 mb-2",children:e.jsx(c,{label:"PAN Number",name:"pan_number",value:r.pan_number||"",onChange:l})}),e.jsx("div",{className:"col-md-12 mb-2",children:e.jsx(X,{label:"Remark",name:"remark",rows:3,value:r.remark||"",onChange:l})}),e.jsx("div",{className:"col-md-6 mb-3 d-flex align-items-center",children:e.jsx(I,{id:"is_visible",label:"Visible",name:"is_visible",checked:r.is_visible===1||r.is_visible===!0,onChange:l})})]})}),e.jsxs(H,{children:[e.jsx(x,{color:"secondary",onClick:b,children:"Cancel"}),e.jsx(x,{color:"primary",onClick:k,children:"Save Changes"})]})]})},ke=()=>{const[i,b]=o.useState([]),[v,r]=o.useState(!1),[C,h]=o.useState({}),[d,g]=o.useState(""),y=Y(),[_,l]=o.useState(null),[k,a]=o.useState(!1),[f,u]=o.useState(!1),[p,P]=o.useState(null),N=A(),L=s=>{l(s),a(!0)},S=async()=>{var s,j;try{r(!0);const m=await F("/api/myProjects");b(Array.isArray(m)?m:[]),h({})}catch(m){console.error("Error fetching projects:",m),b([]),h({general:((j=(s=m.response)==null?void 0:s.data)==null?void 0:j.message)||"Failed to fetch projects. Please check the server and try again."})}finally{r(!1)}};o.useEffect(()=>{S()},[]);const $=async(s,j)=>{var m,T;try{r(!0),await U(`/api/projects/${s}`,{is_visible:!j}),g("Project visibility updated successfully!"),await S()}catch(M){console.error("Error updating visibility:",M),h({general:((T=(m=M.response)==null?void 0:m.data)==null?void 0:T.message)||"Failed to update project visibility."})}finally{r(!1)}},V=s=>{P(s),u(!0)},W=async()=>{try{await q(`/api/projectsDelete/${p.id}`),u(!1),g("Project deleted successfully!"),S()}catch(s){console.log("Delete error:",s),h({general:"Failed to delete project."})}};return e.jsx("div",{className:"container-lg p-2",children:e.jsxs(Z,{children:[e.jsxs(se,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Projects"}),e.jsx(x,{color:"danger",onClick:()=>y("/projects/new"),children:"New Project"})]}),e.jsxs(ee,{children:[d&&e.jsx(w,{color:"success",children:d}),C.general&&e.jsx(w,{color:"danger",children:C.general}),v&&e.jsx(w,{color:"info",children:"Loading projects..."}),e.jsxs(ae,{responsive:!0,hover:!0,children:[e.jsx(re,{children:e.jsxs(D,{children:[e.jsx(n,{children:"ID"}),e.jsx(n,{children:"Customer Name"}),e.jsx(n,{children:"Project Name"}),e.jsx(n,{children:"Work Place"}),e.jsx(n,{children:"Start Date"}),e.jsx(n,{children:"End Date"}),e.jsx(n,{children:"Supervisor"}),e.jsx(n,{children:"Remark"}),e.jsx(n,{children:"Commission"}),e.jsx(n,{children:"Visible"}),e.jsx(n,{children:"Action"})]})}),e.jsx(le,{children:i.length>0?i.map(s=>{var j;return e.jsxs(D,{children:[e.jsx(t,{children:s.id}),e.jsx(t,{children:s.customer_name}),e.jsx(t,{children:s.project_name}),e.jsx(t,{children:s.work_place}),e.jsx(t,{children:s.start_date||"N/A"}),e.jsx(t,{children:s.end_date||"N/A"}),e.jsx(t,{children:((j=s.supervisor)==null?void 0:j.name)||"N/A"}),e.jsx(t,{children:s.remark||"N/A"}),e.jsx(t,{children:s.commission||"N/A"}),e.jsx(t,{children:e.jsx(I,{checked:s.is_visible,onChange:()=>$(s.id,s.is_visible),disabled:v})}),e.jsx(t,{children:e.jsxs(O,{className:"g-2",children:[e.jsx(E,{xs:"6",className:"d-flex justify-content-start",children:e.jsx(x,{color:"warning",size:"sm",onClick:()=>L(s),children:"Edit"})}),e.jsx(E,{xs:"6",className:"d-flex justify-content-start",children:(N===1||N===3)&&e.jsx(x,{color:"danger",size:"sm",onClick:()=>V(s),children:"Delete"})})]})})]},s.id)}):e.jsx(D,{children:e.jsx(t,{colSpan:"11",className:"text-center",children:"No projects found."})})})]}),k&&_&&e.jsx(te,{project:_,onClose:()=>a(!1),onUpdateSuccess:()=>{a(!1),S()}}),e.jsxs(B,{visible:f,onClose:()=>u(!1),children:[e.jsx(R,{closeButton:!0,children:e.jsxs(K,{children:["Delete Project - ",p==null?void 0:p.project_name,"?"]})}),e.jsx(z,{children:e.jsxs("p",{style:{fontSize:"16px"},children:["Do you really want to"," ",e.jsx("span",{style:{color:"red",fontWeight:"bold"},children:"Delete"})," ","this project?"]})}),e.jsxs(H,{children:[e.jsx(x,{color:"secondary",onClick:()=>u(!1),children:"Close"}),e.jsx(x,{color:"primary",onClick:W,children:"Yes"})]})]})]})]})})};export{ke as default};
