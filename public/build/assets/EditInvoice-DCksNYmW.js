import{d as w,u as O,e as x,r as m,b as k,j as y}from"./index-95D3pMM8.js";import{a as D,b as L}from"./api-CIBCEetx.js";import M from"./Invoice-Y-IFP4Aa.js";import{u as q}from"./DefaultLayout-CJHw--2-.js";/* empty css                */import"./index.esm-DxutiY6j.js";import"./ProjectSelectionModal-C6_C1_sM.js";import"./CFormInput-C_VETgxc.js";import"./CFormControlWrapper-DhbFIWP9.js";import"./CFormLabel-C_2Vxs-X.js";import"./CTable-E2GxfeJ9.js";import"./CButton-B_ZYbnJ4.js";import"./CCardBody-dOzHbfOa.js";import"./CCardHeader-Cq-j3fyp.js";import"./CForm-DyhjnECG.js";import"./CInputGroup-B3cbnFfp.js";import"./CInputGroupText-CMKr1FZN.js";import"./cil-x-0440B5Ce.js";import"./cil-search-CDkY_4k-.js";import"./cil-plus-D8mtC-W5.js";import"./CFormSelect-uqS5fg-9.js";import"./cil-pencil-m516yCOw.js";import"./CFormTextarea-B-FmTaE-.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-DjllxSOU.js";const ct=()=>{const{id:n}=w(),A=O(),N=x(),s=new URLSearchParams(N.search).get("convertTo"),[T,v]=m.useState(null),[h,P]=m.useState(!0),[j,S]=m.useState(!1),{showToast:i}=k(),{t:a}=q("global");m.useEffect(()=>{(async()=>{try{const t=await D(`/api/order/${n}`);if(console.log("Fetched order:",t),t){const e=t.project||{},u=Number(t.gst||0),d=Number(t.sgst||0),l=Number(t.cgst||0),p=Number(t.igst||0),o=Number(t.totalAmount||0);let g=0,_=0,b=0,f=0;o>0&&(g=u/o*100,_=d/o*100,b=l/o*100,f=p/o*100),v({projectId:t.project_id||e.id||null,customer_id:t.customer_id||null,projectName:e.project_name||"N/A",customer:{name:e.customer_name||"Unknown",address:e.work_place||"",mobile:e.mobile_number||""},lat:t.lat||"",long:t.long||"",payLater:!!t.payLater,isSettled:!!t.isSettled,invoiceDate:t.invoiceDate||"",deliveryTime:t.deliveryTime||"",deliveryDate:t.deliveryDate||"",invoiceType:s?parseInt(s):t.invoiceType||3,orderStatus:s?parseInt(s):t.orderStatus||1,items:(t.items||[]).map(r=>({id:r.id,work_type:r.work_type||"",uom:r.uom||"",qty:Number(r.qty||0),price:Number(r.price||0),total_price:Number(r.total_price||0),remark:r.remark||"",gst_percent:r.gst_percent!==null&&r.gst_percent!==void 0?Number(r.gst_percent):18,cgst_amount:Number(r.cgst_amount||0),sgst_amount:Number(r.sgst_amount||0)})),totalAmount:o,subtotal:o,taxableAmount:o,discount:Number(t.discount||0),paidAmount:Number(t.paidAmount||0),finalAmount:Number(t.finalAmount||0),balanceAmount:Number(t.finalAmount||0)-Number(t.paidAmount||0),gstAmount:u,sgstAmount:d,cgstAmount:l,igstAmount:p,gstPercentage:Math.round(g*100)/100,sgstPercentage:Math.round(_*100)/100,cgstPercentage:Math.round(b*100)/100,igstPercentage:Math.round(f*100)/100,paymentType:t.paymentType||0,company_id:t.company_id||null,payment_terms:t.payment_terms||"",terms_and_conditions:t.terms_and_conditions||"",note:t.note||"",ref_id:t.ref_id||"",po_number:t.po_number||""}),S(!0)}else i("danger","No order data found")}catch(t){console.error("Fetch order error:",t),i("danger",a("TOAST.fetch_order_failed"))}finally{P(!1)}})()},[n,s,a]);const I=async c=>{try{const t={...c,id:n,project_id:c.projectId,remainingBalance:Number(c.finalAmount||0)-Number(c.paidAmount||0)};console.log("Updating order:",t);const e=await L(`/api/order/${n}`,t);e!=null&&e.success?(i("success",a("TOAST.order_updated")),A(`/invoice-details/${n}`)):i("danger",(e==null?void 0:e.message)||a("TOAST.update_failed"))}catch(t){console.error("Update error:",t),i("danger",a("TOAST.update_error"))}};return h||!j?y.jsx("div",{children:a("TOAST.loading")}):y.jsx(M,{editMode:!0,initialData:T,onSubmit:I})};export{ct as default};
