import{r as t,b as _,j as e}from"./index-RpBzfmRP.js";import{c as x,M as D}from"./mantine-react-table.esm-BVso0d4Q.js";import{a as E}from"./api-CIBCEetx.js";import{a as P,b as S}from"./index.esm-DUetlGrP.js";import{C as T,a as N}from"./CCardBody-CXkOMOvY.js";import{C as K}from"./CCardHeader-eGsVFHQg.js";import{C as i}from"./CButton-L7dQWiht.js";import{C as R}from"./cil-mobile-BmZiFZXB.js";import{C as d}from"./DefaultLayout-8YNBKV_4.js";import"./Table-B0BxSSAw.js";import"./MantineProvider-CyXtl0YD.js";import"./emotion-react.browser.esm-CMGNWn0o.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./RawMaterial-BtjEDAbB.js";/**
 * @license @tabler/icons-react v3.26.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var I=x("outline","alert-circle","IconAlertCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 8v4",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.26.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var A=x("outline","calendar-stats","IconCalendarStats",[["path",{d:"M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4",key:"svg-0"}],["path",{d:"M18 14v4h4",key:"svg-1"}],["path",{d:"M18 18m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0",key:"svg-2"}],["path",{d:"M15 3v4",key:"svg-3"}],["path",{d:"M7 3v4",key:"svg-4"}],["path",{d:"M3 11h16",key:"svg-5"}]]);const Z=()=>{const[u,f]=t.useState([]),[m,h]=t.useState(!0),[s,o]=t.useState(1),[c,j]=t.useState(1),[g,v]=t.useState(""),{showToast:p}=_(),l=15,y=async()=>{h(!0);try{const a=await E(`/api/expiring-companies?days=${l}&page=${s}&search=${g}`);f(a.data.data||[]),j(a.data.last_page||1)}catch(a){p("danger","Error fetching companies with expiring subscriptions"),console.error("Error fetching data:",a)}h(!1)};t.useEffect(()=>{y()},[s,g]);const b=a=>{const n=new Date(a),r=new Date,M=n.getTime()-r.getTime();return Math.ceil(M/(1e3*3600*24))},w=()=>{y(),p("success","Dashboard refreshed")},k=[{accessorKey:"index",header:"#",size:50},{accessorKey:"company_name",header:"Company",size:200},{accessorKey:"contact_person",header:"Contact Person",size:150},{accessorKey:"phone_no",header:"Mobile",size:120},{accessorKey:"email_id",header:"Email",size:180},{accessorKey:"current_plan",header:"Current Plan",size:120},{accessorKey:"valid_till",header:"Valid Till",size:120,Cell:({cell:a})=>new Date(a.getValue()).toLocaleDateString()},{accessorKey:"days_remaining",header:"Days Left",size:100,Cell:({cell:a,row:n})=>{const r=a.getValue();return e.jsxs(d,{color:r<=5?"danger":"warning",children:[r," days"]})}},{accessorKey:"actions",header:"Actions",size:100,Cell:({row:a})=>e.jsx(i,{size:"sm",color:"primary",onClick:()=>window.location.href=`/companies/renew/${a.original.id}`,children:"Renew"})}],C=u.map((a,n)=>({...a,index:n+1,days_remaining:b(a.valid_till)})).sort((a,n)=>a.days_remaining-n.days_remaining),z=C.length===0&&!m;return e.jsx(e.Fragment,{children:e.jsx(P,{className:"mb-3",children:e.jsx(S,{children:e.jsxs(T,{children:[e.jsxs(K,{className:"d-flex justify-content-between align-items-center bg-warning-subtle",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(A,{size:24,className:"me-2"}),e.jsxs("h4",{className:"mb-0",children:["Companies Expiring in ",l," Days"]})]}),e.jsx(i,{color:"primary",size:"sm",onClick:w,children:"Refresh Data"})]}),e.jsx(N,{children:z?e.jsxs(R,{color:"success",children:[e.jsx(I,{className:"me-2"}),"No companies are expiring within the next ",l," days."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{columns:k,data:C,state:{isLoading:m},enableStickyHeader:!0,enableColumnResizing:!0,enableGlobalFilter:!0,enableColumnFilters:!0,enablePagination:!0,manualPagination:!0,rowCount:c*10,onGlobalFilterChange:v,onPaginationChange:({pageIndex:a})=>o(a+1),initialState:{density:"compact",sorting:[{id:"days_remaining",desc:!1}]},renderTopToolbarCustomActions:()=>e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(d,{color:"danger",children:"Critical (<= 5 days)"}),e.jsx(d,{color:"warning",children:"Warning (<= 15 days)"})]})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx(i,{disabled:s===1,onClick:()=>o(s-1),children:"Previous"}),e.jsxs("span",{children:["Page ",s," of ",c]}),e.jsx(i,{disabled:s===c,onClick:()=>o(s+1),children:"Next"})]})]})})]})})})})};export{Z as default};
