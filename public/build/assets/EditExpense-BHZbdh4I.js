import{r as m,b as D,k as S,j as e}from"./index-Cs-5ghpe.js";import{a as F,b as P}from"./api-CIBCEetx.js";import{r as G,p as O}from"./Feilds-BHjWXeSc.js";import{u as $,a as V,b as z,c as H,d as R,e as J}from"./DefaultLayout-05E0ZdWa.js";import{C as K}from"./CForm-BcOVBk6n.js";import{C as s}from"./CFormLabel-DHukGEEc.js";import{C as _}from"./CFormSelect-DaxkqWsS.js";import{C as l}from"./CFormInput-BnDllJdd.js";import{C as A}from"./CButton-n5jldtHI.js";const se=({visible:o,onClose:b,expense:i,onExpenseUpdated:g})=>{const[w,p]=m.useState(!1),[B,T]=m.useState([]),[u,y]=m.useState(!1),{showToast:d}=D(),{t:r}=$("global"),[n,x]=m.useState({name:"",desc:"",expense_id:void 0,qty:1,price:0,total_price:0,expense_date:new Date().toISOString().split("T")[0],show:!0,gst:"",sgst:"",cgst:"",igst:"",contact:"",payment_by:"",payment_type:"",pending_amount:"",isGst:0,photoAvailable:0,photo_url:"",photo_remark:"",bank_name:"",acc_number:"",ifsc:"",aadhar:"",pan:"",transaction_id:""}),v=()=>localStorage.getItem("i18nextLng")||S.language||"en",q=(a,c=null)=>(c||v())==="mr"&&a.localName||a.name,C=async()=>{try{const a=await F("/api/expenseType");T(a.filter(c=>c.show===1))}catch(a){d("danger","Error occurred "+a)}};m.useEffect(()=>{o&&C()},[o]),m.useEffect(()=>{o&&C()},[S.language,o]),m.useEffect(()=>{i&&o&&(x({...n,...i,expense_date:i.expense_date||new Date().toISOString().split("T")[0],show:i.show!==void 0?i.show:!0}),p(!1))},[i,o]);const N=a=>Number((Math.round(a*100)/100).toFixed(2)),k=a=>{const c=N(parseFloat(a.qty)||0),h=N(parseFloat(a.price)||0);a.total_price=Math.round(c*h)},t=a=>{const{name:c,value:h}=a.target;["price","qty"].includes(c)?x(j=>{const L={...j,[c]:h};return k(L),L}):x(j=>({...j,[c]:h}))},f=async a=>{if(a.preventDefault(),a.stopPropagation(),p(!0),n.contact&&!/^\d{10}$/.test(n.contact)){d("danger","Contact number must be exactly 10 digits.");return}if(!n.payment_type){d("danger","Please select payment type");return}if(n.expense_id&&n.price>0&&n.qty>0){y(!0);try{const c={...n,id:i.id};await P(`/api/expense/${i.id}`,c)?(d("success",r("MSG.expense_updated_successfully")),g&&g(c),b()):d("danger",r("MSG.error_occured_please_try_again_later_msg"))}catch(c){d("danger","Error occurred "+c)}finally{y(!1)}}else d("danger",r("MSG.fill_required_fields"))},E=()=>{p(!1),b()},I=new Date().toISOString().split("T")[0],M=v();return e.jsxs(V,{visible:o,onClose:E,size:"xl",children:[e.jsx(z,{children:e.jsx(H,{children:r("LABELS.edit_expense")})}),e.jsx(R,{children:e.jsxs(K,{noValidate:!0,validated:w,onSubmit:f,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-6 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:r("LABELS.expense_type")})}),e.jsxs(_,{name:"expense_id",value:n.expense_id||"",onChange:t,required:!0,children:[e.jsx("option",{value:"",children:r("MSG.select_expense_type_msg")}),B.map(a=>e.jsx("option",{value:a.id,children:q(a,M)},a.id))]})]}),e.jsxs("div",{className:"col-sm-6 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:r("LABELS.about_expense")})}),e.jsx(l,{name:"name",value:n.name,onChange:t,placeholder:"Enter expense name"})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:r("LABELS.expense_date")})}),e.jsx(l,{type:"date",name:"expense_date",max:I,value:n.expense_date,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:r("LABELS.price_per_unit")})}),e.jsx(l,{type:"number",name:"price",min:"0",step:"0.01",value:n.price,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:r("LABELS.total_units")})}),e.jsx(l,{type:"number",name:"qty",step:"0.01",min:"0",value:n.qty,onChange:t,required:!0})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:r("LABELS.total_price")})}),e.jsx(l,{readOnly:!0,name:"total_price",value:n.total_price})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:r("LABELS.contact")})}),e.jsx(l,{type:"text",name:"contact",value:n.contact||"",onChange:a=>{const c=a.target.value;/^\d{0,10}$/.test(c)&&t(a)},maxLength:10,inputMode:"numeric",placeholder:"Enter contact"})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:r("LABELS.payment_by")})}),e.jsxs(_,{name:"payment_by",value:n.payment_by||"",onChange:t,children:[e.jsx("option",{value:"",children:r("LABELS.select_payment_by")}),G.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:r("LABELS.payment_type")})}),e.jsxs(_,{name:"payment_type",value:n.payment_type||"",onChange:t,required:!0,children:[e.jsx("option",{value:"",children:"Select Payment Type"}),O.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]})]}),(n.payment_type==="imps"||n.payment_type==="rtgs"||n.payment_type==="neft")&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-3 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:"Bank Name"})}),e.jsx(l,{name:"bank_name",value:n.bank_name||"",onChange:t,placeholder:"Enter Bank Name"})]}),e.jsxs("div",{className:"col-sm-3 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:"Account Number"})}),e.jsx(l,{name:"acc_number",value:n.acc_number||"",onChange:t,placeholder:"Enter Account Number"})]}),e.jsxs("div",{className:"col-sm-3 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:"IFSC"})}),e.jsx(l,{name:"ifsc",value:n.ifsc||"",onChange:t,placeholder:"Enter IFSC"})]}),e.jsxs("div",{className:"col-sm-3 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:"Transaction ID"})}),e.jsx(l,{name:"transaction_id",value:n.transaction_id||"",onChange:t,placeholder:"Enter Transaction ID"})]})]}),n.payment_type==="upi"&&e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:"Transaction ID"})}),e.jsx(l,{name:"transaction_id",value:n.transaction_id||"",onChange:t,placeholder:"Enter Transaction ID"})]})}),n.payment_type==="cheque"&&e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:"Cheque Number"})}),e.jsx(l,{name:"transaction_id",value:n.transaction_id||"",onChange:t,placeholder:"Enter Cheque Number"})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:"Bank Name"})}),e.jsx(l,{name:"bank_name",value:n.bank_name||"",onChange:t,placeholder:"Enter Bank Name"})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:"Aadhar Number"})}),e.jsx(l,{name:"aadhar",value:n.aadhar||"",onChange:t,placeholder:"Enter Aadhar Number"})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:"PAN"})}),e.jsx(l,{name:"pan",value:n.pan||"",onChange:t,placeholder:"Enter PAN"})]}),e.jsxs("div",{className:"col-sm-4 mb-3",children:[e.jsx(s,{children:e.jsx("b",{children:"Pending Amount"})}),e.jsx(l,{type:"number",name:"pending_amount",value:n.pending_amount||0,onChange:t,placeholder:"Enter Pending Amount"})]})]})]})}),e.jsxs(J,{children:[e.jsx(A,{color:"secondary",onClick:E,disabled:u,children:r("LABELS.cancel")}),e.jsx(A,{color:"primary",onClick:f,disabled:u,children:u?"Updating...":r("LABELS.update_expense")})]})]})};export{se as E};
