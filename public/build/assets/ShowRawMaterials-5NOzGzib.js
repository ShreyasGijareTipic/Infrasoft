import{r as a,u as W,b as X,j as e}from"./index-C2yVeD7S.js";import{a as A,b as Z,d as ee}from"./api-CIBCEetx.js";import{C as se}from"./ConfirmationModal-arXE52xA.js";import te from"./addQty-DDXqVRn6.js";import{C as ae,a as le}from"./CCardBody-D-jAy6vr.js";import{C as re}from"./CCardHeader-6bNqU1xa.js";import{C as D}from"./CFormSelect-Cs5qoCpd.js";import{C as r}from"./CButton-pXUvGqWL.js";import{a as ce,b as ne,c as oe,d as ie,e as de}from"./DefaultLayout-BQzMumzV.js";import{a as E,b as j}from"./index.esm-BfesGHR4.js";import{C as x}from"./CFormLabel-eLpXnSYX.js";import{C as F}from"./CFormInput-CXoXZ5N_.js";import"./Feilds-BHjWXeSc.js";import"./CFormCheck-BVuPHuFe.js";import"./CFormControlWrapper-D7XNeBGJ.js";import"./RawMaterial-BtjEDAbB.js";import"./cil-mobile-YEmBCbC2.js";const Pe=()=>{const[u,R]=a.useState([]),[p,L]=a.useState([]),[z,C]=a.useState(!1),[f,g]=a.useState(null),[c,M]=a.useState({name:"",local_name:"",project_id:"",current_stock:""}),Q=W(),{showToast:i}=X(),V=async()=>{try{const s=await A("/api/myProjects");L(s||[])}catch(s){console.error("Error fetching projects",s)}},n=async(s="")=>{try{let t="/api/index";s&&(t+=`?project_id=${s}`);const l=await A(t);R(l.materials||[])}catch(t){console.error("Error fetching raw materials",t)}};a.useEffect(()=>{n(),V()},[]);const I=s=>{var l;const t=((l=s.logs)==null?void 0:l[0])||{};g(s),M({name:s.name||"",local_name:s.local_name||"",project_id:t.project_id||"",current_stock:t.current_stock||""}),C(!0)},d=()=>{C(!1),g(null)},h=s=>{M({...c,[s.target.name]:s.target.value})},T=async()=>{if(f)try{await Z(`/api/rawMaterial/${f.id}`,c),i("success","Material updated successfully!"),d(),n()}catch{i("danger","Failed to update material")}},[$,m]=a.useState(!1),[o,b]=a.useState(null),B=s=>{b(s),m(!0)},U=async()=>{if(o)try{await ee(`/api/rawMaterial/${o.id}`)&&(i("success","Material deleted successfully!"),n())}catch{i("danger","Failed to delete the material.")}finally{m(!1),b(null)}},[H,y]=a.useState(!1),[Y,q]=a.useState(null),G=s=>{q(s),y(!0)},[J,K]=a.useState(""),O=s=>{const t=s.target.value;K(t),n(t)};return e.jsxs(e.Fragment,{children:[e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2",children:[e.jsx("strong",{children:"Raw Materials"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsxs(D,{size:"sm",className:"w-auto",value:J,onChange:O,children:[e.jsx("option",{value:"",children:"-- All Projects --"}),p.map(s=>e.jsx("option",{value:s.id,children:s.project_name},s.id))]}),e.jsx(r,{color:"danger",size:"sm",onClick:()=>Q("/newRawMaterials"),children:"Add Raw Material"})]})]})}),e.jsx(le,{children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Material Name"}),e.jsx("th",{children:"Local Name"}),e.jsx("th",{children:"Project Name"}),e.jsx("th",{children:"Current Stock"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:u.length>0?u.map(s=>{var t,l,w,v,_,N,S,P,k;return e.jsxs("tr",{children:[e.jsx("td",{children:s.id}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.local_name||"-"}),e.jsx("td",{children:((w=(l=(t=s.logs)==null?void 0:t[0])==null?void 0:l.project)==null?void 0:w.project_name)||"-"}),e.jsx("td",{children:((_=(v=s.logs)==null?void 0:v[0])==null?void 0:_.current_stock)??"-"}),e.jsx("td",{children:((S=(N=s.logs)==null?void 0:N[0])==null?void 0:S.unit)??"-"}),e.jsx("td",{children:((k=(P=s.logs)==null?void 0:P[0])==null?void 0:k.total)??"-"}),e.jsxs("td",{className:"d-flex flex-wrap gap-2",children:[e.jsx(r,{size:"sm",color:"success",onClick:()=>G(s),children:"Add Qty"}),e.jsx(r,{size:"sm",color:"warning",onClick:()=>I(s),children:"Edit"}),e.jsx(r,{size:"sm",color:"danger",onClick:()=>B(s),children:"Delete"})]})]},s.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center",children:"No materials found"})})})]})})})]}),e.jsx(se,{visible:$,setVisible:m,onYes:U,resource:`Delete material - ${o==null?void 0:o.name}`}),e.jsx(te,{visible:H,onClose:()=>y(!1),material:Y,refreshList:n}),e.jsxs(ce,{visible:z,onClose:d,children:[e.jsx(ne,{onClose:d,children:e.jsx(oe,{children:"Edit Raw Material"})}),e.jsxs(ie,{children:[e.jsxs(E,{className:"mb-3",children:[e.jsxs(j,{xs:12,md:6,className:"mb-2",children:[e.jsx(x,{children:"Name *"}),e.jsx(F,{name:"name",value:c.name,onChange:h})]}),e.jsxs(j,{xs:12,md:6,children:[e.jsx(x,{children:"Local Name"}),e.jsx(F,{name:"local_name",value:c.local_name,onChange:h})]})]}),e.jsx(E,{className:"mb-3",children:e.jsxs(j,{xs:12,md:6,children:[e.jsx(x,{children:"Project *"}),e.jsxs(D,{name:"project_id",value:c.project_id,onChange:h,children:[e.jsx("option",{value:"",children:"-- Select Project --"}),p.map(s=>e.jsx("option",{value:s.id,children:s.project_name},s.id))]})]})})]}),e.jsxs(de,{children:[e.jsx(r,{color:"secondary",onClick:d,children:"Cancel"}),e.jsx(r,{color:"primary",onClick:T,children:"Update"})]})]})]})};export{Pe as default};
