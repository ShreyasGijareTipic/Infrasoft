import{r as a,b as va,j as e,C as S,R as Na}from"./index-BjGmA7Bo.js";import{a as te,p as we,b as Hs,d as Ca}from"./api-CIBCEetx.js";import{c as p,a as j,b as o}from"./index.esm-Dt7Qe3Av.js";import{r as ne,p as z}from"./Feilds-BHjWXeSc.js";import{P as Pa}from"./ProjectSelectionModal-CwgmrRvW.js";import{C as Sa,a as La}from"./CCardBody-C0Yq84MQ.js";import{C as wa}from"./CCardHeader-AnyY50zi.js";import{C as c}from"./CButton-CC7WAWlS.js";import{c as le}from"./cil-money-Dk3vHnQB.js";import{C as Ba}from"./cil-mobile-D36DLDwv.js";import{C as _a}from"./CInputGroup-ByShXRUz.js";import{C as b}from"./CFormInput-DF8ie22K.js";import{c as qs}from"./cil-search-CDkY_4k-.js";import{c as Da}from"./cil-x-0440B5Ce.js";import{C as Be,a as _e,b as L,c as m,d as De,e as d}from"./CTable-L_woAYa2.js";import{C as Ee,a as I,b as V,c as $,d as U,f as Qs,g as re,h as oe,i as Gs,j as ie,e as H}from"./DefaultLayout-B3RBETEZ.js";import{c as Ea}from"./cil-history-D-FQjjfl.js";import{c as Fa}from"./cil-minus-DGBbwmfG.js";import{c as Ta}from"./cil-plus-D8mtC-W5.js";import{C as N}from"./CFormSelect-CFPHA-xf.js";import{C as ce}from"./CFormTextarea-mg6q-B3W.js";import{c as Ws}from"./cil-pencil-m516yCOw.js";import{c as Xs}from"./cil-trash-CBbKHhHb.js";import"./CFormControlWrapper-BkxhhPL_.js";import"./CFormLabel-B_oLSbD9.js";import"./RawMaterial-BtjEDAbB.js";const rt=()=>{var Os;const[Ys,Fe]=a.useState(!1),[de,w]=a.useState([]),[C,q]=a.useState(!1),[P,me]=a.useState(""),[he,A]=a.useState([]),[x,pe]=a.useState(""),[Js,B]=a.useState(!1),[Ks,Zs]=a.useState(!1),[ea,Te]=a.useState(!1),[_,Q]=a.useState("direct"),[y,Ae]=a.useState(null),[Oe,u]=a.useState(""),[O,Me]=a.useState(""),[xe,ke]=a.useState(new Date().toISOString().split("T")[0]),[ue,Re]=a.useState(""),[ze,Ie]=a.useState(""),[Ve,$e]=a.useState(""),[M,Ue]=a.useState(""),[je,He]=a.useState(new Date().toISOString().split("T")[0]),[ye,qe]=a.useState(""),[Qe,Ge]=a.useState(""),[We,Xe]=a.useState(""),[Ye,G]=a.useState(!1),[sa,W]=a.useState(!1),[X,ge]=a.useState("direct"),[fe,Je]=a.useState([]),[be,Ke]=a.useState([]),[aa,Ze]=a.useState(!1),[ta,es]=a.useState(!1),[D,ss]=a.useState(null),[Y,as]=a.useState(""),[ve,ts]=a.useState(""),[Ne,ns]=a.useState(""),[ls,rs]=a.useState(""),[os,is]=a.useState(""),[cs,E]=a.useState(""),[ds,ms]=a.useState(!1),[na,hs]=a.useState(!1),[F,ps]=a.useState(null),[J,xs]=a.useState(""),[Ce,us]=a.useState(""),[Pe,js]=a.useState(""),[ys,gs]=a.useState(""),[fs,bs]=a.useState(""),[vs,T]=a.useState(""),[Ns,Cs]=a.useState(!1),[la,Ps]=a.useState(!1),[g,Ss]=a.useState(null),[Ls,ws]=a.useState(!1),[Bs,_s]=a.useState("direct"),[Ds,K]=a.useState(""),[ra,oa]=a.useState({}),Se=a.useRef(null),Le=a.useRef(null),{showToast:ia}=va(),h=(s,n)=>{ia(n,s)},Es=a.useCallback(async s=>{try{const n=await te(`/api/projects?searchQuery=${s}`);A(n||[]),B(!0)}catch(n){console.error("Error fetching projects:",n),A([]),B(!1)}},[]);a.useEffect(()=>{const s=setTimeout(()=>{P&&P.length>2?Es(P):(A([]),B(!1))},300);return()=>clearTimeout(s)},[P,Es]),a.useEffect(()=>{const s=n=>{Se.current&&!Se.current.contains(n.target)&&B(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),a.useEffect(()=>{x?v():w([])},[x]);const Fs=s=>{me(s.project_name),pe(s.id),A([]),B(!1),Le.current&&Le.current.blur()},ca=()=>{he.length>0&&B(!0)},da=s=>{const n=s.target.value;me(n),x&&n!==P&&pe("")},Ts=async()=>{var s,n,r,i;if(x){q(!0);try{const l=await we(`/api/projects/${x}/sync-vendor-payments`,{});if(l&&(l.message||l.vendor_payments_count!==void 0)){const t=l.vendor_payments_count||0;h(`Vendor payments synced successfully! Created/Updated ${t} vendor payment records.`,"success"),v()}else h("Sync completed but no data returned","warning"),v()}catch(l){console.error("Sync error:",l);const t=((n=(s=l.response)==null?void 0:s.data)==null?void 0:n.message)||((i=(r=l.response)==null?void 0:r.data)==null?void 0:i.error)||"Failed to sync vendor payments";h(t,"danger")}finally{q(!1)}}},v=async()=>{if(!x){h("Please select a project","warning");return}q(!0);try{const s=await te(`/api/vendor-payments/${x}`);Array.isArray(s)?(w(s),s.length===0&&h("No vendor payments found for this project","info")):s&&s.data?(w(s.data||[]),s.message&&h(s.message,"warning")):(w([]),h("No vendor payments found for this project","info"))}catch(s){console.error("Error fetching vendor payments:",s),h("Failed to fetch vendor payments","danger"),w([])}finally{q(!1)}},ma=s=>{Ae(s),Q("direct"),Me(s.balance_amount||""),ke(new Date().toISOString().split("T")[0]),Re(""),Ie("cash"),$e(""),Ue(""),He(new Date().toISOString().split("T")[0]),qe(""),Ge("cash"),Xe(""),u(""),Te(!0)},k=()=>{Te(!1),Ae(null),Q("direct"),u("")},ha=async()=>{var n,r,i,l;if(!O||!xe||!ue){u("Please fill all required fields (Amount, Date, Paid By)");return}if(parseFloat(O)<=0){u("Payment amount must be greater than 0");return}if(parseFloat(O)>parseFloat(y.balance_amount)){u("Payment amount cannot exceed balance amount");return}G(!0);const s={amount:parseFloat(O),payment_date:xe,paid_by:ue,payment_type:ze||"cash",description:Ve||"",is_on_behalf:!1};try{const t=await we(`/api/vendor-payments/${y.id}/pay`,s);t&&(t.message||t.vendor_payment)?(h("Payment recorded successfully!","success"),k(),v()):u((t==null?void 0:t.error)||"Failed to record payment")}catch(t){console.error("Payment error:",t);const f=((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.error)||((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to record payment. Please try again.";u(f)}finally{G(!1)}},pa=async()=>{var n,r,i,l;if(!M||!je||!ye){u("Please fill all required fields (Amount, Date, Paid By)");return}if(parseFloat(M)<=0){u("Payment amount must be greater than 0");return}if(parseFloat(M)>parseFloat(y.balance_amount)){u("Payment amount cannot exceed balance amount");return}G(!0);const s={amount:parseFloat(M),payment_date:je,paid_by:ye,payment_type:Qe||"cash",description:We||"",is_on_behalf:!0};try{const t=await we(`/api/vendor-payments/${y.id}/pay-on-behalf`,s);t&&(t.message||t.on_behalf_log)?(h("On behalf payment recorded successfully!","success"),k(),v()):u((t==null?void 0:t.error)||"Failed to record on behalf payment")}catch(t){console.error("On behalf payment error:",t);const f=((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.error)||((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to record on behalf payment. Please try again.";u(f)}finally{G(!1)}},Z=async s=>{Ze(!0);try{const n=await te(`/api/vendor-payments/${s}/logs`);Je(n||[]);const r=await te(`/api/vendor-payments/${s}/on-behalf-logs`);Ke(r||[]),ge("direct"),W(!0)}catch(n){console.error("Error fetching logs:",n),h("Failed to fetch payment logs","danger"),Je([]),Ke([])}finally{Ze(!1)}},xa=s=>{ss(s),as(s.amount.toString()),ts(s.payment_date.split("T")[0]),ns(s.paid_by),rs(s.payment_type||"cash"),is(s.description||""),E(""),es(!0)},ee=()=>{es(!1),ss(null),E("")},ua=async()=>{var n,r,i,l;if(!Y||!ve||!Ne){E("Please fill all required fields (Amount, Date, Paid By)");return}if(parseFloat(Y)<=0){E("Payment amount must be greater than 0");return}ms(!0);const s={amount:parseFloat(Y),payment_date:ve,paid_by:Ne,payment_type:ls||"cash",description:os||""};try{const t=await Hs(`/api/vendor-payment-logs/${D.id}`,s);t&&t.message?(h("Payment log updated successfully!","success"),ee(),Z(D.vendor_payment_id),v()):E((t==null?void 0:t.error)||"Failed to update payment log")}catch(t){console.error("Edit log error:",t);const f=((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.error)||((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to update payment log. Please try again.";E(f)}finally{ms(!1)}},ja=s=>{ps(s),xs(s.amount.toString()),us(s.payment_date.split("T")[0]),js(s.paid_by),gs(s.payment_type||"cash"),bs(s.description||""),T(""),hs(!0)},se=()=>{hs(!1),ps(null),T("")},ya=async()=>{var n,r,i,l;if(!J||!Ce||!Pe){T("Please fill all required fields (Amount, Date, Paid By)");return}if(parseFloat(J)<=0){T("Payment amount must be greater than 0");return}Cs(!0);const s={amount:parseFloat(J),payment_date:Ce,paid_by:Pe,payment_type:ys||"cash",description:fs||""};try{const t=await Hs(`/api/vendor-on-behalf-payment-logs/${F.id}`,s);t&&t.message?(h("On behalf payment log updated successfully!","success"),se(),Z(F.vendor_payment_id),v()):T((t==null?void 0:t.error)||"Failed to update on behalf payment log")}catch(t){console.error("Edit on behalf log error:",t);const f=((r=(n=t.response)==null?void 0:n.data)==null?void 0:r.error)||((l=(i=t.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to update on behalf payment log. Please try again.";T(f)}finally{Cs(!1)}},As=(s,n="direct")=>{Ss(s),_s(n),K(""),Ps(!0)},ae=()=>{Ps(!1),Ss(null),_s("direct"),K("")},ga=async()=>{var s,n,r,i;if(g){ws(!0);try{const l=Bs==="onbehalf"?`/api/vendor-on-behalf-payment-logs/${g.id}`:`/api/vendor-payment-logs/${g.id}`,t=await Ca(l);t&&t.message?(h("Payment log deleted successfully!","success"),ae(),Z(g.vendor_payment_id),v()):K((t==null?void 0:t.error)||"Failed to delete payment log")}catch(l){console.error("Delete log error:",l);const t=((n=(s=l.response)==null?void 0:s.data)==null?void 0:n.error)||((i=(r=l.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to delete payment log. Please try again.";K(t)}finally{ws(!1)}}},fa=s=>{oa(n=>({...n,[s]:!n[s]}))},ba=s=>{const n=parseFloat(s.total_amount||0),r=parseFloat(s.paid_amount||0);return r===0?{text:"Unpaid",color:"danger"}:r>=n?{text:"Paid",color:"success"}:{text:"Partial",color:"warning"}},R=s=>{if(!s)return"Cash";const n=z.find(r=>r.value===s);return n?n.label:s};return e.jsxs("div",{className:"container-fluid py-2",children:[e.jsxs(Sa,{children:[e.jsxs(wa,{className:"bg-primary text-white d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"mb-0",children:"Vendor Payment Management"}),x&&e.jsx(c,{color:"light",size:"sm",onClick:Ts,disabled:C,children:C?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",className:"me-2"})," Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{icon:le,className:"me-2"})," Sync Payments"]})})]}),e.jsxs(La,{children:[Ks&&e.jsx(Ba,{color:"danger",dismissible:!0,onClose:()=>Zs(!1),children:alertMessage}),e.jsx(j,{className:"mb-4",children:e.jsx(o,{md:12,children:e.jsxs("div",{className:"position-relative",ref:Se,children:[e.jsxs(_a,{children:[e.jsx(b,{ref:Le,type:"text",value:P,onChange:da,onFocus:ca,placeholder:"Search and select a project to view vendor payments...",className:"border",autoComplete:"off"}),x?e.jsx(c,{color:"danger",variant:"outline",onClick:()=>{me(""),pe(""),A([]),w([])},style:{position:"absolute",right:"0",top:"0",bottom:"0",zIndex:5,borderTopLeftRadius:0,borderBottomLeftRadius:0},children:e.jsx(p,{icon:Da})}):e.jsx(c,{color:"primary",variant:"outline",onClick:()=>Fe(!0),style:{position:"absolute",right:"0",top:"0",bottom:"0",zIndex:5,borderTopLeftRadius:0,borderBottomLeftRadius:0},children:e.jsx(p,{icon:qs})})]}),Js&&he.length>0&&e.jsx("div",{className:"dropdown-menu show w-100",style:{maxHeight:"200px",overflowY:"auto",position:"absolute",zIndex:1e3,marginTop:"2px"},children:he.map(s=>e.jsx("div",{className:"dropdown-item",style:{cursor:"pointer"},onClick:()=>Fs(s),children:s.project_name},s.id))}),x&&e.jsxs("div",{className:"text-success mt-1 small",children:["✓ Selected: ",P]})]})})}),C&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(S,{}),e.jsx("p",{className:"mt-2",children:"Loading vendor payments..."})]}),!C&&de.length>0&&e.jsx("div",{className:"table-responsive",children:e.jsxs(Be,{striped:!0,hover:!0,children:[e.jsx(_e,{color:"primary",children:e.jsxs(L,{children:[e.jsx(m,{children:"Vendor Name"}),e.jsx(m,{children:"Total Amount"}),e.jsx(m,{children:"Paid Amount"}),e.jsx(m,{children:"Balance Amount"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(De,{children:de.map(s=>{var i,l,t,f,Ms,ks,Rs,zs,Is,Vs,$s,Us;const n=ba(s),r=ra[s.id];return e.jsxs(Na.Fragment,{children:[e.jsxs(L,{children:[e.jsx(d,{children:s.vendor?s.vendor.name:"Unknown Vendor"}),e.jsxs(d,{children:["₹",parseFloat(s.total_amount||0).toFixed(2)]}),e.jsxs(d,{children:["₹",parseFloat(s.paid_amount||0).toFixed(2)]}),e.jsxs(d,{children:["₹",parseFloat(s.balance_amount||0).toFixed(2)]}),e.jsx(d,{children:e.jsx(Ee,{color:n.color,children:n.text})}),e.jsx(d,{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(c,{color:"success",size:"sm",onClick:()=>ma(s),children:[e.jsx(p,{icon:le,className:"me-1"}),"Pay"]}),e.jsxs(c,{color:"info",size:"sm",onClick:()=>Z(s.id),children:[e.jsx(p,{icon:Ea,className:"me-1"}),"Logs"]}),e.jsx(c,{color:"secondary",size:"sm",onClick:()=>fa(s.id),title:r?"Hide Details":"Show Details",children:e.jsx(p,{icon:r?Fa:Ta})})]})})]}),r&&e.jsx(L,{children:e.jsx(d,{colSpan:"7",children:e.jsxs("div",{className:"p-3 bg-light",children:[e.jsx("h6",{children:"Vendor Details"}),e.jsxs(j,{children:[e.jsx(o,{md:4,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",((i=s.vendor)==null?void 0:i.name)||"N/A"]})}),e.jsx(o,{md:4,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Mobile:"})," ",((l=s.vendor)==null?void 0:l.mobile)||"N/A"]})}),e.jsx(o,{md:4,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",((t=s.vendor)==null?void 0:t.address)||"N/A"]})})]}),e.jsxs(j,{children:[e.jsx(o,{md:4,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Bank Name:"})," ",((f=s.vendor)==null?void 0:f.bank_name)||"N/A"]})}),e.jsx(o,{md:4,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Account No:"})," ",((Ms=s.vendor)==null?void 0:Ms.account_number)||"N/A"]})}),e.jsx(o,{md:4,children:e.jsxs("p",{children:[e.jsx("strong",{children:"IFSC Code:"})," ",((ks=s.vendor)==null?void 0:ks.ifsc_code)||"N/A"]})})]}),(((Rs=s.vendor)==null?void 0:Rs.gst_no)||((zs=s.vendor)==null?void 0:zs.adhar_number)||((Is=s.vendor)==null?void 0:Is.pan_number))&&e.jsxs(j,{children:[((Vs=s.vendor)==null?void 0:Vs.gst_no)&&e.jsx(o,{md:4,children:e.jsxs("p",{children:[e.jsx("strong",{children:"GST No:"})," ",s.vendor.gst_no]})}),(($s=s.vendor)==null?void 0:$s.adhar_number)&&e.jsx(o,{md:4,children:e.jsxs("p",{children:[e.jsx("strong",{children:"Aadhar No:"})," ",s.vendor.adhar_number]})}),((Us=s.vendor)==null?void 0:Us.pan_number)&&e.jsx(o,{md:4,children:e.jsxs("p",{children:[e.jsx("strong",{children:"PAN No:"})," ",s.vendor.pan_number]})})]})]})})})]},s.id)})})]})}),!C&&de.length===0&&x&&e.jsxs("div",{className:"text-center py-5",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(p,{icon:le,size:"3xl",className:"text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No vendor payments found"}),e.jsxs("p",{className:"text-muted mb-4",children:["This could mean:",e.jsx("br",{}),"• No budgets have been created for this project",e.jsx("br",{}),"• Budgets exist but vendor payments need to be synced",e.jsx("br",{}),"• No operators are assigned to work on this project"]})]}),e.jsx("div",{className:"d-flex justify-content-center gap-3",children:e.jsxs(c,{color:"warning",onClick:Ts,disabled:C,children:[e.jsx(p,{icon:le,className:"me-2"}),"Sync Vendor Payments"]})})]}),!x&&!C&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx(p,{icon:qs,size:"3xl",className:"text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"Select a project to get started"}),e.jsx("p",{className:"text-muted",children:"Search and select a project from the dropdown above to view vendor payments."})]}),e.jsxs(I,{visible:ea,onClose:k,backdrop:"static",size:"lg",children:[e.jsx(V,{onClose:k,children:e.jsx($,{children:"Record Payment"})}),e.jsx(U,{children:y&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 p-3 bg-light rounded",children:[e.jsxs("h6",{children:["Vendor: ",((Os=y.vendor)==null?void 0:Os.name)||"Unknown"]}),e.jsxs("p",{className:"mb-1",children:["Total Amount: ₹",parseFloat(y.total_amount||0).toFixed(2)]}),e.jsxs("p",{className:"mb-1",children:["Paid Amount: ₹",parseFloat(y.paid_amount||0).toFixed(2)]}),e.jsxs("p",{className:"mb-0",children:["Balance Amount: ₹",parseFloat(y.balance_amount||0).toFixed(2)]})]}),e.jsxs(Qs,{variant:"tabs",role:"tablist",className:"mb-3",children:[e.jsx(re,{children:e.jsx(oe,{active:_==="direct",onClick:()=>Q("direct"),style:{cursor:"pointer"},children:"Direct Payment"})}),e.jsx(re,{children:e.jsx(oe,{active:_==="onbehalf",onClick:()=>Q("onbehalf"),style:{cursor:"pointer"},children:"On Behalf Payment"})})]}),e.jsxs(Gs,{children:[e.jsxs(ie,{visible:_==="direct",children:[e.jsxs(j,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Amount *"}),e.jsx(b,{type:"number",value:O,onChange:s=>Me(s.target.value),placeholder:"Enter payment amount",step:"0.01",max:y.balance_amount})]})}),e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Date *"}),e.jsx(b,{type:"date",value:xe,onChange:s=>ke(s.target.value)})]})})]}),e.jsxs(j,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Paid By *"}),e.jsxs(N,{value:ue,onChange:s=>Re(s.target.value),children:[e.jsx("option",{value:"",children:"Select Payment By"}),ne.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})}),e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Type *"}),e.jsx(N,{value:ze,onChange:s=>Ie(s.target.value),children:z.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx(ce,{rows:"3",value:Ve,onChange:s=>$e(s.target.value),placeholder:"Enter payment description (optional)"})]})]}),e.jsxs(ie,{visible:_==="onbehalf",children:[e.jsx("div",{className:"alert alert-info mb-3",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Note:"})," On behalf payments are made to another vendor on behalf of this vendor. These payments will reduce the balance amount of this vendor."]})}),e.jsxs(j,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Amount *"}),e.jsx(b,{type:"number",value:M,onChange:s=>Ue(s.target.value),placeholder:"Enter payment amount",step:"0.01",min:"0.01"})]})}),e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Date *"}),e.jsx(b,{type:"date",value:je,onChange:s=>He(s.target.value)})]})})]}),e.jsxs(j,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Paid By *"}),e.jsxs(N,{value:ye,onChange:s=>qe(s.target.value),children:[e.jsx("option",{value:"",children:"Select Payment By"}),ne.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})}),e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Type *"}),e.jsx(N,{value:Qe,onChange:s=>Ge(s.target.value),children:z.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx(ce,{rows:"3",value:We,onChange:s=>Xe(s.target.value),placeholder:"Enter payment description (optional)"})]})]})]}),Oe&&e.jsx("div",{className:"alert alert-danger mt-3",role:"alert",children:Oe})]})}),e.jsxs(H,{children:[e.jsx(c,{color:"secondary",onClick:k,children:"Cancel"}),e.jsx(c,{color:"primary",disabled:Ye,onClick:_==="direct"?ha:pa,children:Ye?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",className:"me-2"}),"Recording..."]}):_==="direct"?"Record Payment":"Record On Behalf Payment"})]})]}),e.jsxs(I,{visible:sa,onClose:()=>W(!1),size:"xl",children:[e.jsx(V,{onClose:()=>W(!1),children:e.jsx($,{children:"Payment Logs"})}),e.jsx(U,{children:aa?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(S,{}),e.jsx("p",{className:"mt-2",children:"Loading payment logs..."})]}):e.jsxs("div",{children:[e.jsxs(Qs,{variant:"tabs",role:"tablist",className:"mb-3",children:[e.jsx(re,{children:e.jsxs(oe,{active:X==="direct",onClick:()=>ge("direct"),style:{cursor:"pointer"},children:["Direct Payments (",fe.length,")"]})}),e.jsx(re,{children:e.jsxs(oe,{active:X==="onbehalf",onClick:()=>ge("onbehalf"),style:{cursor:"pointer"},children:["On Behalf Payments (",be.length,")"]})})]}),e.jsxs(Gs,{children:[e.jsx(ie,{visible:X==="direct",children:fe.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs(Be,{striped:!0,children:[e.jsx(_e,{children:e.jsxs(L,{children:[e.jsx(m,{children:"Date"}),e.jsx(m,{children:"Amount"}),e.jsx(m,{children:"Paid By"}),e.jsx(m,{children:"Payment Type"}),e.jsx(m,{children:"Description"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(De,{children:fe.map(s=>e.jsxs(L,{children:[e.jsx(d,{children:new Date(s.payment_date).toLocaleDateString()}),e.jsxs(d,{children:["₹",parseFloat(s.amount).toFixed(2)]}),e.jsx(d,{children:s.paid_by}),e.jsx(d,{children:e.jsx(Ee,{color:"info",children:R(s.payment_type)})}),e.jsx(d,{children:s.description||"-"}),e.jsx(d,{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(c,{color:"warning",size:"sm",onClick:()=>xa(s),title:"Edit Payment Log",children:e.jsx(p,{icon:Ws})}),e.jsx(c,{color:"danger",size:"sm",onClick:()=>As(s,"direct"),title:"Delete Payment Log",children:e.jsx(p,{icon:Xs})})]})})]},s.id))})]})}):e.jsx("div",{className:"text-center py-4",children:e.jsx("h6",{className:"text-muted",children:"No direct payment logs found"})})}),e.jsx(ie,{visible:X==="onbehalf",children:be.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs(Be,{striped:!0,children:[e.jsx(_e,{children:e.jsxs(L,{children:[e.jsx(m,{children:"Date"}),e.jsx(m,{children:"Amount"}),e.jsx(m,{children:"Paid By"}),e.jsx(m,{children:"Payment Type"}),e.jsx(m,{children:"Description"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(De,{children:be.map(s=>e.jsxs(L,{children:[e.jsx(d,{children:new Date(s.payment_date).toLocaleDateString()}),e.jsxs(d,{children:["₹",parseFloat(s.amount).toFixed(2)]}),e.jsx(d,{children:s.paid_by}),e.jsx(d,{children:e.jsx(Ee,{color:"info",children:R(s.payment_type)})}),e.jsx(d,{children:s.description||"-"}),e.jsx(d,{children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(c,{color:"warning",size:"sm",onClick:()=>ja(s),title:"Edit On Behalf Payment Log",children:e.jsx(p,{icon:Ws})}),e.jsx(c,{color:"danger",size:"sm",onClick:()=>As(s,"onbehalf"),title:"Delete On Behalf Payment Log",children:e.jsx(p,{icon:Xs})})]})})]},s.id))})]})}):e.jsx("div",{className:"text-center py-4",children:e.jsx("h6",{className:"text-muted",children:"No on behalf payment logs found"})})})]})]})}),e.jsx(H,{children:e.jsx(c,{color:"secondary",onClick:()=>W(!1),children:"Close"})})]}),e.jsxs(I,{visible:ta,onClose:ee,backdrop:"static",size:"lg",children:[e.jsx(V,{onClose:ee,children:e.jsx($,{children:"Edit Direct Payment Log"})}),e.jsx(U,{children:D&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 p-3 bg-light rounded",children:[e.jsx("h6",{children:"Editing Payment Log"}),e.jsxs("p",{className:"mb-0",children:["Original Amount: ₹",parseFloat(D.amount).toFixed(2)," on ",new Date(D.payment_date).toLocaleDateString(),e.jsx("br",{}),"Original Payment Type: ",R(D.payment_type)]})]}),e.jsxs(j,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Amount *"}),e.jsx(b,{type:"number",value:Y,onChange:s=>as(s.target.value),placeholder:"Enter payment amount",step:"0.01",min:"0.01"})]})}),e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Date *"}),e.jsx(b,{type:"date",value:ve,onChange:s=>ts(s.target.value)})]})})]}),e.jsxs(j,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Paid By *"}),e.jsxs(N,{value:Ne,onChange:s=>ns(s.target.value),children:[e.jsx("option",{value:"",children:"Select Payment By"}),ne.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})}),e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Type *"}),e.jsx(N,{value:ls,onChange:s=>rs(s.target.value),children:z.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx(ce,{rows:"3",value:os,onChange:s=>is(s.target.value),placeholder:"Enter payment description (optional)"})]}),cs&&e.jsx("div",{className:"alert alert-danger mt-3",role:"alert",children:cs})]})}),e.jsxs(H,{children:[e.jsx(c,{color:"secondary",onClick:ee,children:"Cancel"}),e.jsx(c,{color:"primary",disabled:ds,onClick:ua,children:ds?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",className:"me-2"}),"Updating..."]}):"Update Log"})]})]}),e.jsxs(I,{visible:na,onClose:se,backdrop:"static",size:"lg",children:[e.jsx(V,{onClose:se,children:e.jsx($,{children:"Edit On Behalf Payment Log"})}),e.jsx(U,{children:F&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 p-3 bg-light rounded",children:[e.jsx("h6",{children:"Editing On Behalf Payment Log"}),e.jsxs("p",{className:"mb-0",children:["Original Amount: ₹",parseFloat(F.amount).toFixed(2)," on ",new Date(F.payment_date).toLocaleDateString(),e.jsx("br",{}),"Original Payment Type: ",R(F.payment_type)]})]}),e.jsxs(j,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Amount *"}),e.jsx(b,{type:"number",value:J,onChange:s=>xs(s.target.value),placeholder:"Enter payment amount",step:"0.01",min:"0.01"})]})}),e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Date *"}),e.jsx(b,{type:"date",value:Ce,onChange:s=>us(s.target.value)})]})})]}),e.jsxs(j,{children:[e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Paid By *"}),e.jsxs(N,{value:Pe,onChange:s=>js(s.target.value),children:[e.jsx("option",{value:"",children:"Select Payment By"}),ne.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]})]})}),e.jsx(o,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Type *"}),e.jsx(N,{value:ys,onChange:s=>gs(s.target.value),children:z.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx(ce,{rows:"3",value:fs,onChange:s=>bs(s.target.value),placeholder:"Enter payment description (optional)"})]}),vs&&e.jsx("div",{className:"alert alert-danger mt-3",role:"alert",children:vs})]})}),e.jsxs(H,{children:[e.jsx(c,{color:"secondary",onClick:se,children:"Cancel"}),e.jsx(c,{color:"primary",disabled:Ns,onClick:ya,children:Ns?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",className:"me-2"}),"Updating..."]}):"Update Log"})]})]}),e.jsxs(I,{visible:la,onClose:ae,backdrop:"static",children:[e.jsx(V,{onClose:ae,children:e.jsx($,{children:"Confirm Delete"})}),e.jsx(U,{children:g&&e.jsxs("div",{children:[e.jsx("p",{children:e.jsxs("strong",{children:["Are you sure you want to delete this ",Bs==="onbehalf"?"on behalf ":"","payment log?"]})}),e.jsxs("div",{className:"p-3 bg-light rounded",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Amount:"})," ₹",parseFloat(g.amount).toFixed(2)]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Date:"})," ",new Date(g.payment_date).toLocaleDateString()]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Paid By:"})," ",g.paid_by]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Payment Type:"})," ",R(g.payment_type)]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Description:"})," ",g.description||"N/A"]})]}),e.jsx("div",{className:"alert alert-warning mt-3",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone. The vendor payment totals will be recalculated automatically."]})}),Ds&&e.jsx("div",{className:"alert alert-danger mt-3",role:"alert",children:Ds})]})}),e.jsxs(H,{children:[e.jsx(c,{color:"secondary",onClick:ae,children:"Cancel"}),e.jsx(c,{color:"danger",disabled:Ls,onClick:ga,children:Ls?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",className:"me-2"}),"Deleting..."]}):"Delete Log"})]})]})]})]}),e.jsx(Pa,{visible:Ys,onClose:()=>Fe(!1),onSelectProject:Fs})]})};export{rt as default};
