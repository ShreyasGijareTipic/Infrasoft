import{r as o,j as e,C as A}from"./index-DQ9cqY-w.js";import{C as $,c as v,a as j,b as t}from"./index.esm-t1uhsutJ.js";import{S as re}from"./react-select.esm-iCOvHRu-.js";import{a as O}from"./api-CIBCEetx.js";import{C as m,a as x}from"./CCardBody-nJ-qIk-T.js";import{C as te}from"./CCardHeader-Dxk59cNM.js";import{c as ne}from"./cil-file-CeQgYs_D.js";import{C as ce}from"./cil-mobile-Cf1prUnf.js";import{C as ie}from"./CForm-Dfp3PuZs.js";import{c as de}from"./cil-search-CDkY_4k-.js";import{C as n}from"./CFormLabel-C-r2uEyX.js";import{C as c}from"./CFormInput-C2pMQ5Ja.js";import{C as i}from"./CInputGroup-CX6YuGRq.js";import{C as d}from"./CInputGroupText-CFKboCAQ.js";import{C as oe}from"./CButton-Cv8rOKs_.js";import{c as me}from"./cil-minus-DGBbwmfG.js";import{c as xe}from"./cil-plus-D8mtC-W5.js";import{C as he}from"./CCollapse-BaRn7Yg3.js";import{C as H,a as G,b as _,c as u,d as U,e as b}from"./CTable-Bg7ZIw-y.js";import{C as je}from"./DefaultLayout-D1v7lmV6.js";import{c as ue}from"./cil-location-pin-CQr6GRP7.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./emotion-react.browser.esm-B2jRiI6M.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./CFormControlWrapper-C03sehqW.js";import"./RawMaterial-BtjEDAbB.js";const Ge=()=>{const[C,z]=o.useState([]),[Q,S]=o.useState(0),[R,F]=o.useState(!1),[D,W]=o.useState([]),[q,P]=o.useState(""),[I,L]=o.useState(""),[f,T]=o.useState([]),[J,M]=o.useState(!1),[p,K]=o.useState(!1),[w,k]=o.useState([]),[X,B]=o.useState(!1);o.useState(!1);const r=s=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(Number(s||0)),g=s=>Number(s||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),V=async s=>{if(s){M(!0);try{const a=await O(`/api/vendor-payments/${s}`);T(Array.isArray(a)?a:(a==null?void 0:a.data)||[])}catch(a){console.error("Error fetching vendor payments:",a),T([])}finally{M(!1)}}},E=async s=>{if(s){B(!0);try{const a=await O(`/api/getRawMaterialsForSummary?project_id=${s}`);k(Array.isArray(a)?a:(a==null?void 0:a.data)||[])}catch(a){console.error("Error fetching raw materials:",a),k([])}finally{B(!1)}}},Y=()=>f.reduce((s,a)=>({totalAmount:s.totalAmount+Number(a.total_amount||0),paidAmount:s.paidAmount+Number(a.paid_amount||0),balanceAmount:s.balanceAmount+Number(a.balance_amount||0)}),{totalAmount:0,paidAmount:0,balanceAmount:0}),Z=()=>w.reduce((s,a)=>s+Number(a.used_qty||0),0),ee=s=>{const a=parseFloat(s.total_amount||0),h=parseFloat(s.paid_amount||0);return h===0?{text:"Unpaid",color:"danger"}:h>=a?{text:"Paid",color:"success"}:{text:"Partial",color:"warning"}},se=async(s=null)=>{F(!0);try{const a=await O(`/api/project-summary${s?`?project_id=${s}`:""}`);z(a.data);const h=a.data.map(N=>({value:N.sr_no.toString(),label:`${N.site_name} - ${N.company_name}`}));W(h),!s&&a.data.length>0&&(P(a.data[0].sr_no.toString()),S(0),V(a.data[0].sr_no),E(a.data[0].sr_no))}catch{L("Error fetching project summary data")}finally{F(!1)}};o.useEffect(()=>{se()},[]);const ae=s=>{if(s){P(s.value);const a=C.findIndex(h=>h.sr_no.toString()===s.value);a!==-1&&(S(a),V(s.value),E(s.value))}else P(""),S(0),T([]),k([])},l=C[Q],y=Y(),le=Z();return R?e.jsx($,{fluid:!0,children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx(A,{color:"primary"}),e.jsx("p",{className:"mt-2",children:"Loading project summary..."})]})}):e.jsx($,{fluid:!0,children:e.jsxs(m,{children:[e.jsx(te,{className:"bg-primary text-white",children:e.jsxs("h1",{className:"mb-0 h4 d-flex align-items-center",children:[e.jsx(v,{icon:ne,className:"me-2"})," Project Summary Report"]})}),e.jsxs(x,{className:"p-4",children:[I&&e.jsx(ce,{color:"danger",dismissible:!0,onClose:()=>L(""),children:I}),l&&e.jsxs(ie,{children:[e.jsx(m,{className:"mb-4 border-0",color:"primary",textColor:"dark",children:e.jsxs(x,{className:"bg-primary-subtle rounded",children:[e.jsxs("h5",{className:"text-primary mb-3 d-flex align-items-center",children:[e.jsx(v,{icon:de,className:"me-2"})," Project Selection & Customer Information"]}),e.jsxs(j,{className:"g-3",children:[e.jsxs(t,{lg:6,md:12,children:[e.jsx(n,{children:"Select Project"}),e.jsx(re,{options:D,isSearchable:!0,isClearable:!0,placeholder:"Select a project...",value:D.find(s=>s.value===q)||null,onChange:ae,className:"react-select-container",classNamePrefix:"react-select"})]}),e.jsxs(t,{lg:6,md:12,children:[e.jsx(n,{children:"Company Name"}),e.jsx(c,{value:l.company_name,readOnly:!0,className:"bg-white"})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:l.is_profit?"success":"danger",textColor:"dark",children:e.jsxs(x,{className:`${l.is_profit?"bg-success-subtle":"bg-danger-subtle"} rounded`,children:[e.jsx("h5",{className:`${l.is_profit?"text-success":"text-danger"} mb-3`,children:l.is_profit?"ðŸ’° Profit":"ðŸ“‰ Loss"}),e.jsxs(j,{className:"g-3 justify-content-center",children:[e.jsxs(t,{lg:4,md:6,sm:12,children:[e.jsx(n,{className:"fs-6 fw-bold",children:"Total Revenue (with GST)"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-info text-white",children:"â‚¹"}),e.jsx(c,{value:r(l.total_bill),readOnly:!0,className:"bg-white fw-bold text-info"})]})]}),e.jsxs(t,{lg:4,md:6,sm:12,children:[e.jsx(n,{className:"fs-6 fw-bold",children:"Total Expenses"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-warning text-dark",children:"â‚¹"}),e.jsx(c,{value:r(l.total_expenses),readOnly:!0,className:"bg-white fw-bold text-warning"})]})]}),e.jsxs(t,{lg:4,md:12,sm:12,children:[e.jsx(n,{className:"fs-5 fw-bold",children:l.is_profit?"Net Profit":"Net Loss"}),e.jsxs(i,{size:"lg",children:[e.jsx(d,{className:l.is_profit?"bg-success text-white":"bg-danger text-white",children:"â‚¹"}),e.jsx(c,{value:r(Math.abs(l.profit_or_loss)),readOnly:!0,className:`bg-white fw-bold fs-4 text-center ${l.is_profit?"text-success":"text-danger"}`})]})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:"secondary",textColor:"dark",children:e.jsxs(x,{className:"bg-secondary-subtle rounded",children:[e.jsx("h5",{className:"text-secondary mb-3",children:"Payment Received in Account"}),e.jsx(j,{className:"g-3",children:l.receiver_banks&&l.receiver_banks.length>0?l.receiver_banks.map((s,a)=>e.jsxs(t,{xl:4,lg:6,md:6,sm:12,children:[e.jsx(n,{children:s.bank_name}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(s.amount),readOnly:!0,className:"bg-white fw-bold"})]})]},a)):e.jsx(t,{xs:12,children:e.jsx("p",{className:"text-muted text-center mb-0",children:"No bank payments recorded"})})})]})}),e.jsx(m,{className:"mb-4 border-0",color:"info",textColor:"dark",children:e.jsxs(x,{className:"bg-info-subtle rounded",children:[e.jsxs("div",{className:"d-flex gap-4 mb-3",children:[e.jsx("h5",{className:"text-info mb-0",children:"Payment / Invoice Details"}),e.jsxs("h5",{className:"text-dark mb-0",children:["( Total:",e.jsx("span",{className:"text-info fw-bold ms-1",children:r(Number(l.paid_amount)+Number(l.pending_amount))})," )"]})]}),e.jsxs(j,{className:"g-3",children:[e.jsxs(t,{lg:6,md:12,children:[e.jsx(n,{children:"Paid Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-success text-white",children:"â‚¹"}),e.jsx(c,{value:r(l.paid_amount),readOnly:!0,className:"bg-white fw-bold text-success"})]})]}),e.jsxs(t,{lg:6,md:12,children:[e.jsx(n,{children:"Pending Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-warning text-dark",children:"â‚¹"}),e.jsx(c,{value:r(l.pending_amount),readOnly:!0,className:"bg-white fw-bold text-warning"})]})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:"success",textColor:"dark",children:e.jsxs(x,{className:"bg-success-subtle rounded",children:[e.jsx("h5",{className:"text-success mb-4",children:"Work Done"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-success mb-3",children:"DTH Work"}),e.jsxs(j,{className:"g-3",children:[e.jsxs(t,{xl:4,lg:4,md:6,sm:12,children:[e.jsx(n,{children:"Total DTH Points"}),e.jsx(c,{value:g(l.total_dth_points),readOnly:!0,className:"bg-white fw-bold text-center"})]}),e.jsxs(t,{xl:4,lg:4,md:6,sm:12,children:[e.jsx(n,{children:"Average Rate per Point"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:g(l.avg_dth_rate),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:4,lg:4,md:12,sm:12,children:[e.jsx(n,{children:"Total DTH Billing"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-success text-white",children:"â‚¹"}),e.jsx(c,{value:r(l.total_dth_billing_amount),readOnly:!0,className:"bg-white fw-bold text-success"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h6",{className:"text-success mb-3",children:"Survey Work"}),e.jsxs(j,{className:"g-3",children:[e.jsxs(t,{xl:4,lg:4,md:6,sm:12,children:[e.jsx(n,{children:"Total Survey Points"}),e.jsx(c,{value:g(l.total_survey_points),readOnly:!0,className:"bg-white fw-bold text-center"})]}),e.jsxs(t,{xl:4,lg:4,md:6,sm:12,children:[e.jsx(n,{children:"Average Rate per Point"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:g(l.avg_survey_rate),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:4,lg:4,md:12,sm:12,children:[e.jsx(n,{children:"Total Survey Billing"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-success text-white",children:"â‚¹"}),e.jsx(c,{value:r(l.total_survey_billing_amount),readOnly:!0,className:"bg-white fw-bold text-success"})]})]})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:"secondary",textColor:"dark",children:e.jsxs(x,{className:"bg-secondary-subtle rounded",children:[e.jsx("h5",{className:"text-secondary mb-3",children:"Final Billing"}),e.jsxs(j,{className:"g-3",children:[e.jsxs(t,{xl:4,lg:6,md:12,children:[e.jsx(n,{children:"Amount Before GST"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(l.final_bill),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:4,lg:6,md:12,children:[e.jsx(n,{children:"GST (18%)"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(l.gst_bill),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:4,lg:12,md:12,children:[e.jsx(n,{children:"Total Bill (with GST)"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-secondary text-white",children:"â‚¹"}),e.jsx(c,{value:r(l.total_bill),readOnly:!0,className:"bg-white fw-bold text-secondary"})]})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:"warning",textColor:"dark",children:e.jsxs(x,{className:"bg-warning-subtle rounded",children:[e.jsxs("div",{className:"d-flex gap-4 mb-3",children:[e.jsx("h5",{className:"text-warning mb-0",children:"Expenses"}),e.jsxs("h5",{className:"text-dark mb-0",children:["( Total:",e.jsx("span",{className:"text-warning fw-bold ms-1",children:r(l.total_expenses)})," )"]})]}),e.jsxs(j,{className:"g-3",children:[e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Transport"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(l.transport),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Other Billing"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(l.other_billing),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Total Fuel Amount"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(l.total_diesel_amount),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:3,lg:6,md:6,sm:12,children:[e.jsx(n,{children:"Extra Billing"}),e.jsxs(i,{children:[e.jsx(d,{children:"â‚¹"}),e.jsx(c,{value:r(l.extra_billing||0),readOnly:!0,className:"bg-white fw-bold"})]})]})]})]})}),e.jsx(m,{className:"mb-4 border-0",color:"dark",textColor:"dark",children:e.jsxs(x,{className:"bg-dark-subtle rounded",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{className:"d-flex gap-4",children:[e.jsx("h5",{className:"text-dark mb-0",children:"Vendor Payments"}),f.length>0&&e.jsxs("h5",{className:"text-muted mb-0",children:["( Total:",e.jsx("span",{className:"text-dark fw-bold ms-1",children:r(y.totalAmount)})," )"]})]}),f.length>0&&e.jsxs(oe,{color:"dark",variant:"outline",size:"sm",onClick:()=>K(!p),children:[e.jsx(v,{icon:p?me:xe,className:"me-1"}),p?"Hide Details":"Show Details"]})]}),J?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(A,{size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading vendor payments..."})]}):f.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(j,{className:"g-3",children:[e.jsxs(t,{xl:4,lg:6,md:12,children:[e.jsx(n,{children:"Total Vendor Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-dark text-white",children:"â‚¹"}),e.jsx(c,{value:r(y.totalAmount),readOnly:!0,className:"bg-white fw-bold"})]})]}),e.jsxs(t,{xl:4,lg:6,md:12,children:[e.jsx(n,{children:"Total Paid Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-success text-white",children:"â‚¹"}),e.jsx(c,{value:r(y.paidAmount),readOnly:!0,className:"bg-white fw-bold text-success"})]})]}),e.jsxs(t,{xl:4,lg:12,md:12,children:[e.jsx(n,{children:"Total Remaining Amount"}),e.jsxs(i,{children:[e.jsx(d,{className:"bg-warning text-dark",children:"â‚¹"}),e.jsx(c,{value:r(y.balanceAmount),readOnly:!0,className:"bg-white fw-bold text-warning"})]})]})]}),e.jsx(he,{visible:p,children:e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{className:"text-dark mb-3",children:"Individual Vendor Details"}),e.jsx("div",{className:"table-responsive",children:e.jsxs(H,{striped:!0,hover:!0,className:"bg-white",children:[e.jsx(G,{color:"dark",children:e.jsxs(_,{children:[e.jsx(u,{children:"Vendor Name"}),e.jsx(u,{children:"Total Amount"}),e.jsx(u,{children:"Paid Amount"}),e.jsx(u,{children:"Balance Amount"}),e.jsx(u,{children:"Status"})]})}),e.jsx(U,{children:f.map(s=>{var h,N;const a=ee(s);return e.jsxs(_,{children:[e.jsx(b,{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:((h=s.vendor)==null?void 0:h.name)||"Unknown Vendor"}),((N=s.vendor)==null?void 0:N.mobile)&&e.jsx("small",{className:"text-muted",children:s.vendor.mobile})]})}),e.jsx(b,{children:r(s.total_amount)}),e.jsx(b,{className:"text-success fw-bold",children:r(s.paid_amount)}),e.jsx(b,{className:"text-warning fw-bold",children:r(s.balance_amount)}),e.jsx(b,{children:e.jsx(je,{color:a.color,children:a.text})})]},s.id)})})]})})]})})]}):e.jsx("div",{className:"text-center py-3 text-muted",children:e.jsx("p",{className:"mb-0",children:"No vendor payments found for this project"})})]})}),e.jsx(m,{className:"mb-4 border-0",color:"info",textColor:"dark",children:e.jsxs(x,{className:"bg-info-subtle rounded",children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-3",children:e.jsxs("div",{className:"d-flex gap-4",children:[e.jsx("h5",{className:"text-info mb-0",children:"Used Raw Material"}),w.length>0&&e.jsxs("h5",{className:"text-muted mb-0",children:["( Total Quantity:",e.jsx("span",{className:"text-info fw-bold ms-1",children:g(le)})," )"]})]})}),X?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(A,{size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading raw materials..."})]}):w.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs(H,{striped:!0,hover:!0,className:"bg-white",children:[e.jsx(G,{color:"dark",children:e.jsxs(_,{children:[e.jsx(u,{children:"Material Name"}),e.jsx(u,{children:"Used Quantity"}),e.jsx(u,{children:"Amount"})]})}),e.jsx(U,{children:w.map(s=>e.jsxs(_,{children:[e.jsxs(b,{children:[e.jsx("div",{className:"fw-bold",children:s.material_name||"Unknown Material"}),s.local_name&&s.local_name!==s.material_name&&e.jsx("small",{className:"text-muted",children:s.local_name})]}),e.jsx(b,{children:g(s.used_qty)}),e.jsx(b,{children:s.misc?r(s.misc):"-"})]},s.id))})]})}):e.jsx("div",{className:"text-center py-3 text-muted",children:e.jsx("p",{className:"mb-0",children:"No raw materials found for this project"})})]})})]}),!R&&C.length===0&&e.jsxs("div",{className:"text-center p-4 text-muted",children:[e.jsx(v,{icon:ue,size:"3xl",className:"mb-3"}),e.jsx("h5",{children:"No Projects Found"}),e.jsx("p",{children:"No project data available at the moment."})]})]})]})})};export{Ge as default};
