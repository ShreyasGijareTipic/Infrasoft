import{b as Z,r as n,j as a}from"./index-ZbBnGUwW.js";import{M as H}from"./mantine-react-table.esm-DpOy9Ate.js";import{a as O,b as W,c as p}from"./index.esm-CjRd7TO4.js";import{a as D,d as Y,b as J}from"./api-CIBCEetx.js";import{C as Q}from"./ConfirmationModal-Bxo_Mbbe.js";import{C as X}from"./CForm-CFb5zsUZ.js";import{C as u}from"./CInputGroup-BZyBCIlh.js";import{C as b}from"./CInputGroupText-BeL17f_c.js";import{c as ee}from"./cil-people-DQU-yEHN.js";import{C as ae}from"./CFormSelect-Bt6dv3W8.js";import{c as se}from"./RawMaterial-BtjEDAbB.js";import{C as h}from"./CFormInput-BlwHhfPK.js";import{c as re,a as te}from"./cil-envelope-closed-B4Yc6MaR.js";import{c as ie}from"./cil-mobile-Da8wudM0.js";import{c as le}from"./cil-credit-card-KG5pHjdT.js";import{k as oe,C as E}from"./DefaultLayout-BIkduJaW.js";import{C as I}from"./CButton-B_ZQUDVk.js";import"./Table-D14UfPeT.js";import"./MantineProvider-CM0gIdFZ.js";import"./emotion-react.browser.esm-DS146EtM.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./CFormControlWrapper-B0Dgyxun.js";import"./CFormLabel-CK5sZng0.js";const Me=()=>{const{showToast:f}=Z(),[M,w]=n.useState([]),[T,_]=n.useState([]),[x,R]=n.useState(),[F,y]=n.useState(!1),[A,j]=n.useState(!1),[o,c]=n.useState({}),[i,g]=n.useState({visible:!1,validated:!1,formData:{id:"",name:"",email:"",mobile:"",type_id:"",bank_name:"",account_number:"",ifsc_code:"",commission:""}}),v=async()=>{try{j(!0);const e=await D("/api/partners");w(e||[])}catch(e){f("danger","Error fetching partners: "+e.message)}finally{j(!1)}},K=async()=>{try{const e=await D("/api/partner-types");if(e!=null&&e.length){const s=e.map(r=>({label:r.partner_type,value:r.id.toString(),commission:r.commission}));_([{label:"Select Partner Type",value:""},...s])}}catch(e){console.error("Error fetching partner types:",e),_([{label:"Select Partner Type",value:""},{label:"Retailer",value:"1"},{label:"Distributor",value:"2"},{label:"Wholesaler",value:"3"}])}};n.useEffect(()=>{v(),K()},[]);const P=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),N=e=>/^[0-9]{10}$/.test(e),k=e=>/^[A-Z]{4}0[A-Z0-9]{6}$/.test(e.toUpperCase()),V=(e,s,r)=>{let t="";switch(e){case"email":s&&!P(s)&&(t="Please enter a valid email address");break;case"mobile":s&&!N(s)&&(t="Mobile number must be exactly 10 digits");break;case"ifsc_code":s&&!k(s)&&(t="Please enter a valid IFSC code (e.g., SBIN0000123)");break}c(m=>({...m,[`${r}_${e}`]:t}))},B=e=>{R(e),y(!0)},$=async()=>{try{await Y(`/api/partners/${x.id}`),y(!1),f("success","Partner deleted successfully!"),v()}catch(e){f("danger","Error deleting partner: "+e.message)}},q=e=>{var s,r,t;g({visible:!0,validated:!1,formData:{id:e.id,name:e.name||"",email:e.email||"",mobile:e.mobile||"",type_id:((r=(s=e.partner_types)==null?void 0:s.id)==null?void 0:r.toString())||"",bank_name:e.bank_name||"",account_number:e.account_number||"",ifsc_code:e.ifsc_code||"",commission:((t=e.partner_types)==null?void 0:t.commission)||"15.00"}}),c({})},C=()=>{g(e=>({...e,visible:!1,validated:!1})),c({})},d=e=>{const{name:s,value:r}=e.target;let t=r;s==="mobile"||s==="account_number"?t=r.replace(/\D/g,""):s==="ifsc_code"&&(t=r.toUpperCase()),g(m=>({...m,formData:{...m.formData,[s]:t}})),V(s,t,"edit")},L=async e=>{e.preventDefault(),e.stopPropagation();const s=e.target;let r=!1;const{email:t,mobile:m,ifsc_code:S,type_id:G}=i.formData;if((!t||!P(t))&&(c(l=>({...l,edit_email:"Please enter a valid email address"})),r=!0),(!m||!N(m))&&(c(l=>({...l,edit_mobile:"Mobile number must be exactly 10 digits"})),r=!0),(!S||!k(S))&&(c(l=>({...l,edit_ifsc_code:"Please enter a valid IFSC code"})),r=!0),G||(c(l=>({...l,edit_type_id:"Please select a partner type"})),r=!0),!s.checkValidity()||r){g(l=>({...l,validated:!0}));return}try{await J(`/api/partners/${i.formData.id}`,i.formData)?(f("success","Partner updated successfully"),C(),v()):f("danger","Error occurred, please try again later.")}catch(l){f("danger","Error updating partner: "+l.message)}},z=[{accessorKey:"name",header:"Name"},{accessorKey:"email",header:"Email"},{accessorKey:"mobile",header:"Mobile"},{accessorKey:"partner_type",header:"Partner Type",Cell:({cell:e})=>{var s;return((s=e.row.original.partner_types)==null?void 0:s.partner_type)||"N/A"}},{accessorKey:"commission",header:"Commission (%)",Cell:({cell:e})=>{var s;return((s=e.row.original.partner_types)==null?void 0:s.commission)||"N/A"}},{accessorKey:"bank_name",header:"Bank Name"},{accessorKey:"account_number",header:"Account Number"},{accessorKey:"ifsc_code",header:"IFSC Code"},{accessorKey:"actions",header:"Actions",Cell:({cell:e})=>a.jsxs("div",{className:"d-flex flex-wrap",children:[a.jsx(E,{role:"button",color:"info",className:"me-2 mb-2",onClick:()=>q(e.row.original),children:"Edit"}),a.jsx(E,{role:"button",color:"danger",className:"mb-2",onClick:()=>B(e.row.original),children:"Delete"})]})}],U=M.map((e,s)=>({...e,index:s+1}));return a.jsxs(a.Fragment,{children:[a.jsxs(O,{children:[a.jsx(Q,{visible:F,setVisible:y,onYes:$,resource:`Delete partner - ${x==null?void 0:x.name}`}),a.jsx(W,{xs:12,children:a.jsx(H,{columns:z,data:U,enableFullScreenToggle:!1,enableColumnResizing:!0,enableStickyHeader:!0,initialState:{density:"xs"},enableRowNumbers:!1,state:{isLoading:A},defaultColumn:{size:130,Cell:({cell:e})=>a.jsx("div",{style:{fontSize:"12px",padding:"5px"},children:e.getValue()})},muiTableBodyCellProps:{style:{padding:"5px",fontSize:"12px"}}})})]}),i.visible&&a.jsx("div",{className:"modal d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:a.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:a.jsxs("div",{className:"modal-content",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("h5",{className:"modal-title",children:"Edit Partner"}),a.jsx("button",{type:"button",className:"btn-close",onClick:C})]}),a.jsx("div",{className:"modal-body",children:a.jsxs(X,{className:"needs-validation",noValidate:!0,validated:i.validated,onSubmit:L,children:[a.jsxs(u,{className:"mb-3",children:[a.jsx(b,{children:a.jsx(p,{icon:ee})}),a.jsx(ae,{name:"type_id",value:i.formData.type_id,onChange:d,invalid:!!o.edit_type_id,required:!0,children:T.map((e,s)=>a.jsx("option",{value:e.value,children:e.label},s))}),a.jsx("div",{className:"invalid-feedback",children:o.edit_type_id||"Please select a partner type."})]}),a.jsxs(u,{className:"mb-3",children:[a.jsx(b,{children:a.jsx(p,{icon:se})}),a.jsx(h,{type:"text",name:"name",placeholder:"Partner Name",value:i.formData.name,onChange:d,required:!0,feedbackInvalid:"Please provide partner name."})]}),a.jsxs(u,{className:"mb-3",children:[a.jsx(b,{children:a.jsx(p,{icon:re})}),a.jsx(h,{type:"email",name:"email",placeholder:"Email Address",value:i.formData.email,onChange:d,invalid:!!o.edit_email,required:!0,feedbackInvalid:o.edit_email||"Please provide a valid email address."})]}),a.jsxs(u,{className:"mb-3",children:[a.jsx(b,{children:a.jsx(p,{icon:ie})}),a.jsx(h,{type:"tel",name:"mobile",placeholder:"Mobile Number (10 digits)",maxLength:10,value:i.formData.mobile,onChange:d,invalid:!!o.edit_mobile,required:!0,feedbackInvalid:o.edit_mobile||"Please provide a valid 10-digit mobile number."})]}),a.jsxs(u,{className:"mb-3",children:[a.jsx(b,{children:a.jsx(p,{icon:te})}),a.jsx(h,{type:"text",name:"bank_name",placeholder:"Bank Name",value:i.formData.bank_name,onChange:d,required:!0,feedbackInvalid:"Please provide bank name."})]}),a.jsxs(u,{className:"mb-3",children:[a.jsx(b,{children:a.jsx(p,{icon:le})}),a.jsx(h,{type:"text",name:"account_number",placeholder:"Account Number",maxLength:50,value:i.formData.account_number,onChange:d,required:!0,feedbackInvalid:"Please provide account number."})]}),a.jsxs(u,{className:"mb-4",children:[a.jsx(b,{children:a.jsx(p,{icon:oe})}),a.jsx(h,{type:"text",name:"ifsc_code",placeholder:"IFSC Code (e.g., SBIN0000123)",maxLength:11,value:i.formData.ifsc_code,onChange:d,invalid:!!o.edit_ifsc_code,required:!0,feedbackInvalid:o.edit_ifsc_code||"Please provide a valid IFSC code."})]}),a.jsxs("div",{className:"modal-footer",children:[a.jsx(I,{color:"secondary",onClick:C,children:"Cancel"}),a.jsx(I,{color:"success",type:"submit",children:"Update Partner"})]})]})})]})})})]})};export{Me as default};
