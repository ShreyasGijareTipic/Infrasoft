const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jspdf.es.min-CufzjD07.js","./index-BjGmA7Bo.js","./index-BznZZSPc.css","./typeof-QjJsDpFa.js","./jspdf.plugin.autotable-D7FwMoWH.js","./jspdf.es.min-CZ3V4YMT.js"])))=>i.map(i=>d[i]);
import{b as se,r as d,j as e,C as X,o as te}from"./index-BjGmA7Bo.js";import{S as re}from"./react-select.esm-DMvNlMD2.js";import{f as ne,a as J,b as be}from"./api-CIBCEetx.js";import{a as E,b as p,c as ee}from"./index.esm-Dt7Qe3Av.js";import{P as oe}from"./ProjectSelectionModal-CwgmrRvW.js";import{C as ie}from"./CForm-vzVfQCWh.js";import{C as x}from"./CFormLabel-B_oLSbD9.js";import{C as j}from"./CFormInput-DF8ie22K.js";import{C as S}from"./CButton-CC7WAWlS.js";import{c as ce}from"./cil-search-CDkY_4k-.js";import{c as de}from"./cil-x-0440B5Ce.js";import{C as me}from"./CFormCheck-Cjogn_rm.js";import{e as ue,a as pe,b as xe,c as je,d as fe,C as ae}from"./DefaultLayout-B3RBETEZ.js";import{C as ye,a as Ce}from"./CCardBody-C0Yq84MQ.js";import{C as ve}from"./CCardHeader-AnyY50zi.js";import{C as Se,a as Ne,b as le,c as k,d as Fe,e as A}from"./CTable-L_woAYa2.js";import{C as Pe}from"./cil-mobile-D36DLDwv.js";import"./defineProperty-DJACW-dl.js";import"./typeof-QjJsDpFa.js";import"./emotion-react.browser.esm-B5rv8ufJ.js";import"./floating-ui.dom-ByRZgDQ1.js";import"./CFormControlWrapper-BkxhhPL_.js";import"./RawMaterial-BtjEDAbB.js";const we=({vendors:z,onSuccess:t,onCancel:G,editData:u=null})=>{const{showToast:y}=se(),[C,b]=d.useState({name:"",id:null}),[V,N]=d.useState([]),[R,w]=d.useState(!1),[M,I]=d.useState(!1),[r,s]=d.useState({project_id:"",vendor_id:"",material_name:"",about:"",price_per_unit:0,qty:1,total:0,date:new Date().toISOString().split("T")[0],include_gst:!1,gst_percent:18,cgst_percent:9,sgst_percent:9});d.useEffect(()=>{if(u){const i=u.gst_included===1||u.gst_percent>0,c=parseFloat(u.gst_percent)||18;s({project_id:u.project_id||"",vendor_id:u.vendor_id||"",material_name:u.material_name||"",about:u.about||"",price_per_unit:parseFloat(u.price_per_unit)||0,qty:parseFloat(u.qty)||1,total:parseFloat(u.total)||0,date:u.date||new Date().toISOString().split("T")[0],include_gst:i,gst_percent:c,cgst_percent:Number((c/2).toFixed(2)),sgst_percent:Number((c/2).toFixed(2))}),u.project&&b({name:u.project.project_name,id:u.project_id})}},[u]),d.useEffect(()=>{const i=(parseFloat(r.qty)||0)*(parseFloat(r.price_per_unit)||0);let c=i;if(r.include_gst&&r.gst_percent>0){const _=i*(parseFloat(r.gst_percent)/100);c=i+_}s(_=>({..._,total:Number(c.toFixed(2))}))},[r.qty,r.price_per_unit,r.include_gst,r.gst_percent]);const f=i=>{const c=parseFloat(i.target.value)||0;s(_=>({..._,gst_percent:c,cgst_percent:Number((c/2).toFixed(2)),sgst_percent:Number((c/2).toFixed(2))}))},T=i=>{const{name:c,value:_,type:a,checked:m}=i.target;s(a==="checkbox"?g=>({...g,[c]:m}):g=>({...g,[c]:_}))},F=async i=>{if(!i.trim()){N([]);return}try{const c=await J(`/api/projects?searchQuery=${i}`);N(c||[])}catch{y("danger","Error searching projects")}},H=i=>{const c=i.target.value;b({name:c,id:null}),F(c)},U=i=>{b({name:i.project_name,id:i.id}),s(c=>({...c,project_id:i.id})),N([])},O=async i=>{var _,a;if(i.preventDefault(),!r.project_id)return y("danger","Please select a project");if(!r.vendor_id)return y("danger","Please select a vendor");if(!r.material_name.trim())return y("danger","Enter material name");if(r.price_per_unit<=0)return y("danger","Price must be > 0");if(r.qty<=0)return y("danger","Quantity must be > 0");const c={project_id:parseInt(r.project_id),vendor_id:parseInt(r.vendor_id),material_name:r.material_name,about:r.about||null,price_per_unit:parseFloat(r.price_per_unit),qty:parseFloat(r.qty),total:parseFloat(r.total),date:r.date,paid_amount:0,gst_included:r.include_gst?1:0,gst_percent:r.include_gst?parseFloat(r.gst_percent):0,cgst_percent:r.include_gst?parseFloat(r.cgst_percent):0,sgst_percent:r.include_gst?parseFloat(r.sgst_percent):0};I(!0);try{u?(await ne("/api/updatePurchase",{...c,id:u.id}),y("success","Purchase updated successfully!")):(await ne("/api/purchesVendor",c),y("success","Purchase saved successfully!")),t()}catch(m){y("danger",((a=(_=m.response)==null?void 0:_.data)==null?void 0:a.message)||"Operation failed")}finally{I(!1)}},Q=()=>{s({project_id:"",vendor_id:"",material_name:"",about:"",price_per_unit:0,qty:1,total:0,date:new Date().toISOString().split("T")[0],include_gst:!1,gst_percent:18,cgst_percent:9,sgst_percent:9}),b({name:"",id:null}),N([])};return e.jsxs(e.Fragment,{children:[e.jsx("style",{jsx:!0,global:!0,children:`
        .total-input {
          background-color: #e9f7ef !important;
          font-weight: 700;
          font-size: 1.1em;
          color: #155724;
        }
        .gst-section {
          background: #f8f9fa;
          padding: 16px;
          border-radius: 8px;
          border: 1px dashed #28a745;
        }
      `}),e.jsxs(ie,{onSubmit:O,className:"needs-validation p-4",children:[e.jsxs(E,{className:"g-4 align-items-end mb-3",children:[e.jsxs(p,{md:4,style:{position:"relative"},children:[e.jsxs(x,{className:"fw-bold",children:["Project Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(j,{type:"text",placeholder:"Search project...",value:C.name,onChange:H,autoComplete:"off",required:!0,className:"pe-5"}),C.id?e.jsx(S,{color:"danger",variant:"outline",size:"sm",onClick:()=>{b({name:"",id:null}),s(i=>({...i,project_id:""}))},style:{position:"absolute",right:2,top:2,bottom:2,width:"36px"},children:e.jsx(ee,{icon:de,size:"sm"})}):e.jsx(S,{color:"primary",variant:"outline",size:"sm",onClick:()=>w(!0),style:{position:"absolute",right:2,top:2,bottom:2,width:"36px"},children:e.jsx(ee,{icon:ce,size:"sm"})})]}),V.length>0&&e.jsx("ul",{className:"suggestions-list",children:V.map(i=>e.jsx("li",{onClick:()=>U(i),children:i.project_name},i.id))})]}),e.jsxs(p,{md:4,children:[e.jsxs(x,{className:"fw-bold",children:["Vendor ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{className:"form-select",name:"vendor_id",value:r.vendor_id,onChange:T,required:!0,children:[e.jsx("option",{value:"",children:"Select Vendor"}),z.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs(p,{md:4,children:[e.jsxs(x,{className:"fw-bold",children:["Material Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(j,{type:"text",name:"material_name",placeholder:"e.g. Cement, Sand",value:r.material_name,onChange:T,required:!0})]})]}),e.jsx(E,{className:"g-4 mb-3",children:e.jsxs(p,{md:12,children:[e.jsx(x,{className:"fw-bold",children:"About (optional)"}),e.jsx(j,{type:"text",name:"about",placeholder:"Enter description...",value:r.about,onChange:T})]})}),e.jsxs(E,{className:"g-4 mb-3 align-items-end",children:[e.jsxs(p,{md:3,children:[e.jsxs(x,{className:"fw-bold",children:["Price/Unit ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(j,{type:"number",name:"price_per_unit",value:r.price_per_unit,onChange:T,min:"0",step:"0.01",required:!0})]}),e.jsxs(p,{md:3,children:[e.jsxs(x,{className:"fw-bold",children:["Quantity ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(j,{type:"number",name:"qty",value:r.qty,onChange:T,min:"0.01",step:"0.01",required:!0})]}),e.jsxs(p,{md:3,children:[e.jsx(x,{className:"fw-bold",children:"Include GST?"}),e.jsx(me,{id:"include_gst",label:"Yes, Add GST",checked:r.include_gst,onChange:T,name:"include_gst"})]}),e.jsxs(p,{md:3,children:[e.jsx(x,{className:"fw-bold",children:"Total Amount"}),e.jsx(j,{type:"number",value:r.total,readOnly:!0,className:"total-input text-success fw-bold"})]})]}),r.include_gst&&e.jsxs("div",{className:"gst-section mb-4",children:[e.jsxs(E,{className:"g-3",children:[e.jsxs(p,{md:4,children:[e.jsx(x,{children:"GST %"}),e.jsx(j,{type:"number",value:r.gst_percent,onChange:f,min:"0",step:"0.01",placeholder:"18"})]}),e.jsxs(p,{md:4,children:[e.jsx(x,{children:"CGST % (auto)"}),e.jsx(j,{type:"text",value:r.cgst_percent,readOnly:!0,className:"bg-light"})]}),e.jsxs(p,{md:4,children:[e.jsx(x,{children:"SGST % (auto)"}),e.jsx(j,{type:"text",value:r.sgst_percent,readOnly:!0,className:"bg-light"})]})]}),e.jsxs("small",{className:"text-success d-block mt-2 fw-bold",children:["GST Amount: ₹",(r.qty*r.price_per_unit*r.gst_percent/100).toFixed(2)]})]}),e.jsx(E,{className:"g-4 mb-4",children:e.jsxs(p,{md:4,children:[e.jsxs(x,{className:"fw-bold",children:["Date ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(j,{type:"date",name:"date",value:r.date,onChange:T,max:new Date().toISOString().split("T")[0],required:!0})]})}),e.jsxs(ue,{className:"border-0 pt-4 justify-content-between",children:[e.jsxs("div",{children:[e.jsx(S,{color:"secondary",onClick:Q,className:"me-2",children:"Clear"}),e.jsx(S,{color:"secondary",onClick:G,children:"Cancel"})]}),e.jsx(S,{color:"success",type:"submit",disabled:M,children:M?e.jsxs(e.Fragment,{children:[e.jsx(X,{size:"sm",className:"me-2"}),"Saving..."]}):u?"Update Purchase":"Submit Purchase"})]})]}),e.jsx(oe,{visible:R,onClose:()=>w(!1),onSelectProject:U})]})},Te=({visible:z,purchase:t,vendors:G,onClose:u,onSuccess:y})=>{var c,_;const{showToast:C}=se(),[b,V]=d.useState(!1),[N,R]=d.useState(!1),[w,M]=d.useState({name:"",id:null}),[I,r]=d.useState([]),[s,f]=d.useState({payment_id:(t==null?void 0:t.id)||"",vendor_id:((c=t==null?void 0:t.vendor_id)==null?void 0:c.toString())||"",project_id:((_=t==null?void 0:t.project_id)==null?void 0:_.toString())||"",material_name:(t==null?void 0:t.material_name)||"",about:(t==null?void 0:t.about)||"",price_per_unit:parseFloat(t==null?void 0:t.price_per_unit)||0,qty:parseFloat(t==null?void 0:t.qty)||1,total:parseFloat(t==null?void 0:t.total)||0,date:(t==null?void 0:t.date)||"",include_gst:(t==null?void 0:t.gst_included)===1||(t==null?void 0:t.gst_percent)>0,gst_percent:parseFloat(t==null?void 0:t.gst_percent)||18,cgst_percent:parseFloat(t==null?void 0:t.cgst_percent)||9,sgst_percent:parseFloat(t==null?void 0:t.sgst_percent)||9});d.useEffect(()=>{t!=null&&t.project&&(M({name:t.project.project_name,id:t.project_id}),f(a=>{var m;return{...a,project_id:(m=t.project_id)==null?void 0:m.toString()}}))},[t]),d.useEffect(()=>{const a=(parseFloat(s.qty)||0)*(parseFloat(s.price_per_unit)||0);let m=a;if(s.include_gst&&s.gst_percent>0){const g=a*(parseFloat(s.gst_percent)/100);m=a+g}f(g=>({...g,total:Number(m.toFixed(2))}))},[s.qty,s.price_per_unit,s.include_gst,s.gst_percent]);const T=a=>{const m=parseFloat(a.target.value)||0;f(g=>({...g,gst_percent:m,cgst_percent:Number((m/2).toFixed(2)),sgst_percent:Number((m/2).toFixed(2))}))},F=a=>{const{name:m,value:g,type:D,checked:K}=a.target;f(Z=>({...Z,[m]:D==="checkbox"?K:g}))},H=async a=>{if(!a.trim()){r([]);return}try{const m=await J(`/api/projects?searchQuery=${a}`);r(m||[])}catch{C("danger","Error searching projects")}},U=a=>{const m=a.target.value;M({name:m,id:null}),f(g=>({...g,project_id:""})),H(m)},O=a=>{M({name:a.project_name,id:a.id}),f(m=>({...m,project_id:a.id.toString()})),r([])},Q=()=>{M({name:"",id:null}),f(a=>({...a,project_id:""})),r([])},i=async()=>{var m,g;if(!s.project_id)return C("danger","Please select a project");if(!s.vendor_id)return C("danger","Please select a vendor");if(!s.material_name.trim())return C("danger","Material name is required");if(s.price_per_unit<=0)return C("danger","Price must be > 0");if(s.qty<=0)return C("danger","Quantity must be > 0");const a={payment_id:parseInt(s.payment_id),vendor_id:parseInt(s.vendor_id),project_id:parseInt(s.project_id),material_name:s.material_name,about:s.about||null,price_per_unit:parseFloat(s.price_per_unit),qty:parseFloat(s.qty),total:parseFloat(s.total),date:s.date,gst_included:s.include_gst?1:0,gst_percent:s.include_gst?parseFloat(s.gst_percent):0,cgst_percent:s.include_gst?parseFloat(s.cgst_percent):0,sgst_percent:s.include_gst?parseFloat(s.sgst_percent):0};V(!0);try{await be("/api/updatePurchesVendorPayment",a),C("success","Purchase updated successfully!"),y(),u()}catch(D){C("danger","Update failed: "+(((g=(m=D.response)==null?void 0:m.data)==null?void 0:g.message)||D.message))}finally{V(!1)}};return e.jsxs(pe,{visible:z,onClose:u,backdrop:"static",size:"xl",children:[e.jsx(xe,{closeButton:!0,children:e.jsx(je,{children:"Edit Purchase"})}),e.jsx(fe,{children:e.jsxs(ie,{children:[e.jsxs(E,{className:"g-4 mb-3 align-items-end",children:[e.jsxs(p,{md:6,style:{position:"relative"},children:[e.jsxs(x,{className:"fw-bold",children:["Project ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(j,{type:"text",placeholder:"Search project...",value:w.name,onChange:U,autoComplete:"off",required:!0,className:"pe-5"}),w.id?e.jsx(S,{color:"danger",variant:"outline",size:"sm",onClick:Q,style:{position:"absolute",right:2,top:2,bottom:2,width:"36px"},children:e.jsx(ee,{icon:de,size:"sm"})}):e.jsx(S,{color:"primary",variant:"outline",size:"sm",onClick:()=>R(!0),style:{position:"absolute",right:2,top:2,bottom:2,width:"36px"},children:e.jsx(ee,{icon:ce,size:"sm"})})]}),I.length>0&&e.jsx("ul",{className:"list-group position-absolute z-index-1000 w-100 mt-1",style:{maxHeight:"200px",overflowY:"auto"},children:I.map(a=>e.jsx("li",{className:"list-group-item list-group-item-action",style:{cursor:"pointer"},onClick:()=>O(a),children:a.project_name},a.id))})]}),e.jsxs(p,{md:6,children:[e.jsxs(x,{className:"fw-bold",children:["Vendor ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("select",{className:"form-select",name:"vendor_id",value:s.vendor_id,onChange:F,required:!0,children:[e.jsx("option",{value:"",children:"Select Vendor"}),G.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]}),e.jsx(E,{className:"g-3 mb-3",children:e.jsxs(p,{md:12,children:[e.jsxs(x,{className:"fw-bold",children:["Material Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(j,{type:"text",name:"material_name",value:s.material_name,onChange:F,required:!0})]})}),e.jsx(E,{className:"g-3 mb-3",children:e.jsxs(p,{md:12,children:[e.jsx(x,{children:"About (optional)"}),e.jsx(j,{type:"text",name:"about",placeholder:"Description...",value:s.about,onChange:F})]})}),e.jsxs(E,{className:"g-3 mb-3 align-items-end",children:[e.jsxs(p,{md:3,children:[e.jsx(x,{children:"Price/Unit *"}),e.jsx(j,{type:"number",name:"price_per_unit",value:s.price_per_unit,onChange:F,min:"0",step:"0.01",required:!0})]}),e.jsxs(p,{md:3,children:[e.jsx(x,{children:"Quantity *"}),e.jsx(j,{type:"number",name:"qty",value:s.qty,onChange:F,min:"0.01",step:"0.01",required:!0})]}),e.jsxs(p,{md:3,children:[e.jsx(x,{children:"Include GST?"}),e.jsx(me,{id:"include_gst_edit",label:"Yes, Add GST",checked:s.include_gst,onChange:F,name:"include_gst"})]}),e.jsxs(p,{md:3,children:[e.jsx(x,{children:"Total Amount"}),e.jsx(j,{type:"text",value:`₹${s.total.toFixed(2)}`,readOnly:!0,className:"bg-success text-white fw-bold"})]})]}),s.include_gst&&e.jsxs("div",{style:{background:"#f8f9fa",padding:"16px",borderRadius:"8px",border:"1px dashed #28a745"},className:"mb-3",children:[e.jsxs(E,{className:"g-3",children:[e.jsxs(p,{md:4,children:[e.jsx(x,{children:"GST %"}),e.jsx(j,{type:"number",value:s.gst_percent,onChange:T,min:"0",step:"0.01"})]}),e.jsxs(p,{md:4,children:[e.jsx(x,{children:"CGST % (auto)"}),e.jsx(j,{type:"text",value:s.cgst_percent,readOnly:!0,className:"bg-light"})]}),e.jsxs(p,{md:4,children:[e.jsx(x,{children:"SGST % (auto)"}),e.jsx(j,{type:"text",value:s.sgst_percent,readOnly:!0,className:"bg-light"})]})]}),e.jsxs("small",{className:"text-success fw-bold d-block mt-2",children:["GST Amount: ₹",(s.qty*s.price_per_unit*s.gst_percent/100).toFixed(2)]})]}),e.jsx(E,{className:"g-3",children:e.jsxs(p,{md:4,children:[e.jsx(x,{children:"Date *"}),e.jsx(j,{type:"date",name:"date",value:s.date,onChange:F,max:new Date().toISOString().split("T")[0],required:!0})]})})]})}),e.jsxs(ue,{children:[e.jsx(S,{color:"secondary",onClick:u,children:"Cancel"}),e.jsx(S,{color:"primary",onClick:i,disabled:b,children:b?e.jsx(X,{size:"sm",className:"me-2"}):"Update Purchase"})]}),e.jsx(oe,{visible:N,onClose:()=>R(!1),onSelectProject:O})]})},Xe=()=>{const[z,t]=d.useState([]),[G,u]=d.useState([]),[y,C]=d.useState([]),[b,V]=d.useState(!1),[N,R]=d.useState(!1),[w,M]=d.useState(!0),[I,r]=d.useState(null),[s,f]=d.useState(!1),[T,F]=d.useState(!1),[H,U]=d.useState(null),{showToast:O}=se(),[Q,i]=d.useState(null),[c,_]=d.useState(null),a=d.useRef(null),m=async()=>{try{const n=await J("/api/getPurchesVendor");u(n||[])}catch{O("danger","Error loading vendors")}},g=async()=>{try{const n=await J("/api/projects");C(n||[])}catch{O("danger","Failed to load projects")}},D=async(n=null,o=!1)=>{try{o?R(!0):V(!0);const v=n?`/api/purchesVendor?cursor=${n}&perPage=10`:"/api/purchesVendor?perPage=10",P=await J(v),L=(P==null?void 0:P.data)||[];t(o?B=>[...B,...L]:L),r(P.next_cursor),M(P.has_more_pages)}catch{O("danger","Failed to load purchases"),o||t([])}finally{V(!1),R(!1)}};d.useEffect(()=>{m(),g(),D()},[]);const K=d.useCallback(()=>{!N&&!b&&w&&I&&D(I,!0)},[N,b,w,I]);d.useEffect(()=>{const n=new IntersectionObserver(v=>{v[0].isIntersecting&&w&&!N&&!b&&K()},{threshold:.1,rootMargin:"100px"}),o=a.current;return o&&n.observe(o),()=>{o&&n.unobserve(o)}},[w,N,b,K]);const Z=()=>{t([]),r(null),M(!0),D()},ge=n=>{U(n),F(!0)},q=z.filter(n=>{const o=Q?n.project_id===Q.value:!0,v=c?n.vendor_id===c.value:!0;return o&&v}),he=()=>{te(()=>import("./jspdf.es.min-CufzjD07.js").then(n=>n.j),__vite__mapDeps([0,1,2,3]),import.meta.url).then(n=>{te(()=>import("./jspdf.plugin.autotable-D7FwMoWH.js").then(o=>o.j),__vite__mapDeps([4,1,2,5,0,3]),import.meta.url).then(()=>{const o=new n.jsPDF("landscape");o.setFont("helvetica","bold"),o.setFontSize(18),o.text("PURCHASE REPORT",14,15),o.setFontSize(11),o.setFont("helvetica","normal"),o.text(`Generated On: ${new Date().toLocaleDateString()}`,14,25),o.setFontSize(12),o.setFont("helvetica","bold"),o.text(`Total Records: ${q.length}`,14,33);const v=q.reduce((l,h)=>l+Number(h.qty||0),0),P=q.reduce((l,h)=>l+Number(h.total||0),0),L=q.reduce((l,h)=>l+Number(h.price_per_unit||0),0),B=["Sr No","Project","Vendor","Material","Price/Unit","Qty","Total","Date","About"],$=[];q.forEach((l,h)=>{var Y,W;$.push([h+1,((Y=l.project)==null?void 0:Y.project_name)||"—",((W=l.vendor)==null?void 0:W.name)||"—",l.material_name,parseFloat(l.price_per_unit).toFixed(2),l.qty,parseFloat(l.total).toFixed(2),new Date(l.date).toLocaleDateString(),l.about||"—"])}),$.push([{content:"Total:",colSpan:4,styles:{halign:"right",fontStyle:"bold"}},L.toFixed(2),v,P.toFixed(2),"",""]),o.autoTable({head:[B],body:$,startY:45,theme:"grid",headStyles:{fillColor:[30,115,120],textColor:255,fontSize:10,halign:"center"},bodyStyles:{fontSize:9,halign:"center"},styles:{lineWidth:.25,lineColor:[120,120,120]},alternateRowStyles:{fillColor:[245,245,245]},didDrawPage:l=>{const h=o.internal.pageSize.height;o.setFontSize(10),o.setTextColor(100),o.text(`Purchase Report | Generated: ${new Date().toLocaleDateString()}`,l.settings.margin.left,h-10),o.text(`Page ${o.internal.getNumberOfPages()}`,o.internal.pageSize.width-30,h-10)}}),o.save("purchase_report.pdf")})})},_e=()=>{te(()=>import("./xlsx-B6sNpj_1.js"),[],import.meta.url).then(n=>{const o=q.reduce((l,h)=>l+Number(h.qty||0),0),v=q.reduce((l,h)=>l+Number(h.total||0),0),P=q.reduce((l,h)=>l+Number(h.price_per_unit||0),0),L=q.map((l,h)=>{var Y,W;return{"Sr No":h+1,Project:((Y=l.project)==null?void 0:Y.project_name)||"—",Vendor:((W=l.vendor)==null?void 0:W.name)||"—",Material:l.material_name,"Price/Unit":parseFloat(l.price_per_unit).toFixed(2),Qty:l.qty,Total:parseFloat(l.total).toFixed(2),Date:new Date(l.date).toLocaleDateString(),About:l.about||"—"}});L.push({"Sr No":"",Project:"",Vendor:"",Material:"Total:","Price/Unit":P.toFixed(2),Qty:o,Total:v.toFixed(2),Date:"",About:""});const B=n.utils.json_to_sheet(L);Object.keys(B).forEach(l=>{(l.startsWith("A1")||l.startsWith("B1")||l.startsWith("C1"))&&(B[l].s={font:{bold:!0}})});const $=n.utils.book_new();n.utils.book_append_sheet($,B,"Purchases"),n.writeFile($,"purchase_report.xlsx")})};return e.jsxs(e.Fragment,{children:[e.jsxs(ye,{className:"mb-4",children:[e.jsxs(ve,{className:"d-flex justify-content-between align-items-center flex-wrap gap-3",style:{paddingBottom:"1rem"},children:[e.jsx("strong",{children:"Purchase History"}),e.jsxs("div",{className:"d-flex align-items-center gap-3 flex-wrap",children:[e.jsx(S,{color:"primary",onClick:he,children:"Download PDF"}),e.jsx(S,{color:"info",onClick:_e,children:"Download Excel"}),e.jsx("div",{style:{width:200},children:e.jsx(re,{placeholder:"Filter by Project",options:y.map(n=>({value:n.id,label:n.project_name})),value:Q,onChange:i,isClearable:!0})}),e.jsx("div",{style:{width:200},children:e.jsx(re,{placeholder:"Filter by Vendor",options:G.map(n=>({value:n.id,label:n.name})),value:c,onChange:_,isClearable:!0})}),e.jsx(S,{color:"success",onClick:()=>f(!0),children:"Add Purchase"})]})]}),e.jsx(Ce,{children:b&&z.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx(X,{})}):q.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(Se,{striped:!0,hover:!0,bordered:!0,children:[e.jsx(Ne,{color:"light",children:e.jsxs(le,{children:[e.jsx(k,{children:"Sr. No."}),e.jsx(k,{children:"Project"}),e.jsx(k,{children:"Vendor"}),e.jsx(k,{children:"Material"}),e.jsx(k,{children:"Price/Unit"}),e.jsx(k,{children:"Qty"}),e.jsx(k,{children:"Total"}),e.jsx(k,{children:"Include GST"}),e.jsx(k,{children:"Date"}),e.jsx(k,{children:"About"}),e.jsx(k,{children:"Action"})]})}),e.jsx(Fe,{children:q.map((n,o)=>{var v,P;return e.jsxs(le,{children:[e.jsx(A,{children:o+1}),e.jsx(A,{children:((v=n.project)==null?void 0:v.project_name)||"—"}),e.jsx(A,{children:((P=n.vendor)==null?void 0:P.name)||"—"}),e.jsx(A,{children:n.material_name}),e.jsxs(A,{children:["₹",parseFloat(n.price_per_unit).toFixed(2)]}),e.jsx(A,{children:n.qty}),e.jsx(A,{children:e.jsxs("strong",{children:["₹",parseFloat(n.total).toFixed(2)]})}),e.jsx(A,{children:n.gst_included?e.jsx(ae,{color:"success",children:"Yes"}):e.jsx(ae,{color:"danger",children:"No"})}),e.jsx(A,{children:new Date(n.date).toLocaleDateString()}),e.jsx(A,{children:n.about||"—"}),e.jsx(A,{children:e.jsx(S,{color:"warning",size:"sm",onClick:()=>ge(n),children:"Edit"})})]},n.id)})})]})}),e.jsxs("div",{ref:a,style:{height:"20px",margin:"20px 0"},children:[N&&e.jsxs("div",{className:"text-center",children:[e.jsx(X,{size:"sm",className:"me-2"}),e.jsx("span",{className:"text-muted small",children:"Loading more purchases..."})]}),!w&&z.length>0&&e.jsxs("div",{className:"text-center text-muted small",children:[e.jsx("hr",{}),e.jsxs("p",{children:["All ",z.length," purchases loaded"]})]})]})]}):e.jsx(Pe,{color:"info",className:"text-center",children:"No matching purchases found."})})]}),e.jsxs(pe,{size:"xl",visible:s,onClose:()=>f(!1),backdrop:"static",children:[e.jsx(xe,{closeButton:!0,children:e.jsx(je,{children:"Add New Purchase"})}),e.jsx(we,{vendors:G,onSuccess:()=>{f(!1),Z()},onCancel:()=>f(!1)})]}),H&&e.jsx(Te,{visible:T,purchase:H,vendors:G,onClose:()=>{F(!1),U(null)},onSuccess:Z})]})};export{Xe as default};
